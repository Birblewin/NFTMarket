/* eslint-disable no-cond-assign */
/* eslint-disable no-sparse-arrays */
/* eslint-disable no-misleading-character-class */
/* eslint-disable no-control-regex */
/* eslint-disable no-fallthrough */
/* eslint-disable no-empty */
/* eslint-disable no-async-promise-executor */
/* eslint-disable no-undef */
/* eslint-disable no-useless-escape */
/* eslint-disable no-unused-vars */
/* eslint-disable require-yield */
/* eslint-disable no-prototype-builtins */
/* eslint-disable no-redeclare */
import{k as _c,m as hr,r as Pi,o as bm,s as se,t as Em,w as Vl,v as Kl,x as bc,y as wo,z as xm,A as Ei,D as Im,B as Pm,N as Z,E as Sm,G as fc,H as Om,V as Am,R as Rm,I as Fh,K as Cm,J as Tm,L as Nm,M as Dh,$ as Lm,O as Fm,Q as Xs,Z as $h,S as Dm,X as $m,_ as Gl,T as Dr,U as qm,Y as Mm,a0 as ls,a1 as Ft,a2 as tr,a3 as bi,a4 as ur,a5 as jm,a6 as fs,a7 as Wl,a8 as zm,a9 as Um,aa as Hm,ab as Jl,ac as km,ad as Ql,ae as Yl,af as ds,ag as pc,ah as lo,ai as ys,aj as Bm,ak as fo,al as Vm,am as Km,an as Gm,ao,ap as Wm,aq as Jm,ar as Qa,as as qh,at as Qm,au as Ym,av as Xm,aw as Mh,ax as Zm,ay as e1,az as t1,aA as r1,aB as i1,aC as s1,aD as n1,aE as Ws,aF as Xl,aG as Ya,aH as o1,aI as a1,aJ as c1}from"./index-2ae87c9c.js";var Ec={exports:{}},gs=typeof Reflect=="object"?Reflect:null,jh=gs&&typeof gs.apply=="function"?gs.apply:function(r,i,n){return Function.prototype.apply.call(r,i,n)},po;gs&&typeof gs.ownKeys=="function"?po=gs.ownKeys:Object.getOwnPropertySymbols?po=function(r){return Object.getOwnPropertyNames(r).concat(Object.getOwnPropertySymbols(r))}:po=function(r){return Object.getOwnPropertyNames(r)};function u1(c){console&&console.warn&&console.warn(c)}var Zl=Number.isNaN||function(r){return r!==r};function ke(){ke.init.call(this)}Ec.exports=ke;Ec.exports.once=p1;ke.EventEmitter=ke;ke.prototype._events=void 0;ke.prototype._eventsCount=0;ke.prototype._maxListeners=void 0;var zh=10;function _o(c){if(typeof c!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof c)}Object.defineProperty(ke,"defaultMaxListeners",{enumerable:!0,get:function(){return zh},set:function(c){if(typeof c!="number"||c<0||Zl(c))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+c+".");zh=c}});ke.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};ke.prototype.setMaxListeners=function(r){if(typeof r!="number"||r<0||Zl(r))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+r+".");return this._maxListeners=r,this};function ef(c){return c._maxListeners===void 0?ke.defaultMaxListeners:c._maxListeners}ke.prototype.getMaxListeners=function(){return ef(this)};ke.prototype.emit=function(r){for(var i=[],n=1;n<arguments.length;n++)i.push(arguments[n]);var o=r==="error",h=this._events;if(h!==void 0)o=o&&h.error===void 0;else if(!o)return!1;if(o){var p;if(i.length>0&&(p=i[0]),p instanceof Error)throw p;var g=new Error("Unhandled error."+(p?" ("+p.message+")":""));throw g.context=p,g}var w=h[r];if(w===void 0)return!1;if(typeof w=="function")jh(w,this,i);else for(var S=w.length,L=of(w,S),n=0;n<S;++n)jh(L[n],this,i);return!0};function tf(c,r,i,n){var o,h,p;if(_o(i),h=c._events,h===void 0?(h=c._events=Object.create(null),c._eventsCount=0):(h.newListener!==void 0&&(c.emit("newListener",r,i.listener?i.listener:i),h=c._events),p=h[r]),p===void 0)p=h[r]=i,++c._eventsCount;else if(typeof p=="function"?p=h[r]=n?[i,p]:[p,i]:n?p.unshift(i):p.push(i),o=ef(c),o>0&&p.length>o&&!p.warned){p.warned=!0;var g=new Error("Possible EventEmitter memory leak detected. "+p.length+" "+String(r)+" listeners added. Use emitter.setMaxListeners() to increase limit");g.name="MaxListenersExceededWarning",g.emitter=c,g.type=r,g.count=p.length,u1(g)}return c}ke.prototype.addListener=function(r,i){return tf(this,r,i,!1)};ke.prototype.on=ke.prototype.addListener;ke.prototype.prependListener=function(r,i){return tf(this,r,i,!0)};function h1(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function rf(c,r,i){var n={fired:!1,wrapFn:void 0,target:c,type:r,listener:i},o=h1.bind(n);return o.listener=i,n.wrapFn=o,o}ke.prototype.once=function(r,i){return _o(i),this.on(r,rf(this,r,i)),this};ke.prototype.prependOnceListener=function(r,i){return _o(i),this.prependListener(r,rf(this,r,i)),this};ke.prototype.removeListener=function(r,i){var n,o,h,p,g;if(_o(i),o=this._events,o===void 0)return this;if(n=o[r],n===void 0)return this;if(n===i||n.listener===i)--this._eventsCount===0?this._events=Object.create(null):(delete o[r],o.removeListener&&this.emit("removeListener",r,n.listener||i));else if(typeof n!="function"){for(h=-1,p=n.length-1;p>=0;p--)if(n[p]===i||n[p].listener===i){g=n[p].listener,h=p;break}if(h<0)return this;h===0?n.shift():l1(n,h),n.length===1&&(o[r]=n[0]),o.removeListener!==void 0&&this.emit("removeListener",r,g||i)}return this};ke.prototype.off=ke.prototype.removeListener;ke.prototype.removeAllListeners=function(r){var i,n,o;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[r]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[r]),this;if(arguments.length===0){var h=Object.keys(n),p;for(o=0;o<h.length;++o)p=h[o],p!=="removeListener"&&this.removeAllListeners(p);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(i=n[r],typeof i=="function")this.removeListener(r,i);else if(i!==void 0)for(o=i.length-1;o>=0;o--)this.removeListener(r,i[o]);return this};function sf(c,r,i){var n=c._events;if(n===void 0)return[];var o=n[r];return o===void 0?[]:typeof o=="function"?i?[o.listener||o]:[o]:i?f1(o):of(o,o.length)}ke.prototype.listeners=function(r){return sf(this,r,!0)};ke.prototype.rawListeners=function(r){return sf(this,r,!1)};ke.listenerCount=function(c,r){return typeof c.listenerCount=="function"?c.listenerCount(r):nf.call(c,r)};ke.prototype.listenerCount=nf;function nf(c){var r=this._events;if(r!==void 0){var i=r[c];if(typeof i=="function")return 1;if(i!==void 0)return i.length}return 0}ke.prototype.eventNames=function(){return this._eventsCount>0?po(this._events):[]};function of(c,r){for(var i=new Array(r),n=0;n<r;++n)i[n]=c[n];return i}function l1(c,r){for(;r+1<c.length;r++)c[r]=c[r+1];c.pop()}function f1(c){for(var r=new Array(c.length),i=0;i<r.length;++i)r[i]=c[i].listener||c[i];return r}function p1(c,r){return new Promise(function(i,n){function o(p){c.removeListener(r,h),n(p)}function h(){typeof c.removeListener=="function"&&c.removeListener("error",o),i([].slice.call(arguments))}af(c,r,h,{once:!0}),r!=="error"&&d1(c,o,{once:!0})})}function d1(c,r,i){typeof c.on=="function"&&af(c,"error",r,i)}function af(c,r,i,n){if(typeof c.on=="function")n.once?c.once(r,i):c.on(r,i);else if(typeof c.addEventListener=="function")c.addEventListener(r,function o(h){n.once&&c.removeEventListener(r,o),i(h)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof c)}var yr=Ec.exports;const xc=_c(yr);var bo={},en={};Object.defineProperty(en,"__esModule",{value:!0});function g1(c){if(typeof c!="string")throw new Error(`Cannot safe json parse value of type ${typeof c}`);try{return JSON.parse(c)}catch{return c}}en.safeJsonParse=g1;function v1(c){return typeof c=="string"?c:JSON.stringify(c,(r,i)=>typeof i>"u"?null:i)}en.safeJsonStringify=v1;var Ms={exports:{}},Uh;function y1(){return Uh||(Uh=1,function(){let c;function r(){}c=r,c.prototype.getItem=function(i){return this.hasOwnProperty(i)?String(this[i]):null},c.prototype.setItem=function(i,n){this[i]=String(n)},c.prototype.removeItem=function(i){delete this[i]},c.prototype.clear=function(){const i=this;Object.keys(i).forEach(function(n){i[n]=void 0,delete i[n]})},c.prototype.key=function(i){return i=i||0,Object.keys(this)[i]},c.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof hr<"u"&&hr.localStorage?Ms.exports=hr.localStorage:typeof window<"u"&&window.localStorage?Ms.exports=window.localStorage:Ms.exports=new r}()),Ms.exports}var Xa={},js={},Hh;function m1(){if(Hh)return js;Hh=1,Object.defineProperty(js,"__esModule",{value:!0}),js.IKeyValueStorage=void 0;class c{}return js.IKeyValueStorage=c,js}var zs={},kh;function w1(){if(kh)return zs;kh=1,Object.defineProperty(zs,"__esModule",{value:!0}),zs.parseEntry=void 0;const c=en;function r(i){var n;return[i[0],c.safeJsonParse((n=i[1])!==null&&n!==void 0?n:"")]}return zs.parseEntry=r,zs}var Bh;function _1(){return Bh||(Bh=1,function(c){Object.defineProperty(c,"__esModule",{value:!0});const r=Pi;r.__exportStar(m1(),c),r.__exportStar(w1(),c)}(Xa)),Xa}Object.defineProperty(bo,"__esModule",{value:!0});bo.KeyValueStorage=void 0;const ps=Pi,Vh=en,b1=ps.__importDefault(y1()),E1=_1();class cf{constructor(){this.localStorage=b1.default}getKeys(){return ps.__awaiter(this,void 0,void 0,function*(){return Object.keys(this.localStorage)})}getEntries(){return ps.__awaiter(this,void 0,void 0,function*(){return Object.entries(this.localStorage).map(E1.parseEntry)})}getItem(r){return ps.__awaiter(this,void 0,void 0,function*(){const i=this.localStorage.getItem(r);if(i!==null)return Vh.safeJsonParse(i)})}setItem(r,i){return ps.__awaiter(this,void 0,void 0,function*(){this.localStorage.setItem(r,Vh.safeJsonStringify(i))})}removeItem(r){return ps.__awaiter(this,void 0,void 0,function*(){this.localStorage.removeItem(r)})}}bo.KeyValueStorage=cf;var x1=bo.default=cf,ms={},Us={},Za={},Hs={};let ki=class{};const I1=Object.freeze(Object.defineProperty({__proto__:null,IEvents:ki},Symbol.toStringTag,{value:"Module"})),P1=bm(I1);var Kh;function S1(){if(Kh)return Hs;Kh=1,Object.defineProperty(Hs,"__esModule",{value:!0}),Hs.IHeartBeat=void 0;const c=P1;class r extends c.IEvents{constructor(n){super()}}return Hs.IHeartBeat=r,Hs}var Gh;function uf(){return Gh||(Gh=1,function(c){Object.defineProperty(c,"__esModule",{value:!0}),Pi.__exportStar(S1(),c)}(Za)),Za}var ec={},Ui={},Wh;function O1(){if(Wh)return Ui;Wh=1,Object.defineProperty(Ui,"__esModule",{value:!0}),Ui.HEARTBEAT_EVENTS=Ui.HEARTBEAT_INTERVAL=void 0;const c=se;return Ui.HEARTBEAT_INTERVAL=c.FIVE_SECONDS,Ui.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},Ui}var Jh;function hf(){return Jh||(Jh=1,function(c){Object.defineProperty(c,"__esModule",{value:!0}),Pi.__exportStar(O1(),c)}(ec)),ec}var Qh;function A1(){if(Qh)return Us;Qh=1,Object.defineProperty(Us,"__esModule",{value:!0}),Us.HeartBeat=void 0;const c=Pi,r=yr,i=se,n=uf(),o=hf();class h extends n.IHeartBeat{constructor(g){super(g),this.events=new r.EventEmitter,this.interval=o.HEARTBEAT_INTERVAL,this.interval=(g==null?void 0:g.interval)||o.HEARTBEAT_INTERVAL}static init(g){return c.__awaiter(this,void 0,void 0,function*(){const w=new h(g);return yield w.init(),w})}init(){return c.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(g,w){this.events.on(g,w)}once(g,w){this.events.once(g,w)}off(g,w){this.events.off(g,w)}removeListener(g,w){this.events.removeListener(g,w)}initialize(){return c.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),i.toMiliseconds(this.interval))})}pulse(){this.events.emit(o.HEARTBEAT_EVENTS.pulse)}}return Us.HeartBeat=h,Us}(function(c){Object.defineProperty(c,"__esModule",{value:!0});const r=Pi;r.__exportStar(A1(),c),r.__exportStar(uf(),c),r.__exportStar(hf(),c)})(ms);var Ce={},tc,Yh;function R1(){if(Yh)return tc;Yh=1;function c(i){try{return JSON.stringify(i)}catch{return'"[Circular]"'}}tc=r;function r(i,n,o){var h=o&&o.stringify||c,p=1;if(typeof i=="object"&&i!==null){var g=n.length+p;if(g===1)return i;var w=new Array(g);w[0]=h(i);for(var S=1;S<g;S++)w[S]=h(n[S]);return w.join(" ")}if(typeof i!="string")return i;var L=n.length;if(L===0)return i;for(var H="",B=1-p,K=-1,q=i&&i.length||0,W=0;W<q;){if(i.charCodeAt(W)===37&&W+1<q){switch(K=K>-1?K:0,i.charCodeAt(W+1)){case 100:case 102:if(B>=L||n[B]==null)break;K<W&&(H+=i.slice(K,W)),H+=Number(n[B]),K=W+2,W++;break;case 105:if(B>=L||n[B]==null)break;K<W&&(H+=i.slice(K,W)),H+=Math.floor(Number(n[B])),K=W+2,W++;break;case 79:case 111:case 106:if(B>=L||n[B]===void 0)break;K<W&&(H+=i.slice(K,W));var ie=typeof n[B];if(ie==="string"){H+="'"+n[B]+"'",K=W+2,W++;break}if(ie==="function"){H+=n[B].name||"<anonymous>",K=W+2,W++;break}H+=h(n[B]),K=W+2,W++;break;case 115:if(B>=L)break;K<W&&(H+=i.slice(K,W)),H+=String(n[B]),K=W+2,W++;break;case 37:K<W&&(H+=i.slice(K,W)),H+="%",K=W+2,W++,B--;break}++B}++W}return K===-1?i:(K<q&&(H+=i.slice(K)),H)}return tc}var rc,Xh;function C1(){if(Xh)return rc;Xh=1;const c=R1();rc=o;const r=le().console||{},i={mapHttpRequest:q,mapHttpResponse:q,wrapRequestSerializer:W,wrapResponseSerializer:W,wrapErrorSerializer:W,req:q,res:q,err:B};function n(T,M){return Array.isArray(T)?T.filter(function(ve){return ve!=="!stdSerializers.err"}):T===!0?Object.keys(M):!1}function o(T){T=T||{},T.browser=T.browser||{};const M=T.browser.transmit;if(M&&typeof M.send!="function")throw Error("pino: transmit option must have a send function");const G=T.browser.write||r;T.browser.write&&(T.browser.asObject=!0);const ve=T.serializers||{},re=n(T.browser.serialize,ve);let ue=T.browser.serialize;Array.isArray(T.browser.serialize)&&T.browser.serialize.indexOf("!stdSerializers.err")>-1&&(ue=!1);const Te=["error","fatal","warn","info","debug","trace"];typeof G=="function"&&(G.error=G.fatal=G.warn=G.info=G.debug=G.trace=G),T.enabled===!1&&(T.level="silent");const ze=T.level||"info",y=Object.create(G);y.log||(y.log=ie),Object.defineProperty(y,"levelVal",{get:Y}),Object.defineProperty(y,"level",{get:ce,set:k});const E={transmit:M,serialize:re,asObject:T.browser.asObject,levels:Te,timestamp:K(T)};y.levels=o.levels,y.level=ze,y.setMaxListeners=y.getMaxListeners=y.emit=y.addListener=y.on=y.prependListener=y.once=y.prependOnceListener=y.removeListener=y.removeAllListeners=y.listeners=y.listenerCount=y.eventNames=y.write=y.flush=ie,y.serializers=ve,y._serialize=re,y._stdErrSerialize=ue,y.child=j,M&&(y._logEvent=H());function Y(){return this.level==="silent"?1/0:this.levels.values[this.level]}function ce(){return this._level}function k(U){if(U!=="silent"&&!this.levels.values[U])throw Error("unknown level "+U);this._level=U,h(E,y,"error","log"),h(E,y,"fatal","error"),h(E,y,"warn","error"),h(E,y,"info","log"),h(E,y,"debug","log"),h(E,y,"trace","log")}function j(U,V){if(!U)throw new Error("missing bindings for child Pino");V=V||{},re&&U.serializers&&(V.serializers=U.serializers);const Qe=V.serializers;if(re&&Qe){var Be=Object.assign({},ve,Qe),qr=T.browser.serialize===!0?Object.keys(Be):re;delete U.serializers,w([U],qr,Be,this._stdErrSerialize)}function xe(It){this._childLevel=(It._childLevel|0)+1,this.error=S(It,U,"error"),this.fatal=S(It,U,"fatal"),this.warn=S(It,U,"warn"),this.info=S(It,U,"info"),this.debug=S(It,U,"debug"),this.trace=S(It,U,"trace"),Be&&(this.serializers=Be,this._serialize=qr),M&&(this._logEvent=H([].concat(It._logEvent.bindings,U)))}return xe.prototype=this,new xe(this)}return y}o.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},o.stdSerializers=i,o.stdTimeFunctions=Object.assign({},{nullTime:Ee,epochTime:ge,unixTime:pe,isoTime:he});function h(T,M,G,ve){const re=Object.getPrototypeOf(M);M[G]=M.levelVal>M.levels.values[G]?ie:re[G]?re[G]:r[G]||r[ve]||ie,p(T,M,G)}function p(T,M,G){!T.transmit&&M[G]===ie||(M[G]=function(ve){return function(){const ue=T.timestamp(),Te=new Array(arguments.length),ze=Object.getPrototypeOf&&Object.getPrototypeOf(this)===r?r:this;for(var y=0;y<Te.length;y++)Te[y]=arguments[y];if(T.serialize&&!T.asObject&&w(Te,this._serialize,this.serializers,this._stdErrSerialize),T.asObject?ve.call(ze,g(this,G,Te,ue)):ve.apply(ze,Te),T.transmit){const E=T.transmit.level||M.level,Y=o.levels.values[E],ce=o.levels.values[G];if(ce<Y)return;L(this,{ts:ue,methodLevel:G,methodValue:ce,transmitLevel:E,transmitValue:o.levels.values[T.transmit.level||M.level],send:T.transmit.send,val:M.levelVal},Te)}}}(M[G]))}function g(T,M,G,ve){T._serialize&&w(G,T._serialize,T.serializers,T._stdErrSerialize);const re=G.slice();let ue=re[0];const Te={};ve&&(Te.time=ve),Te.level=o.levels.values[M];let ze=(T._childLevel|0)+1;if(ze<1&&(ze=1),ue!==null&&typeof ue=="object"){for(;ze--&&typeof re[0]=="object";)Object.assign(Te,re.shift());ue=re.length?c(re.shift(),re):void 0}else typeof ue=="string"&&(ue=c(re.shift(),re));return ue!==void 0&&(Te.msg=ue),Te}function w(T,M,G,ve){for(const re in T)if(ve&&T[re]instanceof Error)T[re]=o.stdSerializers.err(T[re]);else if(typeof T[re]=="object"&&!Array.isArray(T[re]))for(const ue in T[re])M&&M.indexOf(ue)>-1&&ue in G&&(T[re][ue]=G[ue](T[re][ue]))}function S(T,M,G){return function(){const ve=new Array(1+arguments.length);ve[0]=M;for(var re=1;re<ve.length;re++)ve[re]=arguments[re-1];return T[G].apply(this,ve)}}function L(T,M,G){const ve=M.send,re=M.ts,ue=M.methodLevel,Te=M.methodValue,ze=M.val,y=T._logEvent.bindings;w(G,T._serialize||Object.keys(T.serializers),T.serializers,T._stdErrSerialize===void 0?!0:T._stdErrSerialize),T._logEvent.ts=re,T._logEvent.messages=G.filter(function(E){return y.indexOf(E)===-1}),T._logEvent.level.label=ue,T._logEvent.level.value=Te,ve(ue,T._logEvent,ze),T._logEvent=H(y)}function H(T){return{ts:0,messages:[],bindings:T||[],level:{label:"",value:0}}}function B(T){const M={type:T.constructor.name,msg:T.message,stack:T.stack};for(const G in T)M[G]===void 0&&(M[G]=T[G]);return M}function K(T){return typeof T.timestamp=="function"?T.timestamp:T.timestamp===!1?Ee:ge}function q(){return{}}function W(T){return T}function ie(){}function Ee(){return!1}function ge(){return Date.now()}function pe(){return Math.round(Date.now()/1e3)}function he(){return new Date(Date.now()).toISOString()}function le(){function T(M){return typeof M<"u"&&M}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return T(self)||T(window)||T(this)||{}}}return rc}var Hi={},Zh;function lf(){return Zh||(Zh=1,Object.defineProperty(Hi,"__esModule",{value:!0}),Hi.PINO_CUSTOM_CONTEXT_KEY=Hi.PINO_LOGGER_DEFAULTS=void 0,Hi.PINO_LOGGER_DEFAULTS={level:"info"},Hi.PINO_CUSTOM_CONTEXT_KEY="custom_context"),Hi}var er={},el;function T1(){if(el)return er;el=1,Object.defineProperty(er,"__esModule",{value:!0}),er.generateChildLogger=er.formatChildLoggerContext=er.getLoggerContext=er.setBrowserLoggerContext=er.getBrowserLoggerContext=er.getDefaultLoggerOptions=void 0;const c=lf();function r(g){return Object.assign(Object.assign({},g),{level:(g==null?void 0:g.level)||c.PINO_LOGGER_DEFAULTS.level})}er.getDefaultLoggerOptions=r;function i(g,w=c.PINO_CUSTOM_CONTEXT_KEY){return g[w]||""}er.getBrowserLoggerContext=i;function n(g,w,S=c.PINO_CUSTOM_CONTEXT_KEY){return g[S]=w,g}er.setBrowserLoggerContext=n;function o(g,w=c.PINO_CUSTOM_CONTEXT_KEY){let S="";return typeof g.bindings>"u"?S=i(g,w):S=g.bindings().context||"",S}er.getLoggerContext=o;function h(g,w,S=c.PINO_CUSTOM_CONTEXT_KEY){const L=o(g,S);return L.trim()?`${L}/${w}`:w}er.formatChildLoggerContext=h;function p(g,w,S=c.PINO_CUSTOM_CONTEXT_KEY){const L=h(g,w,S),H=g.child({context:L});return n(H,L,S)}return er.generateChildLogger=p,er}(function(c){Object.defineProperty(c,"__esModule",{value:!0}),c.pino=void 0;const r=Pi,i=r.__importDefault(C1());Object.defineProperty(c,"pino",{enumerable:!0,get:function(){return i.default}}),r.__exportStar(lf(),c),r.__exportStar(T1(),c)})(Ce);class N1 extends ki{constructor(r){super(),this.opts=r,this.protocol="wc",this.version=2}}class L1 extends ki{constructor(r,i){super(),this.core=r,this.logger=i,this.records=new Map}}class F1{constructor(r,i){this.logger=r,this.core=i}}let D1=class extends ki{constructor(r,i){super(),this.relayer=r,this.logger=i}},$1=class extends ki{constructor(r){super()}},q1=class{constructor(r,i,n,o){this.core=r,this.logger=i,this.name=n}};class M1 extends ki{constructor(r,i){super(),this.relayer=r,this.logger=i}}let j1=class extends ki{constructor(r,i){super(),this.core=r,this.logger=i}},z1=class{constructor(r,i){this.projectId=r,this.logger=i}},U1=class{constructor(r){this.opts=r,this.protocol="wc",this.version=2}},H1=class{constructor(r){this.client=r}};const k1=c=>JSON.stringify(c,(r,i)=>typeof i=="bigint"?i.toString()+"n":i),B1=c=>{const r=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,i=c.replace(r,'$1"$2n"$3');return JSON.parse(i,(n,o)=>typeof o=="string"&&o.match(/^\d+n$/)?BigInt(o.substring(0,o.length-1)):o)};function Ic(c){if(typeof c!="string")throw new Error(`Cannot safe json parse value of type ${typeof c}`);try{return B1(c)}catch{return c}}function Zs(c){return typeof c=="string"?c:k1(c)||""}var Pc={},ff={};(function(c){Object.defineProperty(c,"__esModule",{value:!0});var r=Em,i=Vl;c.DIGEST_LENGTH=64,c.BLOCK_SIZE=128;var n=function(){function g(){this.digestLength=c.DIGEST_LENGTH,this.blockSize=c.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return g.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},g.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},g.prototype.clean=function(){i.wipe(this._buffer),i.wipe(this._tempHi),i.wipe(this._tempLo),this.reset()},g.prototype.update=function(w,S){if(S===void 0&&(S=w.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var L=0;if(this._bytesHashed+=S,this._bufferLength>0){for(;this._bufferLength<c.BLOCK_SIZE&&S>0;)this._buffer[this._bufferLength++]=w[L++],S--;this._bufferLength===this.blockSize&&(h(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(S>=this.blockSize&&(L=h(this._tempHi,this._tempLo,this._stateHi,this._stateLo,w,L,S),S%=this.blockSize);S>0;)this._buffer[this._bufferLength++]=w[L++],S--;return this},g.prototype.finish=function(w){if(!this._finished){var S=this._bytesHashed,L=this._bufferLength,H=S/536870912|0,B=S<<3,K=S%128<112?128:256;this._buffer[L]=128;for(var q=L+1;q<K-8;q++)this._buffer[q]=0;r.writeUint32BE(H,this._buffer,K-8),r.writeUint32BE(B,this._buffer,K-4),h(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,K),this._finished=!0}for(var q=0;q<this.digestLength/8;q++)r.writeUint32BE(this._stateHi[q],w,q*8),r.writeUint32BE(this._stateLo[q],w,q*8+4);return this},g.prototype.digest=function(){var w=new Uint8Array(this.digestLength);return this.finish(w),w},g.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},g.prototype.restoreState=function(w){return this._stateHi.set(w.stateHi),this._stateLo.set(w.stateLo),this._bufferLength=w.bufferLength,w.buffer&&this._buffer.set(w.buffer),this._bytesHashed=w.bytesHashed,this._finished=!1,this},g.prototype.cleanSavedState=function(w){i.wipe(w.stateHi),i.wipe(w.stateLo),w.buffer&&i.wipe(w.buffer),w.bufferLength=0,w.bytesHashed=0},g}();c.SHA512=n;var o=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function h(g,w,S,L,H,B,K){for(var q=S[0],W=S[1],ie=S[2],Ee=S[3],ge=S[4],pe=S[5],he=S[6],le=S[7],T=L[0],M=L[1],G=L[2],ve=L[3],re=L[4],ue=L[5],Te=L[6],ze=L[7],y,E,Y,ce,k,j,U,V;K>=128;){for(var Qe=0;Qe<16;Qe++){var Be=8*Qe+B;g[Qe]=r.readUint32BE(H,Be),w[Qe]=r.readUint32BE(H,Be+4)}for(var Qe=0;Qe<80;Qe++){var qr=q,xe=W,It=ie,C=Ee,R=ge,O=pe,u=he,b=le,ee=T,fe=M,_e=G,Ne=ve,Fe=re,Se=ue,Pt=Te,wt=ze;if(y=le,E=ze,k=E&65535,j=E>>>16,U=y&65535,V=y>>>16,y=(ge>>>14|re<<32-14)^(ge>>>18|re<<32-18)^(re>>>41-32|ge<<32-(41-32)),E=(re>>>14|ge<<32-14)^(re>>>18|ge<<32-18)^(ge>>>41-32|re<<32-(41-32)),k+=E&65535,j+=E>>>16,U+=y&65535,V+=y>>>16,y=ge&pe^~ge&he,E=re&ue^~re&Te,k+=E&65535,j+=E>>>16,U+=y&65535,V+=y>>>16,y=o[Qe*2],E=o[Qe*2+1],k+=E&65535,j+=E>>>16,U+=y&65535,V+=y>>>16,y=g[Qe%16],E=w[Qe%16],k+=E&65535,j+=E>>>16,U+=y&65535,V+=y>>>16,j+=k>>>16,U+=j>>>16,V+=U>>>16,Y=U&65535|V<<16,ce=k&65535|j<<16,y=Y,E=ce,k=E&65535,j=E>>>16,U=y&65535,V=y>>>16,y=(q>>>28|T<<32-28)^(T>>>34-32|q<<32-(34-32))^(T>>>39-32|q<<32-(39-32)),E=(T>>>28|q<<32-28)^(q>>>34-32|T<<32-(34-32))^(q>>>39-32|T<<32-(39-32)),k+=E&65535,j+=E>>>16,U+=y&65535,V+=y>>>16,y=q&W^q&ie^W&ie,E=T&M^T&G^M&G,k+=E&65535,j+=E>>>16,U+=y&65535,V+=y>>>16,j+=k>>>16,U+=j>>>16,V+=U>>>16,b=U&65535|V<<16,wt=k&65535|j<<16,y=C,E=Ne,k=E&65535,j=E>>>16,U=y&65535,V=y>>>16,y=Y,E=ce,k+=E&65535,j+=E>>>16,U+=y&65535,V+=y>>>16,j+=k>>>16,U+=j>>>16,V+=U>>>16,C=U&65535|V<<16,Ne=k&65535|j<<16,W=qr,ie=xe,Ee=It,ge=C,pe=R,he=O,le=u,q=b,M=ee,G=fe,ve=_e,re=Ne,ue=Fe,Te=Se,ze=Pt,T=wt,Qe%16===15)for(var Be=0;Be<16;Be++)y=g[Be],E=w[Be],k=E&65535,j=E>>>16,U=y&65535,V=y>>>16,y=g[(Be+9)%16],E=w[(Be+9)%16],k+=E&65535,j+=E>>>16,U+=y&65535,V+=y>>>16,Y=g[(Be+1)%16],ce=w[(Be+1)%16],y=(Y>>>1|ce<<32-1)^(Y>>>8|ce<<32-8)^Y>>>7,E=(ce>>>1|Y<<32-1)^(ce>>>8|Y<<32-8)^(ce>>>7|Y<<32-7),k+=E&65535,j+=E>>>16,U+=y&65535,V+=y>>>16,Y=g[(Be+14)%16],ce=w[(Be+14)%16],y=(Y>>>19|ce<<32-19)^(ce>>>61-32|Y<<32-(61-32))^Y>>>6,E=(ce>>>19|Y<<32-19)^(Y>>>61-32|ce<<32-(61-32))^(ce>>>6|Y<<32-6),k+=E&65535,j+=E>>>16,U+=y&65535,V+=y>>>16,j+=k>>>16,U+=j>>>16,V+=U>>>16,g[Be]=U&65535|V<<16,w[Be]=k&65535|j<<16}y=q,E=T,k=E&65535,j=E>>>16,U=y&65535,V=y>>>16,y=S[0],E=L[0],k+=E&65535,j+=E>>>16,U+=y&65535,V+=y>>>16,j+=k>>>16,U+=j>>>16,V+=U>>>16,S[0]=q=U&65535|V<<16,L[0]=T=k&65535|j<<16,y=W,E=M,k=E&65535,j=E>>>16,U=y&65535,V=y>>>16,y=S[1],E=L[1],k+=E&65535,j+=E>>>16,U+=y&65535,V+=y>>>16,j+=k>>>16,U+=j>>>16,V+=U>>>16,S[1]=W=U&65535|V<<16,L[1]=M=k&65535|j<<16,y=ie,E=G,k=E&65535,j=E>>>16,U=y&65535,V=y>>>16,y=S[2],E=L[2],k+=E&65535,j+=E>>>16,U+=y&65535,V+=y>>>16,j+=k>>>16,U+=j>>>16,V+=U>>>16,S[2]=ie=U&65535|V<<16,L[2]=G=k&65535|j<<16,y=Ee,E=ve,k=E&65535,j=E>>>16,U=y&65535,V=y>>>16,y=S[3],E=L[3],k+=E&65535,j+=E>>>16,U+=y&65535,V+=y>>>16,j+=k>>>16,U+=j>>>16,V+=U>>>16,S[3]=Ee=U&65535|V<<16,L[3]=ve=k&65535|j<<16,y=ge,E=re,k=E&65535,j=E>>>16,U=y&65535,V=y>>>16,y=S[4],E=L[4],k+=E&65535,j+=E>>>16,U+=y&65535,V+=y>>>16,j+=k>>>16,U+=j>>>16,V+=U>>>16,S[4]=ge=U&65535|V<<16,L[4]=re=k&65535|j<<16,y=pe,E=ue,k=E&65535,j=E>>>16,U=y&65535,V=y>>>16,y=S[5],E=L[5],k+=E&65535,j+=E>>>16,U+=y&65535,V+=y>>>16,j+=k>>>16,U+=j>>>16,V+=U>>>16,S[5]=pe=U&65535|V<<16,L[5]=ue=k&65535|j<<16,y=he,E=Te,k=E&65535,j=E>>>16,U=y&65535,V=y>>>16,y=S[6],E=L[6],k+=E&65535,j+=E>>>16,U+=y&65535,V+=y>>>16,j+=k>>>16,U+=j>>>16,V+=U>>>16,S[6]=he=U&65535|V<<16,L[6]=Te=k&65535|j<<16,y=le,E=ze,k=E&65535,j=E>>>16,U=y&65535,V=y>>>16,y=S[7],E=L[7],k+=E&65535,j+=E>>>16,U+=y&65535,V+=y>>>16,j+=k>>>16,U+=j>>>16,V+=U>>>16,S[7]=le=U&65535|V<<16,L[7]=ze=k&65535|j<<16,B+=128,K-=128}return B}function p(g){var w=new n;w.update(g);var S=w.digest();return w.clean(),S}c.hash=p})(ff);(function(c){Object.defineProperty(c,"__esModule",{value:!0}),c.convertSecretKeyToX25519=c.convertPublicKeyToX25519=c.verify=c.sign=c.extractPublicKeyFromSecretKey=c.generateKeyPair=c.generateKeyPairFromSeed=c.SEED_LENGTH=c.SECRET_KEY_LENGTH=c.PUBLIC_KEY_LENGTH=c.SIGNATURE_LENGTH=void 0;const r=Kl,i=ff,n=Vl;c.SIGNATURE_LENGTH=64,c.PUBLIC_KEY_LENGTH=32,c.SECRET_KEY_LENGTH=64,c.SEED_LENGTH=32;function o(C){const R=new Float64Array(16);if(C)for(let O=0;O<C.length;O++)R[O]=C[O];return R}const h=new Uint8Array(32);h[0]=9;const p=o(),g=o([1]),w=o([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),S=o([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),L=o([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),H=o([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),B=o([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function K(C,R){for(let O=0;O<16;O++)C[O]=R[O]|0}function q(C){let R=1;for(let O=0;O<16;O++){let u=C[O]+R+65535;R=Math.floor(u/65536),C[O]=u-R*65536}C[0]+=R-1+37*(R-1)}function W(C,R,O){const u=~(O-1);for(let b=0;b<16;b++){const ee=u&(C[b]^R[b]);C[b]^=ee,R[b]^=ee}}function ie(C,R){const O=o(),u=o();for(let b=0;b<16;b++)u[b]=R[b];q(u),q(u),q(u);for(let b=0;b<2;b++){O[0]=u[0]-65517;for(let fe=1;fe<15;fe++)O[fe]=u[fe]-65535-(O[fe-1]>>16&1),O[fe-1]&=65535;O[15]=u[15]-32767-(O[14]>>16&1);const ee=O[15]>>16&1;O[14]&=65535,W(u,O,1-ee)}for(let b=0;b<16;b++)C[2*b]=u[b]&255,C[2*b+1]=u[b]>>8}function Ee(C,R){let O=0;for(let u=0;u<32;u++)O|=C[u]^R[u];return(1&O-1>>>8)-1}function ge(C,R){const O=new Uint8Array(32),u=new Uint8Array(32);return ie(O,C),ie(u,R),Ee(O,u)}function pe(C){const R=new Uint8Array(32);return ie(R,C),R[0]&1}function he(C,R){for(let O=0;O<16;O++)C[O]=R[2*O]+(R[2*O+1]<<8);C[15]&=32767}function le(C,R,O){for(let u=0;u<16;u++)C[u]=R[u]+O[u]}function T(C,R,O){for(let u=0;u<16;u++)C[u]=R[u]-O[u]}function M(C,R,O){let u,b,ee=0,fe=0,_e=0,Ne=0,Fe=0,Se=0,Pt=0,wt=0,at=0,$e=0,Xe=0,Ze=0,ct=0,Ue=0,et=0,Le=0,Ve=0,lt=0,Me=0,St=0,Dt=0,Ut=0,Ht=0,Mt=0,Wt=0,rr=0,Mr=0,Jt=0,Vr=0,hi=0,Oi=0,ft=O[0],it=O[1],pt=O[2],dt=O[3],ut=O[4],st=O[5],Ot=O[6],At=O[7],gt=O[8],Rt=O[9],vt=O[10],_t=O[11],yt=O[12],Ye=O[13],Ct=O[14],Tt=O[15];u=R[0],ee+=u*ft,fe+=u*it,_e+=u*pt,Ne+=u*dt,Fe+=u*ut,Se+=u*st,Pt+=u*Ot,wt+=u*At,at+=u*gt,$e+=u*Rt,Xe+=u*vt,Ze+=u*_t,ct+=u*yt,Ue+=u*Ye,et+=u*Ct,Le+=u*Tt,u=R[1],fe+=u*ft,_e+=u*it,Ne+=u*pt,Fe+=u*dt,Se+=u*ut,Pt+=u*st,wt+=u*Ot,at+=u*At,$e+=u*gt,Xe+=u*Rt,Ze+=u*vt,ct+=u*_t,Ue+=u*yt,et+=u*Ye,Le+=u*Ct,Ve+=u*Tt,u=R[2],_e+=u*ft,Ne+=u*it,Fe+=u*pt,Se+=u*dt,Pt+=u*ut,wt+=u*st,at+=u*Ot,$e+=u*At,Xe+=u*gt,Ze+=u*Rt,ct+=u*vt,Ue+=u*_t,et+=u*yt,Le+=u*Ye,Ve+=u*Ct,lt+=u*Tt,u=R[3],Ne+=u*ft,Fe+=u*it,Se+=u*pt,Pt+=u*dt,wt+=u*ut,at+=u*st,$e+=u*Ot,Xe+=u*At,Ze+=u*gt,ct+=u*Rt,Ue+=u*vt,et+=u*_t,Le+=u*yt,Ve+=u*Ye,lt+=u*Ct,Me+=u*Tt,u=R[4],Fe+=u*ft,Se+=u*it,Pt+=u*pt,wt+=u*dt,at+=u*ut,$e+=u*st,Xe+=u*Ot,Ze+=u*At,ct+=u*gt,Ue+=u*Rt,et+=u*vt,Le+=u*_t,Ve+=u*yt,lt+=u*Ye,Me+=u*Ct,St+=u*Tt,u=R[5],Se+=u*ft,Pt+=u*it,wt+=u*pt,at+=u*dt,$e+=u*ut,Xe+=u*st,Ze+=u*Ot,ct+=u*At,Ue+=u*gt,et+=u*Rt,Le+=u*vt,Ve+=u*_t,lt+=u*yt,Me+=u*Ye,St+=u*Ct,Dt+=u*Tt,u=R[6],Pt+=u*ft,wt+=u*it,at+=u*pt,$e+=u*dt,Xe+=u*ut,Ze+=u*st,ct+=u*Ot,Ue+=u*At,et+=u*gt,Le+=u*Rt,Ve+=u*vt,lt+=u*_t,Me+=u*yt,St+=u*Ye,Dt+=u*Ct,Ut+=u*Tt,u=R[7],wt+=u*ft,at+=u*it,$e+=u*pt,Xe+=u*dt,Ze+=u*ut,ct+=u*st,Ue+=u*Ot,et+=u*At,Le+=u*gt,Ve+=u*Rt,lt+=u*vt,Me+=u*_t,St+=u*yt,Dt+=u*Ye,Ut+=u*Ct,Ht+=u*Tt,u=R[8],at+=u*ft,$e+=u*it,Xe+=u*pt,Ze+=u*dt,ct+=u*ut,Ue+=u*st,et+=u*Ot,Le+=u*At,Ve+=u*gt,lt+=u*Rt,Me+=u*vt,St+=u*_t,Dt+=u*yt,Ut+=u*Ye,Ht+=u*Ct,Mt+=u*Tt,u=R[9],$e+=u*ft,Xe+=u*it,Ze+=u*pt,ct+=u*dt,Ue+=u*ut,et+=u*st,Le+=u*Ot,Ve+=u*At,lt+=u*gt,Me+=u*Rt,St+=u*vt,Dt+=u*_t,Ut+=u*yt,Ht+=u*Ye,Mt+=u*Ct,Wt+=u*Tt,u=R[10],Xe+=u*ft,Ze+=u*it,ct+=u*pt,Ue+=u*dt,et+=u*ut,Le+=u*st,Ve+=u*Ot,lt+=u*At,Me+=u*gt,St+=u*Rt,Dt+=u*vt,Ut+=u*_t,Ht+=u*yt,Mt+=u*Ye,Wt+=u*Ct,rr+=u*Tt,u=R[11],Ze+=u*ft,ct+=u*it,Ue+=u*pt,et+=u*dt,Le+=u*ut,Ve+=u*st,lt+=u*Ot,Me+=u*At,St+=u*gt,Dt+=u*Rt,Ut+=u*vt,Ht+=u*_t,Mt+=u*yt,Wt+=u*Ye,rr+=u*Ct,Mr+=u*Tt,u=R[12],ct+=u*ft,Ue+=u*it,et+=u*pt,Le+=u*dt,Ve+=u*ut,lt+=u*st,Me+=u*Ot,St+=u*At,Dt+=u*gt,Ut+=u*Rt,Ht+=u*vt,Mt+=u*_t,Wt+=u*yt,rr+=u*Ye,Mr+=u*Ct,Jt+=u*Tt,u=R[13],Ue+=u*ft,et+=u*it,Le+=u*pt,Ve+=u*dt,lt+=u*ut,Me+=u*st,St+=u*Ot,Dt+=u*At,Ut+=u*gt,Ht+=u*Rt,Mt+=u*vt,Wt+=u*_t,rr+=u*yt,Mr+=u*Ye,Jt+=u*Ct,Vr+=u*Tt,u=R[14],et+=u*ft,Le+=u*it,Ve+=u*pt,lt+=u*dt,Me+=u*ut,St+=u*st,Dt+=u*Ot,Ut+=u*At,Ht+=u*gt,Mt+=u*Rt,Wt+=u*vt,rr+=u*_t,Mr+=u*yt,Jt+=u*Ye,Vr+=u*Ct,hi+=u*Tt,u=R[15],Le+=u*ft,Ve+=u*it,lt+=u*pt,Me+=u*dt,St+=u*ut,Dt+=u*st,Ut+=u*Ot,Ht+=u*At,Mt+=u*gt,Wt+=u*Rt,rr+=u*vt,Mr+=u*_t,Jt+=u*yt,Vr+=u*Ye,hi+=u*Ct,Oi+=u*Tt,ee+=38*Ve,fe+=38*lt,_e+=38*Me,Ne+=38*St,Fe+=38*Dt,Se+=38*Ut,Pt+=38*Ht,wt+=38*Mt,at+=38*Wt,$e+=38*rr,Xe+=38*Mr,Ze+=38*Jt,ct+=38*Vr,Ue+=38*hi,et+=38*Oi,b=1,u=ee+b+65535,b=Math.floor(u/65536),ee=u-b*65536,u=fe+b+65535,b=Math.floor(u/65536),fe=u-b*65536,u=_e+b+65535,b=Math.floor(u/65536),_e=u-b*65536,u=Ne+b+65535,b=Math.floor(u/65536),Ne=u-b*65536,u=Fe+b+65535,b=Math.floor(u/65536),Fe=u-b*65536,u=Se+b+65535,b=Math.floor(u/65536),Se=u-b*65536,u=Pt+b+65535,b=Math.floor(u/65536),Pt=u-b*65536,u=wt+b+65535,b=Math.floor(u/65536),wt=u-b*65536,u=at+b+65535,b=Math.floor(u/65536),at=u-b*65536,u=$e+b+65535,b=Math.floor(u/65536),$e=u-b*65536,u=Xe+b+65535,b=Math.floor(u/65536),Xe=u-b*65536,u=Ze+b+65535,b=Math.floor(u/65536),Ze=u-b*65536,u=ct+b+65535,b=Math.floor(u/65536),ct=u-b*65536,u=Ue+b+65535,b=Math.floor(u/65536),Ue=u-b*65536,u=et+b+65535,b=Math.floor(u/65536),et=u-b*65536,u=Le+b+65535,b=Math.floor(u/65536),Le=u-b*65536,ee+=b-1+37*(b-1),b=1,u=ee+b+65535,b=Math.floor(u/65536),ee=u-b*65536,u=fe+b+65535,b=Math.floor(u/65536),fe=u-b*65536,u=_e+b+65535,b=Math.floor(u/65536),_e=u-b*65536,u=Ne+b+65535,b=Math.floor(u/65536),Ne=u-b*65536,u=Fe+b+65535,b=Math.floor(u/65536),Fe=u-b*65536,u=Se+b+65535,b=Math.floor(u/65536),Se=u-b*65536,u=Pt+b+65535,b=Math.floor(u/65536),Pt=u-b*65536,u=wt+b+65535,b=Math.floor(u/65536),wt=u-b*65536,u=at+b+65535,b=Math.floor(u/65536),at=u-b*65536,u=$e+b+65535,b=Math.floor(u/65536),$e=u-b*65536,u=Xe+b+65535,b=Math.floor(u/65536),Xe=u-b*65536,u=Ze+b+65535,b=Math.floor(u/65536),Ze=u-b*65536,u=ct+b+65535,b=Math.floor(u/65536),ct=u-b*65536,u=Ue+b+65535,b=Math.floor(u/65536),Ue=u-b*65536,u=et+b+65535,b=Math.floor(u/65536),et=u-b*65536,u=Le+b+65535,b=Math.floor(u/65536),Le=u-b*65536,ee+=b-1+37*(b-1),C[0]=ee,C[1]=fe,C[2]=_e,C[3]=Ne,C[4]=Fe,C[5]=Se,C[6]=Pt,C[7]=wt,C[8]=at,C[9]=$e,C[10]=Xe,C[11]=Ze,C[12]=ct,C[13]=Ue,C[14]=et,C[15]=Le}function G(C,R){M(C,R,R)}function ve(C,R){const O=o();let u;for(u=0;u<16;u++)O[u]=R[u];for(u=253;u>=0;u--)G(O,O),u!==2&&u!==4&&M(O,O,R);for(u=0;u<16;u++)C[u]=O[u]}function re(C,R){const O=o();let u;for(u=0;u<16;u++)O[u]=R[u];for(u=250;u>=0;u--)G(O,O),u!==1&&M(O,O,R);for(u=0;u<16;u++)C[u]=O[u]}function ue(C,R){const O=o(),u=o(),b=o(),ee=o(),fe=o(),_e=o(),Ne=o(),Fe=o(),Se=o();T(O,C[1],C[0]),T(Se,R[1],R[0]),M(O,O,Se),le(u,C[0],C[1]),le(Se,R[0],R[1]),M(u,u,Se),M(b,C[3],R[3]),M(b,b,S),M(ee,C[2],R[2]),le(ee,ee,ee),T(fe,u,O),T(_e,ee,b),le(Ne,ee,b),le(Fe,u,O),M(C[0],fe,_e),M(C[1],Fe,Ne),M(C[2],Ne,_e),M(C[3],fe,Fe)}function Te(C,R,O){for(let u=0;u<4;u++)W(C[u],R[u],O)}function ze(C,R){const O=o(),u=o(),b=o();ve(b,R[2]),M(O,R[0],b),M(u,R[1],b),ie(C,u),C[31]^=pe(O)<<7}function y(C,R,O){K(C[0],p),K(C[1],g),K(C[2],g),K(C[3],p);for(let u=255;u>=0;--u){const b=O[u/8|0]>>(u&7)&1;Te(C,R,b),ue(R,C),ue(C,C),Te(C,R,b)}}function E(C,R){const O=[o(),o(),o(),o()];K(O[0],L),K(O[1],H),K(O[2],g),M(O[3],L,H),y(C,O,R)}function Y(C){if(C.length!==c.SEED_LENGTH)throw new Error(`ed25519: seed must be ${c.SEED_LENGTH} bytes`);const R=(0,i.hash)(C);R[0]&=248,R[31]&=127,R[31]|=64;const O=new Uint8Array(32),u=[o(),o(),o(),o()];E(u,R),ze(O,u);const b=new Uint8Array(64);return b.set(C),b.set(O,32),{publicKey:O,secretKey:b}}c.generateKeyPairFromSeed=Y;function ce(C){const R=(0,r.randomBytes)(32,C),O=Y(R);return(0,n.wipe)(R),O}c.generateKeyPair=ce;function k(C){if(C.length!==c.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${c.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(C.subarray(32))}c.extractPublicKeyFromSecretKey=k;const j=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function U(C,R){let O,u,b,ee;for(u=63;u>=32;--u){for(O=0,b=u-32,ee=u-12;b<ee;++b)R[b]+=O-16*R[u]*j[b-(u-32)],O=Math.floor((R[b]+128)/256),R[b]-=O*256;R[b]+=O,R[u]=0}for(O=0,b=0;b<32;b++)R[b]+=O-(R[31]>>4)*j[b],O=R[b]>>8,R[b]&=255;for(b=0;b<32;b++)R[b]-=O*j[b];for(u=0;u<32;u++)R[u+1]+=R[u]>>8,C[u]=R[u]&255}function V(C){const R=new Float64Array(64);for(let O=0;O<64;O++)R[O]=C[O];for(let O=0;O<64;O++)C[O]=0;U(C,R)}function Qe(C,R){const O=new Float64Array(64),u=[o(),o(),o(),o()],b=(0,i.hash)(C.subarray(0,32));b[0]&=248,b[31]&=127,b[31]|=64;const ee=new Uint8Array(64);ee.set(b.subarray(32),32);const fe=new i.SHA512;fe.update(ee.subarray(32)),fe.update(R);const _e=fe.digest();fe.clean(),V(_e),E(u,_e),ze(ee,u),fe.reset(),fe.update(ee.subarray(0,32)),fe.update(C.subarray(32)),fe.update(R);const Ne=fe.digest();V(Ne);for(let Fe=0;Fe<32;Fe++)O[Fe]=_e[Fe];for(let Fe=0;Fe<32;Fe++)for(let Se=0;Se<32;Se++)O[Fe+Se]+=Ne[Fe]*b[Se];return U(ee.subarray(32),O),ee}c.sign=Qe;function Be(C,R){const O=o(),u=o(),b=o(),ee=o(),fe=o(),_e=o(),Ne=o();return K(C[2],g),he(C[1],R),G(b,C[1]),M(ee,b,w),T(b,b,C[2]),le(ee,C[2],ee),G(fe,ee),G(_e,fe),M(Ne,_e,fe),M(O,Ne,b),M(O,O,ee),re(O,O),M(O,O,b),M(O,O,ee),M(O,O,ee),M(C[0],O,ee),G(u,C[0]),M(u,u,ee),ge(u,b)&&M(C[0],C[0],B),G(u,C[0]),M(u,u,ee),ge(u,b)?-1:(pe(C[0])===R[31]>>7&&T(C[0],p,C[0]),M(C[3],C[0],C[1]),0)}function qr(C,R,O){const u=new Uint8Array(32),b=[o(),o(),o(),o()],ee=[o(),o(),o(),o()];if(O.length!==c.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${c.SIGNATURE_LENGTH} bytes`);if(Be(ee,C))return!1;const fe=new i.SHA512;fe.update(O.subarray(0,32)),fe.update(C),fe.update(R);const _e=fe.digest();return V(_e),y(b,ee,_e),E(ee,O.subarray(32)),ue(b,ee),ze(u,b),!Ee(O,u)}c.verify=qr;function xe(C){let R=[o(),o(),o(),o()];if(Be(R,C))throw new Error("Ed25519: invalid public key");let O=o(),u=o(),b=R[1];le(O,g,b),T(u,g,b),ve(u,u),M(O,O,u);let ee=new Uint8Array(32);return ie(ee,O),ee}c.convertPublicKeyToX25519=xe;function It(C){const R=(0,i.hash)(C.subarray(0,32));R[0]&=248,R[31]&=127,R[31]|=64;const O=new Uint8Array(R.subarray(0,32));return(0,n.wipe)(R),O}c.convertSecretKeyToX25519=It})(Pc);const V1="EdDSA",K1="JWT",pf=".",df="base64url",G1="utf8",W1="utf8",J1=":",Q1="did",Y1="key",tl="base58btc",X1="z",Z1="K36",ew=32;function vo(c){return wo(bc(Zs(c),G1),df)}function gf(c){const r=bc(Z1,tl),i=X1+wo(xm([r,c]),tl);return[Q1,Y1,i].join(J1)}function tw(c){return wo(c,df)}function rw(c){return bc([vo(c.header),vo(c.payload)].join(pf),W1)}function iw(c){return[vo(c.header),vo(c.payload),tw(c.signature)].join(pf)}function rl(c=Kl.randomBytes(ew)){return Pc.generateKeyPairFromSeed(c)}async function sw(c,r,i,n,o=se.fromMiliseconds(Date.now())){const h={alg:V1,typ:K1},p=gf(n.publicKey),g=o+i,w={iss:p,sub:c,aud:r,iat:o,exp:g},S=rw({header:h,payload:w}),L=Pc.sign(n.secretKey,S);return iw({header:h,payload:w,signature:L})}const nw="PARSE_ERROR",ow="INVALID_REQUEST",aw="METHOD_NOT_FOUND",cw="INVALID_PARAMS",vf="INTERNAL_ERROR",Sc="SERVER_ERROR",uw=[-32700,-32600,-32601,-32602,-32603],Ys={[nw]:{code:-32700,message:"Parse error"},[ow]:{code:-32600,message:"Invalid Request"},[aw]:{code:-32601,message:"Method not found"},[cw]:{code:-32602,message:"Invalid params"},[vf]:{code:-32603,message:"Internal error"},[Sc]:{code:-32e3,message:"Server error"}},yf=Sc;function hw(c){return uw.includes(c)}function il(c){return Object.keys(Ys).includes(c)?Ys[c]:Ys[yf]}function lw(c){const r=Object.values(Ys).find(i=>i.code===c);return r||Ys[yf]}function mf(c,r,i){return c.message.includes("getaddrinfo ENOTFOUND")||c.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${i} RPC url at ${r}`):c}var wf={},ii={},sl;function fw(){if(sl)return ii;sl=1,Object.defineProperty(ii,"__esModule",{value:!0}),ii.isBrowserCryptoAvailable=ii.getSubtleCrypto=ii.getBrowerCrypto=void 0;function c(){return(hr===null||hr===void 0?void 0:hr.crypto)||(hr===null||hr===void 0?void 0:hr.msCrypto)||{}}ii.getBrowerCrypto=c;function r(){const n=c();return n.subtle||n.webkitSubtle}ii.getSubtleCrypto=r;function i(){return!!c()&&!!r()}return ii.isBrowserCryptoAvailable=i,ii}var si={},nl;function pw(){if(nl)return si;nl=1,Object.defineProperty(si,"__esModule",{value:!0}),si.isBrowser=si.isNode=si.isReactNative=void 0;function c(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}si.isReactNative=c;function r(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}si.isNode=r;function i(){return!c()&&!r()}return si.isBrowser=i,si}(function(c){Object.defineProperty(c,"__esModule",{value:!0});const r=Pi;r.__exportStar(fw(),c),r.__exportStar(pw(),c)})(wf);function Oc(c=3){const r=Date.now()*Math.pow(10,c),i=Math.floor(Math.random()*Math.pow(10,c));return r+i}function _f(c=6){return BigInt(Oc(c))}function vs(c,r,i){return{id:i||Oc(),jsonrpc:"2.0",method:c,params:r}}function Ac(c,r){return{id:c,jsonrpc:"2.0",result:r}}function Eo(c,r,i){return{id:c,jsonrpc:"2.0",error:dw(r,i)}}function dw(c,r){return typeof c>"u"?il(vf):(typeof c=="string"&&(c=Object.assign(Object.assign({},il(Sc)),{message:c})),typeof r<"u"&&(c.data=r),hw(c.code)&&(c=lw(c.code)),c)}class gw{}class vw extends gw{constructor(){super()}}class yw extends vw{constructor(r){super()}}const mw="^https?:",ww="^wss?:";function _w(c){const r=c.match(new RegExp(/^\w+:/,"gi"));if(!(!r||!r.length))return r[0]}function bf(c,r){const i=_w(c);return typeof i>"u"?!1:new RegExp(r).test(i)}function ol(c){return bf(c,mw)}function al(c){return bf(c,ww)}function bw(c){return new RegExp("wss?://localhost(:d{2,5})?").test(c)}function Ef(c){return typeof c=="object"&&"id"in c&&"jsonrpc"in c&&c.jsonrpc==="2.0"}function Rc(c){return Ef(c)&&"method"in c}function xo(c){return Ef(c)&&(ai(c)||$r(c))}function ai(c){return"result"in c}function $r(c){return"error"in c}class ci extends yw{constructor(r){super(r),this.events=new yr.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(r),this.connection.connected&&this.registerEventListeners()}async connect(r=this.connection){await this.open(r)}async disconnect(){await this.close()}on(r,i){this.events.on(r,i)}once(r,i){this.events.once(r,i)}off(r,i){this.events.off(r,i)}removeListener(r,i){this.events.removeListener(r,i)}async request(r,i){return this.requestStrict(vs(r.method,r.params||[],r.id||_f().toString()),i)}async requestStrict(r,i){return new Promise(async(n,o)=>{if(!this.connection.connected)try{await this.open()}catch(h){o(h)}this.events.on(`${r.id}`,h=>{$r(h)?o(h.error):n(h.result)});try{await this.connection.send(r,i)}catch(h){o(h)}})}setConnection(r=this.connection){return r}onPayload(r){this.events.emit("payload",r),xo(r)?this.events.emit(`${r.id}`,r):this.events.emit("message",{type:r.method,data:r.params})}onClose(r){r&&r.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${r.code} ${r.reason?`(${r.reason})`:""}`)),this.events.emit("disconnect")}async open(r=this.connection){this.connection===r&&this.connection.connected||(this.connection.connected&&this.close(),typeof r=="string"&&(await this.connection.open(r),r=this.connection),this.connection=this.setConnection(r),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",r=>this.onPayload(r)),this.connection.on("close",r=>this.onClose(r)),this.connection.on("error",r=>this.events.emit("error",r)),this.connection.on("register_error",r=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const Ew=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),xw=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",cl=c=>c.split("?")[0],ul=10,Iw=Ew();class Pw{constructor(r){if(this.url=r,this.events=new yr.EventEmitter,this.registering=!1,!al(r))throw new Error(`Provided URL is not compatible with WebSocket connection: ${r}`);this.url=r}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(r,i){this.events.on(r,i)}once(r,i){this.events.once(r,i)}off(r,i){this.events.off(r,i)}removeListener(r,i){this.events.removeListener(r,i)}async open(r=this.url){await this.register(r)}async close(){return new Promise((r,i)=>{if(typeof this.socket>"u"){i(new Error("Connection already closed"));return}this.socket.onclose=n=>{this.onClose(n),r()},this.socket.close()})}async send(r,i){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Zs(r))}catch(n){this.onError(r.id,n)}}register(r=this.url){if(!al(r))throw new Error(`Provided URL is not compatible with WebSocket connection: ${r}`);if(this.registering){const i=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=i||this.events.listenerCount("open")>=i)&&this.events.setMaxListeners(i+1),new Promise((n,o)=>{this.events.once("register_error",h=>{this.resetMaxListeners(),o(h)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return o(new Error("WebSocket connection is missing or invalid"));n(this.socket)})})}return this.url=r,this.registering=!0,new Promise((i,n)=>{const o=wf.isReactNative()?void 0:{rejectUnauthorized:!bw(r)},h=new Iw(r,[],o);xw()?h.onerror=p=>{const g=p;n(this.emitError(g.error))}:h.on("error",p=>{n(this.emitError(p))}),h.onopen=()=>{this.onOpen(h),i(h)}})}onOpen(r){r.onmessage=i=>this.onPayload(i),r.onclose=i=>this.onClose(i),this.socket=r,this.registering=!1,this.events.emit("open")}onClose(r){this.socket=void 0,this.registering=!1,this.events.emit("close",r)}onPayload(r){if(typeof r.data>"u")return;const i=typeof r.data=="string"?Ic(r.data):r.data;this.events.emit("payload",i)}onError(r,i){const n=this.parseError(i),o=n.message||n.toString(),h=Eo(r,o);this.events.emit("payload",h)}parseError(r,i=this.url){return mf(r,cl(i),"WS")}resetMaxListeners(){this.events.getMaxListeners()>ul&&this.events.setMaxListeners(ul)}emitError(r){const i=this.parseError(new Error((r==null?void 0:r.message)||`WebSocket connection failed for host: ${cl(this.url)}`));return this.events.emit("register_error",i),i}}var yo={exports:{}};yo.exports;(function(c,r){var i=200,n="__lodash_hash_undefined__",o=1,h=2,p=9007199254740991,g="[object Arguments]",w="[object Array]",S="[object AsyncFunction]",L="[object Boolean]",H="[object Date]",B="[object Error]",K="[object Function]",q="[object GeneratorFunction]",W="[object Map]",ie="[object Number]",Ee="[object Null]",ge="[object Object]",pe="[object Promise]",he="[object Proxy]",le="[object RegExp]",T="[object Set]",M="[object String]",G="[object Symbol]",ve="[object Undefined]",re="[object WeakMap]",ue="[object ArrayBuffer]",Te="[object DataView]",ze="[object Float32Array]",y="[object Float64Array]",E="[object Int8Array]",Y="[object Int16Array]",ce="[object Int32Array]",k="[object Uint8Array]",j="[object Uint8ClampedArray]",U="[object Uint16Array]",V="[object Uint32Array]",Qe=/[\\^$.*+?()[\]{}|]/g,Be=/^\[object .+?Constructor\]$/,qr=/^(?:0|[1-9]\d*)$/,xe={};xe[ze]=xe[y]=xe[E]=xe[Y]=xe[ce]=xe[k]=xe[j]=xe[U]=xe[V]=!0,xe[g]=xe[w]=xe[ue]=xe[L]=xe[Te]=xe[H]=xe[B]=xe[K]=xe[W]=xe[ie]=xe[ge]=xe[le]=xe[T]=xe[M]=xe[re]=!1;var It=typeof hr=="object"&&hr&&hr.Object===Object&&hr,C=typeof self=="object"&&self&&self.Object===Object&&self,R=It||C||Function("return this")(),O=r&&!r.nodeType&&r,u=O&&!0&&c&&!c.nodeType&&c,b=u&&u.exports===O,ee=b&&It.process,fe=function(){try{return ee&&ee.binding&&ee.binding("util")}catch{}}(),_e=fe&&fe.isTypedArray;function Ne(v,x){for(var $=-1,Q=v==null?0:v.length,Ge=0,ye=[];++$<Q;){var tt=v[$];x(tt,$,v)&&(ye[Ge++]=tt)}return ye}function Fe(v,x){for(var $=-1,Q=x.length,Ge=v.length;++$<Q;)v[Ge+$]=x[$];return v}function Se(v,x){for(var $=-1,Q=v==null?0:v.length;++$<Q;)if(x(v[$],$,v))return!0;return!1}function Pt(v,x){for(var $=-1,Q=Array(v);++$<v;)Q[$]=x($);return Q}function wt(v){return function(x){return v(x)}}function at(v,x){return v.has(x)}function $e(v,x){return v==null?void 0:v[x]}function Xe(v){var x=-1,$=Array(v.size);return v.forEach(function(Q,Ge){$[++x]=[Ge,Q]}),$}function Ze(v,x){return function($){return v(x($))}}function ct(v){var x=-1,$=Array(v.size);return v.forEach(function(Q){$[++x]=Q}),$}var Ue=Array.prototype,et=Function.prototype,Le=Object.prototype,Ve=R["__core-js_shared__"],lt=et.toString,Me=Le.hasOwnProperty,St=function(){var v=/[^.]+$/.exec(Ve&&Ve.keys&&Ve.keys.IE_PROTO||"");return v?"Symbol(src)_1."+v:""}(),Dt=Le.toString,Ut=RegExp("^"+lt.call(Me).replace(Qe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ht=b?R.Buffer:void 0,Mt=R.Symbol,Wt=R.Uint8Array,rr=Le.propertyIsEnumerable,Mr=Ue.splice,Jt=Mt?Mt.toStringTag:void 0,Vr=Object.getOwnPropertySymbols,hi=Ht?Ht.isBuffer:void 0,Oi=Ze(Object.keys,Object),ft=lr(R,"DataView"),it=lr(R,"Map"),pt=lr(R,"Promise"),dt=lr(R,"Set"),ut=lr(R,"WeakMap"),st=lr(Object,"create"),Ot=Gr(ft),At=Gr(it),gt=Gr(pt),Rt=Gr(dt),vt=Gr(ut),_t=Mt?Mt.prototype:void 0,yt=_t?_t.valueOf:void 0;function Ye(v){var x=-1,$=v==null?0:v.length;for(this.clear();++x<$;){var Q=v[x];this.set(Q[0],Q[1])}}function Ct(){this.__data__=st?st(null):{},this.size=0}function Tt(v){var x=this.has(v)&&delete this.__data__[v];return this.size-=x?1:0,x}function So(v){var x=this.__data__;if(st){var $=x[v];return $===n?void 0:$}return Me.call(x,v)?x[v]:void 0}function Oo(v){var x=this.__data__;return st?x[v]!==void 0:Me.call(x,v)}function Ao(v,x){var $=this.__data__;return this.size+=this.has(v)?0:1,$[v]=st&&x===void 0?n:x,this}Ye.prototype.clear=Ct,Ye.prototype.delete=Tt,Ye.prototype.get=So,Ye.prototype.has=Oo,Ye.prototype.set=Ao;function mr(v){var x=-1,$=v==null?0:v.length;for(this.clear();++x<$;){var Q=v[x];this.set(Q[0],Q[1])}}function Ro(){this.__data__=[],this.size=0}function Co(v){var x=this.__data__,$=Ai(x,v);if($<0)return!1;var Q=x.length-1;return $==Q?x.pop():Mr.call(x,$,1),--this.size,!0}function To(v){var x=this.__data__,$=Ai(x,v);return $<0?void 0:x[$][1]}function No(v){return Ai(this.__data__,v)>-1}function Lo(v,x){var $=this.__data__,Q=Ai($,v);return Q<0?(++this.size,$.push([v,x])):$[Q][1]=x,this}mr.prototype.clear=Ro,mr.prototype.delete=Co,mr.prototype.get=To,mr.prototype.has=No,mr.prototype.set=Lo;function Kr(v){var x=-1,$=v==null?0:v.length;for(this.clear();++x<$;){var Q=v[x];this.set(Q[0],Q[1])}}function Vi(){this.size=0,this.__data__={hash:new Ye,map:new(it||mr),string:new Ye}}function Fo(v){var x=li(this,v).delete(v);return this.size-=x?1:0,x}function Ki(v){return li(this,v).get(v)}function Do(v){return li(this,v).has(v)}function $o(v,x){var $=li(this,v),Q=$.size;return $.set(v,x),this.size+=$.size==Q?0:1,this}Kr.prototype.clear=Vi,Kr.prototype.delete=Fo,Kr.prototype.get=Ki,Kr.prototype.has=Do,Kr.prototype.set=$o;function Gi(v){var x=-1,$=v==null?0:v.length;for(this.__data__=new Kr;++x<$;)this.add(v[x])}function rn(v){return this.__data__.set(v,n),this}function sn(v){return this.__data__.has(v)}Gi.prototype.add=Gi.prototype.push=rn,Gi.prototype.has=sn;function Ar(v){var x=this.__data__=new mr(v);this.size=x.size}function qo(){this.__data__=new mr,this.size=0}function Mo(v){var x=this.__data__,$=x.delete(v);return this.size=x.size,$}function jo(v){return this.__data__.get(v)}function zo(v){return this.__data__.has(v)}function nn(v,x){var $=this.__data__;if($ instanceof mr){var Q=$.__data__;if(!it||Q.length<i-1)return Q.push([v,x]),this.size=++$.size,this;$=this.__data__=new Kr(Q)}return $.set(v,x),this.size=$.size,this}Ar.prototype.clear=qo,Ar.prototype.delete=Mo,Ar.prototype.get=jo,Ar.prototype.has=zo,Ar.prototype.set=nn;function on(v,x){var $=Qi(v),Q=!$&&mn(v),Ge=!$&&!Q&&bs(v),ye=!$&&!Q&&!Ge&&bn(v),tt=$||Q||Ge||ye,Nt=tt?Pt(v.length,String):[],Ae=Nt.length;for(var We in v)(x||Me.call(v,We))&&!(tt&&(We=="length"||Ge&&(We=="offset"||We=="parent")||ye&&(We=="buffer"||We=="byteLength"||We=="byteOffset")||pn(We,Ae)))&&Nt.push(We);return Nt}function Ai(v,x){for(var $=v.length;$--;)if(yn(v[$][0],x))return $;return-1}function ws(v,x,$){var Q=x(v);return Qi(v)?Q:Fe(Q,$(v))}function Ri(v){return v==null?v===void 0?ve:Ee:Jt&&Jt in Object(v)?ln(v):ko(v)}function _s(v){return Ti(v)&&Ri(v)==g}function Ci(v,x,$,Q,Ge){return v===x?!0:v==null||x==null||!Ti(v)&&!Ti(x)?v!==v&&x!==x:an(v,x,$,Q,Ci,Ge)}function an(v,x,$,Q,Ge,ye){var tt=Qi(v),Nt=Qi(x),Ae=tt?w:jr(v),We=Nt?w:jr(x);Ae=Ae==g?ge:Ae,We=We==g?ge:We;var bt=Ae==ge,ir=We==ge,Lt=Ae==We;if(Lt&&bs(v)){if(!bs(x))return!1;tt=!0,bt=!1}if(Lt&&!bt)return ye||(ye=new Ar),tt||bn(v)?Wi(v,x,$,Q,Ge,ye):Ho(v,x,Ae,$,Q,Ge,ye);if(!($&o)){var rt=bt&&Me.call(v,"__wrapped__"),Qt=ir&&Me.call(x,"__wrapped__");if(rt||Qt){var Rr=rt?v.value():v,wr=Qt?x.value():x;return ye||(ye=new Ar),Ge(Rr,wr,$,Q,ye)}}return Lt?(ye||(ye=new Ar),hn(v,x,$,Q,Ge,ye)):!1}function Uo(v){if(!_n(v)||gn(v))return!1;var x=Yi(v)?Ut:Be;return x.test(Gr(v))}function cn(v){return Ti(v)&&wn(v.length)&&!!xe[Ri(v)]}function un(v){if(!vn(v))return Oi(v);var x=[];for(var $ in Object(v))Me.call(v,$)&&$!="constructor"&&x.push($);return x}function Wi(v,x,$,Q,Ge,ye){var tt=$&o,Nt=v.length,Ae=x.length;if(Nt!=Ae&&!(tt&&Ae>Nt))return!1;var We=ye.get(v);if(We&&ye.get(x))return We==x;var bt=-1,ir=!0,Lt=$&h?new Gi:void 0;for(ye.set(v,x),ye.set(x,v);++bt<Nt;){var rt=v[bt],Qt=x[bt];if(Q)var Rr=tt?Q(Qt,rt,bt,x,v,ye):Q(rt,Qt,bt,v,x,ye);if(Rr!==void 0){if(Rr)continue;ir=!1;break}if(Lt){if(!Se(x,function(wr,zr){if(!at(Lt,zr)&&(rt===wr||Ge(rt,wr,$,Q,ye)))return Lt.push(zr)})){ir=!1;break}}else if(!(rt===Qt||Ge(rt,Qt,$,Q,ye))){ir=!1;break}}return ye.delete(v),ye.delete(x),ir}function Ho(v,x,$,Q,Ge,ye,tt){switch($){case Te:if(v.byteLength!=x.byteLength||v.byteOffset!=x.byteOffset)return!1;v=v.buffer,x=x.buffer;case ue:return!(v.byteLength!=x.byteLength||!ye(new Wt(v),new Wt(x)));case L:case H:case ie:return yn(+v,+x);case B:return v.name==x.name&&v.message==x.message;case le:case M:return v==x+"";case W:var Nt=Xe;case T:var Ae=Q&o;if(Nt||(Nt=ct),v.size!=x.size&&!Ae)return!1;var We=tt.get(v);if(We)return We==x;Q|=h,tt.set(v,x);var bt=Wi(Nt(v),Nt(x),Q,Ge,ye,tt);return tt.delete(v),bt;case G:if(yt)return yt.call(v)==yt.call(x)}return!1}function hn(v,x,$,Q,Ge,ye){var tt=$&o,Nt=Ji(v),Ae=Nt.length,We=Ji(x),bt=We.length;if(Ae!=bt&&!tt)return!1;for(var ir=Ae;ir--;){var Lt=Nt[ir];if(!(tt?Lt in x:Me.call(x,Lt)))return!1}var rt=ye.get(v);if(rt&&ye.get(x))return rt==x;var Qt=!0;ye.set(v,x),ye.set(x,v);for(var Rr=tt;++ir<Ae;){Lt=Nt[ir];var wr=v[Lt],zr=x[Lt];if(Q)var Es=tt?Q(zr,wr,Lt,x,v,ye):Q(wr,zr,Lt,v,x,ye);if(!(Es===void 0?wr===zr||Ge(wr,zr,$,Q,ye):Es)){Qt=!1;break}Rr||(Rr=Lt=="constructor")}if(Qt&&!Rr){var Ni=v.constructor,jt=x.constructor;Ni!=jt&&"constructor"in v&&"constructor"in x&&!(typeof Ni=="function"&&Ni instanceof Ni&&typeof jt=="function"&&jt instanceof jt)&&(Qt=!1)}return ye.delete(v),ye.delete(x),Qt}function Ji(v){return ws(v,Ko,fn)}function li(v,x){var $=v.__data__;return dn(x)?$[typeof x=="string"?"string":"hash"]:$.map}function lr(v,x){var $=$e(v,x);return Uo($)?$:void 0}function ln(v){var x=Me.call(v,Jt),$=v[Jt];try{v[Jt]=void 0;var Q=!0}catch{}var Ge=Dt.call(v);return Q&&(x?v[Jt]=$:delete v[Jt]),Ge}var fn=Vr?function(v){return v==null?[]:(v=Object(v),Ne(Vr(v),function(x){return rr.call(v,x)}))}:Ke,jr=Ri;(ft&&jr(new ft(new ArrayBuffer(1)))!=Te||it&&jr(new it)!=W||pt&&jr(pt.resolve())!=pe||dt&&jr(new dt)!=T||ut&&jr(new ut)!=re)&&(jr=function(v){var x=Ri(v),$=x==ge?v.constructor:void 0,Q=$?Gr($):"";if(Q)switch(Q){case Ot:return Te;case At:return W;case gt:return pe;case Rt:return T;case vt:return re}return x});function pn(v,x){return x=x??p,!!x&&(typeof v=="number"||qr.test(v))&&v>-1&&v%1==0&&v<x}function dn(v){var x=typeof v;return x=="string"||x=="number"||x=="symbol"||x=="boolean"?v!=="__proto__":v===null}function gn(v){return!!St&&St in v}function vn(v){var x=v&&v.constructor,$=typeof x=="function"&&x.prototype||Le;return v===$}function ko(v){return Dt.call(v)}function Gr(v){if(v!=null){try{return lt.call(v)}catch{}try{return v+""}catch{}}return""}function yn(v,x){return v===x||v!==v&&x!==x}var mn=_s(function(){return arguments}())?_s:function(v){return Ti(v)&&Me.call(v,"callee")&&!rr.call(v,"callee")},Qi=Array.isArray;function Bo(v){return v!=null&&wn(v.length)&&!Yi(v)}var bs=hi||He;function Vo(v,x){return Ci(v,x)}function Yi(v){if(!_n(v))return!1;var x=Ri(v);return x==K||x==q||x==S||x==he}function wn(v){return typeof v=="number"&&v>-1&&v%1==0&&v<=p}function _n(v){var x=typeof v;return v!=null&&(x=="object"||x=="function")}function Ti(v){return v!=null&&typeof v=="object"}var bn=_e?wt(_e):cn;function Ko(v){return Bo(v)?on(v):un(v)}function Ke(){return[]}function He(){return!1}c.exports=Vo})(yo,yo.exports);var Sw=yo.exports;const Ow=_c(Sw);function Aw(c,r){if(c.length>=255)throw new TypeError("Alphabet too long");for(var i=new Uint8Array(256),n=0;n<i.length;n++)i[n]=255;for(var o=0;o<c.length;o++){var h=c.charAt(o),p=h.charCodeAt(0);if(i[p]!==255)throw new TypeError(h+" is ambiguous");i[p]=o}var g=c.length,w=c.charAt(0),S=Math.log(g)/Math.log(256),L=Math.log(256)/Math.log(g);function H(q){if(q instanceof Uint8Array||(ArrayBuffer.isView(q)?q=new Uint8Array(q.buffer,q.byteOffset,q.byteLength):Array.isArray(q)&&(q=Uint8Array.from(q))),!(q instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(q.length===0)return"";for(var W=0,ie=0,Ee=0,ge=q.length;Ee!==ge&&q[Ee]===0;)Ee++,W++;for(var pe=(ge-Ee)*L+1>>>0,he=new Uint8Array(pe);Ee!==ge;){for(var le=q[Ee],T=0,M=pe-1;(le!==0||T<ie)&&M!==-1;M--,T++)le+=256*he[M]>>>0,he[M]=le%g>>>0,le=le/g>>>0;if(le!==0)throw new Error("Non-zero carry");ie=T,Ee++}for(var G=pe-ie;G!==pe&&he[G]===0;)G++;for(var ve=w.repeat(W);G<pe;++G)ve+=c.charAt(he[G]);return ve}function B(q){if(typeof q!="string")throw new TypeError("Expected String");if(q.length===0)return new Uint8Array;var W=0;if(q[W]!==" "){for(var ie=0,Ee=0;q[W]===w;)ie++,W++;for(var ge=(q.length-W)*S+1>>>0,pe=new Uint8Array(ge);q[W];){var he=i[q.charCodeAt(W)];if(he===255)return;for(var le=0,T=ge-1;(he!==0||le<Ee)&&T!==-1;T--,le++)he+=g*pe[T]>>>0,pe[T]=he%256>>>0,he=he/256>>>0;if(he!==0)throw new Error("Non-zero carry");Ee=le,W++}if(q[W]!==" "){for(var M=ge-Ee;M!==ge&&pe[M]===0;)M++;for(var G=new Uint8Array(ie+(ge-M)),ve=ie;M!==ge;)G[ve++]=pe[M++];return G}}}function K(q){var W=B(q);if(W)return W;throw new Error(`Non-${r} character`)}return{encode:H,decodeUnsafe:B,decode:K}}var Rw=Aw,Cw=Rw;const xf=c=>{if(c instanceof Uint8Array&&c.constructor.name==="Uint8Array")return c;if(c instanceof ArrayBuffer)return new Uint8Array(c);if(ArrayBuffer.isView(c))return new Uint8Array(c.buffer,c.byteOffset,c.byteLength);throw new Error("Unknown type, must be binary type")},Tw=c=>new TextEncoder().encode(c),Nw=c=>new TextDecoder().decode(c);class Lw{constructor(r,i,n){this.name=r,this.prefix=i,this.baseEncode=n}encode(r){if(r instanceof Uint8Array)return`${this.prefix}${this.baseEncode(r)}`;throw Error("Unknown type, must be binary type")}}class Fw{constructor(r,i,n){if(this.name=r,this.prefix=i,i.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i.codePointAt(0),this.baseDecode=n}decode(r){if(typeof r=="string"){if(r.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(r)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(r.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(r){return If(this,r)}}class Dw{constructor(r){this.decoders=r}or(r){return If(this,r)}decode(r){const i=r[0],n=this.decoders[i];if(n)return n.decode(r);throw RangeError(`Unable to decode multibase string ${JSON.stringify(r)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const If=(c,r)=>new Dw({...c.decoders||{[c.prefix]:c},...r.decoders||{[r.prefix]:r}});class $w{constructor(r,i,n,o){this.name=r,this.prefix=i,this.baseEncode=n,this.baseDecode=o,this.encoder=new Lw(r,i,n),this.decoder=new Fw(r,i,o)}encode(r){return this.encoder.encode(r)}decode(r){return this.decoder.decode(r)}}const Io=({name:c,prefix:r,encode:i,decode:n})=>new $w(c,r,i,n),tn=({prefix:c,name:r,alphabet:i})=>{const{encode:n,decode:o}=Cw(i,r);return Io({prefix:c,name:r,encode:n,decode:h=>xf(o(h))})},qw=(c,r,i,n)=>{const o={};for(let L=0;L<r.length;++L)o[r[L]]=L;let h=c.length;for(;c[h-1]==="=";)--h;const p=new Uint8Array(h*i/8|0);let g=0,w=0,S=0;for(let L=0;L<h;++L){const H=o[c[L]];if(H===void 0)throw new SyntaxError(`Non-${n} character`);w=w<<i|H,g+=i,g>=8&&(g-=8,p[S++]=255&w>>g)}if(g>=i||255&w<<8-g)throw new SyntaxError("Unexpected end of data");return p},Mw=(c,r,i)=>{const n=r[r.length-1]==="=",o=(1<<i)-1;let h="",p=0,g=0;for(let w=0;w<c.length;++w)for(g=g<<8|c[w],p+=8;p>i;)p-=i,h+=r[o&g>>p];if(p&&(h+=r[o&g<<i-p]),n)for(;h.length*i&7;)h+="=";return h},Bt=({name:c,prefix:r,bitsPerChar:i,alphabet:n})=>Io({prefix:r,name:c,encode(o){return Mw(o,n,i)},decode(o){return qw(o,n,i,c)}}),jw=Io({prefix:"\0",name:"identity",encode:c=>Nw(c),decode:c=>Tw(c)});var zw=Object.freeze({__proto__:null,identity:jw});const Uw=Bt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Hw=Object.freeze({__proto__:null,base2:Uw});const kw=Bt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Bw=Object.freeze({__proto__:null,base8:kw});const Vw=tn({prefix:"9",name:"base10",alphabet:"0123456789"});var Kw=Object.freeze({__proto__:null,base10:Vw});const Gw=Bt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Ww=Bt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Jw=Object.freeze({__proto__:null,base16:Gw,base16upper:Ww});const Qw=Bt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Yw=Bt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Xw=Bt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Zw=Bt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),e_=Bt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),t_=Bt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),r_=Bt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),i_=Bt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),s_=Bt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var n_=Object.freeze({__proto__:null,base32:Qw,base32upper:Yw,base32pad:Xw,base32padupper:Zw,base32hex:e_,base32hexupper:t_,base32hexpad:r_,base32hexpadupper:i_,base32z:s_});const o_=tn({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),a_=tn({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var c_=Object.freeze({__proto__:null,base36:o_,base36upper:a_});const u_=tn({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),h_=tn({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var l_=Object.freeze({__proto__:null,base58btc:u_,base58flickr:h_});const f_=Bt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),p_=Bt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),d_=Bt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),g_=Bt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var v_=Object.freeze({__proto__:null,base64:f_,base64pad:p_,base64url:d_,base64urlpad:g_});const Pf=Array.from(""),y_=Pf.reduce((c,r,i)=>(c[i]=r,c),[]),m_=Pf.reduce((c,r,i)=>(c[r.codePointAt(0)]=i,c),[]);function w_(c){return c.reduce((r,i)=>(r+=y_[i],r),"")}function __(c){const r=[];for(const i of c){const n=m_[i.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${i}`);r.push(n)}return new Uint8Array(r)}const b_=Io({prefix:"",name:"base256emoji",encode:w_,decode:__});var E_=Object.freeze({__proto__:null,base256emoji:b_}),x_=Sf,hl=128,I_=127,P_=~I_,S_=Math.pow(2,31);function Sf(c,r,i){r=r||[],i=i||0;for(var n=i;c>=S_;)r[i++]=c&255|hl,c/=128;for(;c&P_;)r[i++]=c&255|hl,c>>>=7;return r[i]=c|0,Sf.bytes=i-n+1,r}var O_=dc,A_=128,ll=127;function dc(c,n){var i=0,n=n||0,o=0,h=n,p,g=c.length;do{if(h>=g)throw dc.bytes=0,new RangeError("Could not decode varint");p=c[h++],i+=o<28?(p&ll)<<o:(p&ll)*Math.pow(2,o),o+=7}while(p>=A_);return dc.bytes=h-n,i}var R_=Math.pow(2,7),C_=Math.pow(2,14),T_=Math.pow(2,21),N_=Math.pow(2,28),L_=Math.pow(2,35),F_=Math.pow(2,42),D_=Math.pow(2,49),$_=Math.pow(2,56),q_=Math.pow(2,63),M_=function(c){return c<R_?1:c<C_?2:c<T_?3:c<N_?4:c<L_?5:c<F_?6:c<D_?7:c<$_?8:c<q_?9:10},j_={encode:x_,decode:O_,encodingLength:M_},Of=j_;const fl=(c,r,i=0)=>(Of.encode(c,r,i),r),pl=c=>Of.encodingLength(c),gc=(c,r)=>{const i=r.byteLength,n=pl(c),o=n+pl(i),h=new Uint8Array(o+i);return fl(c,h,0),fl(i,h,n),h.set(r,o),new z_(c,i,r,h)};class z_{constructor(r,i,n,o){this.code=r,this.size=i,this.digest=n,this.bytes=o}}const Af=({name:c,code:r,encode:i})=>new U_(c,r,i);class U_{constructor(r,i,n){this.name=r,this.code=i,this.encode=n}digest(r){if(r instanceof Uint8Array){const i=this.encode(r);return i instanceof Uint8Array?gc(this.code,i):i.then(n=>gc(this.code,n))}else throw Error("Unknown type, must be binary type")}}const Rf=c=>async r=>new Uint8Array(await crypto.subtle.digest(c,r)),H_=Af({name:"sha2-256",code:18,encode:Rf("SHA-256")}),k_=Af({name:"sha2-512",code:19,encode:Rf("SHA-512")});var B_=Object.freeze({__proto__:null,sha256:H_,sha512:k_});const Cf=0,V_="identity",Tf=xf,K_=c=>gc(Cf,Tf(c)),G_={code:Cf,name:V_,encode:Tf,digest:K_};var W_=Object.freeze({__proto__:null,identity:G_});new TextEncoder,new TextDecoder;const dl={...zw,...Hw,...Bw,...Kw,...Jw,...n_,...c_,...l_,...v_,...E_};({...B_,...W_});function Nf(c){return globalThis.Buffer!=null?new Uint8Array(c.buffer,c.byteOffset,c.byteLength):c}function J_(c=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Nf(globalThis.Buffer.allocUnsafe(c)):new Uint8Array(c)}function Lf(c,r,i,n){return{name:c,prefix:r,encoder:{name:c,prefix:r,encode:i},decoder:{decode:n}}}const gl=Lf("utf8","u",c=>"u"+new TextDecoder("utf8").decode(c),c=>new TextEncoder().encode(c.substring(1))),ic=Lf("ascii","a",c=>{let r="a";for(let i=0;i<c.length;i++)r+=String.fromCharCode(c[i]);return r},c=>{c=c.substring(1);const r=J_(c.length);for(let i=0;i<c.length;i++)r[i]=c.charCodeAt(i);return r}),Q_={utf8:gl,"utf-8":gl,hex:dl.base16,latin1:ic,ascii:ic,binary:ic,...dl};function Y_(c,r="utf8"){const i=Q_[r];if(!i)throw new Error(`Unsupported encoding "${r}"`);return(r==="utf8"||r==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Nf(globalThis.Buffer.from(c,"utf-8")):i.decoder.decode(`${i.prefix}${c}`)}const Ff="wc",X_=2,Cc="core",xi=`${Ff}@2:${Cc}:`,Z_={name:Cc,logger:"error"},eb={database:":memory:"},tb="crypto",vl="client_ed25519_seed",rb=se.ONE_DAY,ib="keychain",sb="0.3",nb="messages",ob="0.3",ab=se.SIX_HOURS,cb="publisher",Df="irn",ub="error",$f="wss://relay.walletconnect.com",yl="wss://relay.walletconnect.org",hb="relayer",Gt={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},lb="_subscription",ni={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},fb=se.ONE_SECOND,pb="2.10.2",db=1e4,gb="0.3",vb="WALLETCONNECT_CLIENT_ID",Fr={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},yb="subscription",mb="0.3",wb=se.FIVE_SECONDS*1e3,_b="pairing",bb="0.3",ks={wc_pairingDelete:{req:{ttl:se.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:se.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:se.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:se.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:se.ONE_DAY,prompt:!1,tag:0},res:{ttl:se.ONE_DAY,prompt:!1,tag:0}}},Js={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},Br={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},Eb="history",xb="0.3",Ib="expirer",Or={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},Pb="0.3",sc="verify-api",go="https://verify.walletconnect.com",ml="https://verify.walletconnect.org";class Sb{constructor(r,i){this.core=r,this.logger=i,this.keychain=new Map,this.name=ib,this.version=sb,this.initialized=!1,this.storagePrefix=xi,this.init=async()=>{if(!this.initialized){const n=await this.getKeyChain();typeof n<"u"&&(this.keychain=n),this.initialized=!0}},this.has=n=>(this.isInitialized(),this.keychain.has(n)),this.set=async(n,o)=>{this.isInitialized(),this.keychain.set(n,o),await this.persist()},this.get=n=>{this.isInitialized();const o=this.keychain.get(n);if(typeof o>"u"){const{message:h}=Z("NO_MATCHING_KEY",`${this.name}: ${n}`);throw new Error(h)}return o},this.del=async n=>{this.isInitialized(),this.keychain.delete(n),await this.persist()},this.core=r,this.logger=Ce.generateChildLogger(i,this.name)}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(r){await this.core.storage.setItem(this.storageKey,Ql(r))}async getKeyChain(){const r=await this.core.storage.getItem(this.storageKey);return typeof r<"u"?Yl(r):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:r}=Z("NOT_INITIALIZED",this.name);throw new Error(r)}}}class Ob{constructor(r,i,n){this.core=r,this.logger=i,this.name=tb,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=o=>(this.isInitialized(),this.keychain.has(o)),this.getClientId=async()=>{this.isInitialized();const o=await this.getClientSeed(),h=rl(o);return gf(h.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const o=Sm();return this.setPrivateKey(o.publicKey,o.privateKey)},this.signJWT=async o=>{this.isInitialized();const h=await this.getClientSeed(),p=rl(h),g=fc();return await sw(g,o,rb,p)},this.generateSharedKey=(o,h,p)=>{this.isInitialized();const g=this.getPrivateKey(o),w=Om(g,h);return this.setSymKey(w,p)},this.setSymKey=async(o,h)=>{this.isInitialized();const p=h||Am(o);return await this.keychain.set(p,o),p},this.deleteKeyPair=async o=>{this.isInitialized(),await this.keychain.del(o)},this.deleteSymKey=async o=>{this.isInitialized(),await this.keychain.del(o)},this.encode=async(o,h,p)=>{this.isInitialized();const g=Rm(p),w=Zs(h);if(Fh(g)){const B=g.senderPublicKey,K=g.receiverPublicKey;o=await this.generateSharedKey(B,K)}const S=this.getSymKey(o),{type:L,senderPublicKey:H}=g;return Cm({type:L,symKey:S,message:w,senderPublicKey:H})},this.decode=async(o,h,p)=>{this.isInitialized();const g=Tm(h,p);if(Fh(g)){const w=g.receiverPublicKey,S=g.senderPublicKey;o=await this.generateSharedKey(w,S)}try{const w=this.getSymKey(o),S=Nm({symKey:w,encoded:h});return Ic(S)}catch(w){this.logger.error(`Failed to decode message from topic: '${o}', clientId: '${await this.getClientId()}'`),this.logger.error(w)}},this.getPayloadType=o=>{const h=Dh(o);return Lm(h.type)},this.getPayloadSenderPublicKey=o=>{const h=Dh(o);return h.senderPublicKey?wo(h.senderPublicKey,Fm):void 0},this.core=r,this.logger=Ce.generateChildLogger(i,this.name),this.keychain=n||new Sb(this.core,this.logger)}get context(){return Ce.getLoggerContext(this.logger)}async setPrivateKey(r,i){return await this.keychain.set(r,i),r}getPrivateKey(r){return this.keychain.get(r)}async getClientSeed(){let r="";try{r=this.keychain.get(vl)}catch{r=fc(),await this.keychain.set(vl,r)}return Y_(r,"base16")}getSymKey(r){return this.keychain.get(r)}isInitialized(){if(!this.initialized){const{message:r}=Z("NOT_INITIALIZED",this.name);throw new Error(r)}}}class Ab extends F1{constructor(r,i){super(r,i),this.logger=r,this.core=i,this.messages=new Map,this.name=nb,this.version=ob,this.initialized=!1,this.storagePrefix=xi,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const n=await this.getRelayerMessages();typeof n<"u"&&(this.messages=n),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(n){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(n)}finally{this.initialized=!0}}},this.set=async(n,o)=>{this.isInitialized();const h=ds(o);let p=this.messages.get(n);return typeof p>"u"&&(p={}),typeof p[h]<"u"||(p[h]=o,this.messages.set(n,p),await this.persist()),h},this.get=n=>{this.isInitialized();let o=this.messages.get(n);return typeof o>"u"&&(o={}),o},this.has=(n,o)=>{this.isInitialized();const h=this.get(n),p=ds(o);return typeof h[p]<"u"},this.del=async n=>{this.isInitialized(),this.messages.delete(n),await this.persist()},this.logger=Ce.generateChildLogger(r,this.name),this.core=i}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(r){await this.core.storage.setItem(this.storageKey,Ql(r))}async getRelayerMessages(){const r=await this.core.storage.getItem(this.storageKey);return typeof r<"u"?Yl(r):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:r}=Z("NOT_INITIALIZED",this.name);throw new Error(r)}}}class Rb extends D1{constructor(r,i){super(r,i),this.relayer=r,this.logger=i,this.events=new yr.EventEmitter,this.name=cb,this.queue=new Map,this.publishTimeout=se.toMiliseconds(se.TEN_SECONDS),this.needsTransportRestart=!1,this.publish=async(n,o,h)=>{var p;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:o,opts:h}});try{const g=(h==null?void 0:h.ttl)||ab,w=pc(h),S=(h==null?void 0:h.prompt)||!1,L=(h==null?void 0:h.tag)||0,H=(h==null?void 0:h.id)||_f().toString(),B={topic:n,message:o,opts:{ttl:g,relay:w,prompt:S,tag:L,id:H}},K=setTimeout(()=>this.queue.set(H,B),this.publishTimeout);try{await await Xs(this.rpcPublish(n,o,g,w,S,L,H),this.publishTimeout,"Failed to publish payload, please try again."),this.removeRequestFromQueue(H),this.relayer.events.emit(Gt.publish,B)}catch(q){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(p=h==null?void 0:h.internal)!=null&&p.throwOnFailedPublish)throw this.removeRequestFromQueue(H),q;return}finally{clearTimeout(K)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:o,opts:h}})}catch(g){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(g),g}},this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.relayer=r,this.logger=Ce.generateChildLogger(i,this.name),this.registerEventListeners()}get context(){return Ce.getLoggerContext(this.logger)}rpcPublish(r,i,n,o,h,p,g){var w,S,L,H;const B={method:lo(o.protocol).publish,params:{topic:r,message:i,ttl:n,prompt:h,tag:p},id:g};return Ei((w=B.params)==null?void 0:w.prompt)&&((S=B.params)==null||delete S.prompt),Ei((L=B.params)==null?void 0:L.tag)&&((H=B.params)==null||delete H.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:B}),this.relayer.request(B)}removeRequestFromQueue(r){this.queue.delete(r)}checkQueue(){this.queue.forEach(async r=>{const{topic:i,message:n,opts:o}=r;await this.publish(i,n,o)})}registerEventListeners(){this.relayer.core.heartbeat.on(ms.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Gt.connection_stalled);return}this.checkQueue()}),this.relayer.on(Gt.message_ack,r=>{this.removeRequestFromQueue(r.id.toString())})}}class Cb{constructor(){this.map=new Map,this.set=(r,i)=>{const n=this.get(r);this.exists(r,i)||this.map.set(r,[...n,i])},this.get=r=>this.map.get(r)||[],this.exists=(r,i)=>this.get(r).includes(i),this.delete=(r,i)=>{if(typeof i>"u"){this.map.delete(r);return}if(!this.map.has(r))return;const n=this.get(r);if(!this.exists(r,i))return;const o=n.filter(h=>h!==i);if(!o.length){this.map.delete(r);return}this.map.set(r,o)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var Tb=Object.defineProperty,Nb=Object.defineProperties,Lb=Object.getOwnPropertyDescriptors,wl=Object.getOwnPropertySymbols,Fb=Object.prototype.hasOwnProperty,Db=Object.prototype.propertyIsEnumerable,_l=(c,r,i)=>r in c?Tb(c,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):c[r]=i,Bs=(c,r)=>{for(var i in r||(r={}))Fb.call(r,i)&&_l(c,i,r[i]);if(wl)for(var i of wl(r))Db.call(r,i)&&_l(c,i,r[i]);return c},nc=(c,r)=>Nb(c,Lb(r));class $b extends M1{constructor(r,i){super(r,i),this.relayer=r,this.logger=i,this.subscriptions=new Map,this.topicMap=new Cb,this.events=new yr.EventEmitter,this.name=yb,this.version=mb,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=xi,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(n,o)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:o}});try{const h=pc(o),p={topic:n,relay:h};this.pending.set(n,p);const g=await this.rpcSubscribe(n,h);return this.onSubscribe(g,p),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:o}}),g}catch(h){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(h),h}},this.unsubscribe=async(n,o)=>{await this.restartToComplete(),this.isInitialized(),typeof(o==null?void 0:o.id)<"u"?await this.unsubscribeById(n,o.id,o):await this.unsubscribeByTopic(n,o)},this.isSubscribed=async n=>this.topics.includes(n)?!0:await new Promise((o,h)=>{const p=new se.Watch;p.start(this.pendingSubscriptionWatchLabel);const g=setInterval(()=>{!this.pending.has(n)&&this.topics.includes(n)&&(clearInterval(g),p.stop(this.pendingSubscriptionWatchLabel),o(!0)),p.elapsed(this.pendingSubscriptionWatchLabel)>=wb&&(clearInterval(g),p.stop(this.pendingSubscriptionWatchLabel),h(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=r,this.logger=Ce.generateChildLogger(i,this.name),this.clientId=""}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(r,i){let n=!1;try{n=this.getSubscription(r).topic===i}catch{}return n}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(r,i){const n=this.topicMap.get(r);await Promise.all(n.map(async o=>await this.unsubscribeById(r,o,i)))}async unsubscribeById(r,i,n){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:r,id:i,opts:n}});try{const o=pc(n);await this.rpcUnsubscribe(r,i,o);const h=tr("USER_DISCONNECTED",`${this.name}, ${r}`);await this.onUnsubscribe(r,i,h),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:r,id:i,opts:n}})}catch(o){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(o),o}}async rpcSubscribe(r,i){const n={method:lo(i.protocol).subscribe,params:{topic:r}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{await await Xs(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Gt.connection_stalled)}return ds(r+this.clientId)}async rpcBatchSubscribe(r){if(!r.length)return;const i=r[0].relay,n={method:lo(i.protocol).batchSubscribe,params:{topics:r.map(o=>o.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{return await await Xs(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(Gt.connection_stalled)}}rpcUnsubscribe(r,i,n){const o={method:lo(n.protocol).unsubscribe,params:{topic:r,id:i}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:o}),this.relayer.request(o)}onSubscribe(r,i){this.setSubscription(r,nc(Bs({},i),{id:r})),this.pending.delete(i.topic)}onBatchSubscribe(r){r.length&&r.forEach(i=>{this.setSubscription(i.id,Bs({},i)),this.pending.delete(i.topic)})}async onUnsubscribe(r,i,n){this.events.removeAllListeners(i),this.hasSubscription(i,r)&&this.deleteSubscription(i,n),await this.relayer.messages.del(r)}async setRelayerSubscriptions(r){await this.relayer.core.storage.setItem(this.storageKey,r)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(r,i){this.subscriptions.has(r)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:r,subscription:i}),this.addSubscription(r,i))}addSubscription(r,i){this.subscriptions.set(r,Bs({},i)),this.topicMap.set(i.topic,r),this.events.emit(Fr.created,i)}getSubscription(r){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:r});const i=this.subscriptions.get(r);if(!i){const{message:n}=Z("NO_MATCHING_KEY",`${this.name}: ${r}`);throw new Error(n)}return i}deleteSubscription(r,i){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:r,reason:i});const n=this.getSubscription(r);this.subscriptions.delete(r),this.topicMap.delete(n.topic,r),this.events.emit(Fr.deleted,nc(Bs({},n),{reason:i}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Fr.sync)}async reset(){if(this.cached.length){const r=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let i=0;i<r;i++){const n=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(n)}}this.events.emit(Fr.resubscribed)}async restore(){try{const r=await this.getRelayerSubscriptions();if(typeof r>"u"||!r.length)return;if(this.subscriptions.size){const{message:i}=Z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(i),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(i)}this.cached=r,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(r){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(r)}}async batchSubscribe(r){if(!r.length)return;const i=await this.rpcBatchSubscribe(r);ys(i)&&this.onBatchSubscribe(i.map((n,o)=>nc(Bs({},r[o]),{id:n})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const r=[];this.pending.forEach(i=>{r.push(i)}),await this.batchSubscribe(r)}registerEventListeners(){this.relayer.core.heartbeat.on(ms.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(Gt.connect,async()=>{await this.onConnect()}),this.relayer.on(Gt.disconnect,()=>{this.onDisconnect()}),this.events.on(Fr.created,async r=>{const i=Fr.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),await this.persist()}),this.events.on(Fr.deleted,async r=>{const i=Fr.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:r}=Z("NOT_INITIALIZED",this.name);throw new Error(r)}}async restartToComplete(){this.restartInProgress&&await new Promise(r=>{const i=setInterval(()=>{this.restartInProgress||(clearInterval(i),r())},this.pollingInterval)})}}var qb=Object.defineProperty,bl=Object.getOwnPropertySymbols,Mb=Object.prototype.hasOwnProperty,jb=Object.prototype.propertyIsEnumerable,El=(c,r,i)=>r in c?qb(c,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):c[r]=i,zb=(c,r)=>{for(var i in r||(r={}))Mb.call(r,i)&&El(c,i,r[i]);if(bl)for(var i of bl(r))jb.call(r,i)&&El(c,i,r[i]);return c};class Ub extends $1{constructor(r){super(r),this.protocol="wc",this.version=2,this.events=new yr.EventEmitter,this.name=hb,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.request=async i=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(i)}catch(n){throw this.logger.debug("Failed to Publish Request"),this.logger.error(n),n}},this.onPayloadHandler=i=>{this.onProviderPayload(i)},this.onConnectHandler=()=>{this.events.emit(Gt.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=i=>{this.logger.error(i),this.events.emit(Gt.error,i),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(ni.payload,this.onPayloadHandler),this.provider.on(ni.connect,this.onConnectHandler),this.provider.on(ni.disconnect,this.onDisconnectHandler),this.provider.on(ni.error,this.onProviderErrorHandler)},this.core=r.core,this.logger=typeof r.logger<"u"&&typeof r.logger!="string"?Ce.generateChildLogger(r.logger,this.name):Ce.pino(Ce.getDefaultLoggerOptions({level:r.logger||ub})),this.messages=new Ab(this.logger,r.core),this.subscriber=new $b(this,this.logger),this.publisher=new Rb(this,this.logger),this.relayUrl=(r==null?void 0:r.relayUrl)||$f,this.projectId=r.projectId,this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${yl}...`),await this.restartTransport(yl)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},db)}get context(){return Ce.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(r,i,n){this.isInitialized(),await this.publisher.publish(r,i,n),await this.recordMessageEvent({topic:r,message:i,publishedAt:Date.now()})}async subscribe(r,i){var n;this.isInitialized();let o=((n=this.subscriber.topicMap.get(r))==null?void 0:n[0])||"";if(o)return o;let h;const p=g=>{g.topic===r&&(this.subscriber.off(Fr.created,p),h())};return await Promise.all([new Promise(g=>{h=g,this.subscriber.on(Fr.created,p)}),new Promise(async g=>{o=await this.subscriber.subscribe(r,i),g()})]),o}async unsubscribe(r,i){this.isInitialized(),await this.subscriber.unsubscribe(r,i)}on(r,i){this.events.on(r,i)}once(r,i){this.events.once(r,i)}off(r,i){this.events.off(r,i)}removeListener(r,i){this.events.removeListener(r,i)}async transportClose(){this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await Xs(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(r){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){r&&r!==this.relayUrl&&(this.relayUrl=r,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(i=>{if(!this.initialized)return i();this.subscriber.once(Fr.resubscribed,()=>{i()})}),new Promise(async(i,n)=>{try{await Xs(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(o){n(o);return}i()})])}catch(i){this.logger.error(i);const n=i;if(!this.isConnectionStalled(n.message))throw i;this.provider.events.emit(ni.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(r){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=r||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await $h())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(r){return this.staleConnectionErrors.some(i=>r.includes(i))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const r=await this.core.crypto.signJWT(this.relayUrl);this.provider=new ci(new Pw(Dm({sdkVersion:pb,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:r,useOnCloseEvent:!0}))),this.registerProviderListeners()}async recordMessageEvent(r){const{topic:i,message:n}=r;await this.messages.set(i,n)}async shouldIgnoreMessageEvent(r){const{topic:i,message:n}=r;if(!n||n.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${n}`),!0;if(!await this.subscriber.isSubscribed(i))return this.logger.debug(`Ignoring message for non-subscribed topic ${i}`),!0;const o=this.messages.has(i,n);return o&&this.logger.debug(`Ignoring duplicate message: ${n}`),o}async onProviderPayload(r){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:r}),Rc(r)){if(!r.method.endsWith(lb))return;const i=r.params,{topic:n,message:o,publishedAt:h}=i.data,p={topic:n,message:o,publishedAt:h};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(zb({type:"event",event:i.id},p)),this.events.emit(i.id,p),await this.acknowledgePayload(r),await this.onMessageEvent(p)}else xo(r)&&this.events.emit(Gt.message_ack,r)}async onMessageEvent(r){await this.shouldIgnoreMessageEvent(r)||(this.events.emit(Gt.message,r),await this.recordMessageEvent(r))}async acknowledgePayload(r){const i=Ac(r.id,!0);await this.provider.connection.send(i)}unregisterProviderListeners(){this.provider.off(ni.payload,this.onPayloadHandler),this.provider.off(ni.connect,this.onConnectHandler),this.provider.off(ni.disconnect,this.onDisconnectHandler),this.provider.off(ni.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(Gt.connection_stalled,()=>{this.restartTransport().catch(i=>this.logger.error(i))});let r=await $h();$m(async i=>{this.initialized&&r!==i&&(r=i,i?await this.restartTransport().catch(n=>this.logger.error(n)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(n=>this.logger.error(n))))})}onProviderDisconnect(){this.events.emit(Gt.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(r=>this.logger.error(r))},se.toMiliseconds(fb)))}isInitialized(){if(!this.initialized){const{message:r}=Z("NOT_INITIALIZED",this.name);throw new Error(r)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(r=>{const i=setInterval(()=>{this.connected&&(clearInterval(i),r())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var Hb=Object.defineProperty,xl=Object.getOwnPropertySymbols,kb=Object.prototype.hasOwnProperty,Bb=Object.prototype.propertyIsEnumerable,Il=(c,r,i)=>r in c?Hb(c,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):c[r]=i,Pl=(c,r)=>{for(var i in r||(r={}))kb.call(r,i)&&Il(c,i,r[i]);if(xl)for(var i of xl(r))Bb.call(r,i)&&Il(c,i,r[i]);return c};class Po extends q1{constructor(r,i,n,o=xi,h=void 0){super(r,i,n,o),this.core=r,this.logger=i,this.name=n,this.map=new Map,this.version=gb,this.cached=[],this.initialized=!1,this.storagePrefix=xi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(p=>{this.getKey&&p!==null&&!Ei(p)?this.map.set(this.getKey(p),p):Im(p)?this.map.set(p.id,p):Pm(p)&&this.map.set(p.topic,p)}),this.cached=[],this.initialized=!0)},this.set=async(p,g)=>{this.isInitialized(),this.map.has(p)?await this.update(p,g):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:p,value:g}),this.map.set(p,g),await this.persist())},this.get=p=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:p}),this.getData(p)),this.getAll=p=>(this.isInitialized(),p?this.values.filter(g=>Object.keys(p).every(w=>Ow(g[w],p[w]))):this.values),this.update=async(p,g)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:p,update:g});const w=Pl(Pl({},this.getData(p)),g);this.map.set(p,w),await this.persist()},this.delete=async(p,g)=>{this.isInitialized(),this.map.has(p)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:p,reason:g}),this.map.delete(p),await this.persist())},this.logger=Ce.generateChildLogger(i,this.name),this.storagePrefix=o,this.getKey=h}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(r){await this.core.storage.setItem(this.storageKey,r)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(r){const i=this.map.get(r);if(!i){const{message:n}=Z("NO_MATCHING_KEY",`${this.name}: ${r}`);throw this.logger.error(n),new Error(n)}return i}async persist(){await this.setDataStore(this.values)}async restore(){try{const r=await this.getDataStore();if(typeof r>"u"||!r.length)return;if(this.map.size){const{message:i}=Z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(i),new Error(i)}this.cached=r,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(r){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(r)}}isInitialized(){if(!this.initialized){const{message:r}=Z("NOT_INITIALIZED",this.name);throw new Error(r)}}}class Vb{constructor(r,i){this.core=r,this.logger=i,this.name=_b,this.version=bb,this.events=new xc,this.initialized=!1,this.storagePrefix=xi,this.ignoredPayloadTypes=[Gl],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:n})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...n])]},this.create=async()=>{this.isInitialized();const n=fc(),o=await this.core.crypto.setSymKey(n),h=Dr(se.FIVE_MINUTES),p={protocol:Df},g={topic:o,expiry:h,relay:p,active:!1},w=qm({protocol:this.core.protocol,version:this.core.version,topic:o,symKey:n,relay:p});return await this.pairings.set(o,g),await this.core.relayer.subscribe(o),this.core.expirer.set(o,h),{topic:o,uri:w}},this.pair=async n=>{this.isInitialized(),this.isValidPair(n);const{topic:o,symKey:h,relay:p}=Mm(n.uri);let g;if(this.pairings.keys.includes(o)&&(g=this.pairings.get(o),g.active))throw new Error(`Pairing already exists: ${o}. Please try again with a new connection URI.`);this.core.crypto.keychain.has(o)||(await this.core.crypto.setSymKey(h,o),await this.core.relayer.subscribe(o,{relay:p}));const w=Dr(se.FIVE_MINUTES),S={topic:o,relay:p,expiry:w,active:!1};return await this.pairings.set(o,S),this.core.expirer.set(o,w),n.activatePairing&&await this.activate({topic:o}),this.events.emit(Js.create,S),S},this.activate=async({topic:n})=>{this.isInitialized();const o=Dr(se.THIRTY_DAYS);await this.pairings.update(n,{active:!0,expiry:o}),this.core.expirer.set(n,o)},this.ping=async n=>{this.isInitialized(),await this.isValidPing(n);const{topic:o}=n;if(this.pairings.keys.includes(o)){const h=await this.sendRequest(o,"wc_pairingPing",{}),{done:p,resolve:g,reject:w}=ls();this.events.once(Ft("pairing_ping",h),({error:S})=>{S?w(S):g()}),await p()}},this.updateExpiry=async({topic:n,expiry:o})=>{this.isInitialized(),await this.pairings.update(n,{expiry:o})},this.updateMetadata=async({topic:n,metadata:o})=>{this.isInitialized(),await this.pairings.update(n,{peerMetadata:o})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async n=>{this.isInitialized(),await this.isValidDisconnect(n);const{topic:o}=n;this.pairings.keys.includes(o)&&(await this.sendRequest(o,"wc_pairingDelete",tr("USER_DISCONNECTED")),await this.deletePairing(o))},this.sendRequest=async(n,o,h)=>{const p=vs(o,h),g=await this.core.crypto.encode(n,p),w=ks[o].req;return this.core.history.set(n,p),this.core.relayer.publish(n,g,w),p.id},this.sendResult=async(n,o,h)=>{const p=Ac(n,h),g=await this.core.crypto.encode(o,p),w=await this.core.history.get(o,n),S=ks[w.request.method].res;await this.core.relayer.publish(o,g,S),await this.core.history.resolve(p)},this.sendError=async(n,o,h)=>{const p=Eo(n,h),g=await this.core.crypto.encode(o,p),w=await this.core.history.get(o,n),S=ks[w.request.method]?ks[w.request.method].res:ks.unregistered_method.res;await this.core.relayer.publish(o,g,S),await this.core.history.resolve(p)},this.deletePairing=async(n,o)=>{await this.core.relayer.unsubscribe(n),await Promise.all([this.pairings.delete(n,tr("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(n),o?Promise.resolve():this.core.expirer.del(n)])},this.cleanup=async()=>{const n=this.pairings.getAll().filter(o=>bi(o.expiry));await Promise.all(n.map(o=>this.deletePairing(o.topic)))},this.onRelayEventRequest=n=>{const{topic:o,payload:h}=n;switch(h.method){case"wc_pairingPing":return this.onPairingPingRequest(o,h);case"wc_pairingDelete":return this.onPairingDeleteRequest(o,h);default:return this.onUnknownRpcMethodRequest(o,h)}},this.onRelayEventResponse=async n=>{const{topic:o,payload:h}=n,p=(await this.core.history.get(o,h.id)).request.method;switch(p){case"wc_pairingPing":return this.onPairingPingResponse(o,h);default:return this.onUnknownRpcMethodResponse(p)}},this.onPairingPingRequest=async(n,o)=>{const{id:h}=o;try{this.isValidPing({topic:n}),await this.sendResult(h,n,!0),this.events.emit(Js.ping,{id:h,topic:n})}catch(p){await this.sendError(h,n,p),this.logger.error(p)}},this.onPairingPingResponse=(n,o)=>{const{id:h}=o;setTimeout(()=>{ai(o)?this.events.emit(Ft("pairing_ping",h),{}):$r(o)&&this.events.emit(Ft("pairing_ping",h),{error:o.error})},500)},this.onPairingDeleteRequest=async(n,o)=>{const{id:h}=o;try{this.isValidDisconnect({topic:n}),await this.deletePairing(n),this.events.emit(Js.delete,{id:h,topic:n})}catch(p){await this.sendError(h,n,p),this.logger.error(p)}},this.onUnknownRpcMethodRequest=async(n,o)=>{const{id:h,method:p}=o;try{if(this.registeredMethods.includes(p))return;const g=tr("WC_METHOD_UNSUPPORTED",p);await this.sendError(h,n,g),this.logger.error(g)}catch(g){await this.sendError(h,n,g),this.logger.error(g)}},this.onUnknownRpcMethodResponse=n=>{this.registeredMethods.includes(n)||this.logger.error(tr("WC_METHOD_UNSUPPORTED",n))},this.isValidPair=n=>{if(!ur(n)){const{message:o}=Z("MISSING_OR_INVALID",`pair() params: ${n}`);throw new Error(o)}if(!jm(n.uri)){const{message:o}=Z("MISSING_OR_INVALID",`pair() uri: ${n.uri}`);throw new Error(o)}},this.isValidPing=async n=>{if(!ur(n)){const{message:h}=Z("MISSING_OR_INVALID",`ping() params: ${n}`);throw new Error(h)}const{topic:o}=n;await this.isValidPairingTopic(o)},this.isValidDisconnect=async n=>{if(!ur(n)){const{message:h}=Z("MISSING_OR_INVALID",`disconnect() params: ${n}`);throw new Error(h)}const{topic:o}=n;await this.isValidPairingTopic(o)},this.isValidPairingTopic=async n=>{if(!fs(n,!1)){const{message:o}=Z("MISSING_OR_INVALID",`pairing topic should be a string: ${n}`);throw new Error(o)}if(!this.pairings.keys.includes(n)){const{message:o}=Z("NO_MATCHING_KEY",`pairing topic doesn't exist: ${n}`);throw new Error(o)}if(bi(this.pairings.get(n).expiry)){await this.deletePairing(n);const{message:o}=Z("EXPIRED",`pairing topic: ${n}`);throw new Error(o)}},this.core=r,this.logger=Ce.generateChildLogger(i,this.name),this.pairings=new Po(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Ce.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:r}=Z("NOT_INITIALIZED",this.name);throw new Error(r)}}registerRelayerEvents(){this.core.relayer.on(Gt.message,async r=>{const{topic:i,message:n}=r;if(!this.pairings.keys.includes(i)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(n)))return;const o=await this.core.crypto.decode(i,n);try{Rc(o)?(this.core.history.set(i,o),this.onRelayEventRequest({topic:i,payload:o})):xo(o)&&(await this.core.history.resolve(o),await this.onRelayEventResponse({topic:i,payload:o}),this.core.history.delete(i,o.id))}catch(h){this.logger.error(h)}})}registerExpirerEvents(){this.core.expirer.on(Or.expired,async r=>{const{topic:i}=Wl(r.target);i&&this.pairings.keys.includes(i)&&(await this.deletePairing(i,!0),this.events.emit(Js.expire,{topic:i}))})}}class Kb extends L1{constructor(r,i){super(r,i),this.core=r,this.logger=i,this.records=new Map,this.events=new yr.EventEmitter,this.name=Eb,this.version=xb,this.cached=[],this.initialized=!1,this.storagePrefix=xi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.records.set(n.id,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(n,o,h)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:n,request:o,chainId:h}),this.records.has(o.id))return;const p={id:o.id,topic:n,request:{method:o.method,params:o.params||null},chainId:h,expiry:Dr(se.THIRTY_DAYS)};this.records.set(p.id,p),this.events.emit(Br.created,p)},this.resolve=async n=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:n}),!this.records.has(n.id))return;const o=await this.getRecord(n.id);typeof o.response>"u"&&(o.response=$r(n)?{error:n.error}:{result:n.result},this.records.set(o.id,o),this.events.emit(Br.updated,o))},this.get=async(n,o)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:n,id:o}),await this.getRecord(o)),this.delete=(n,o)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:o}),this.values.forEach(h=>{if(h.topic===n){if(typeof o<"u"&&h.id!==o)return;this.records.delete(h.id),this.events.emit(Br.deleted,h)}})},this.exists=async(n,o)=>(this.isInitialized(),this.records.has(o)?(await this.getRecord(o)).topic===n:!1),this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.logger=Ce.generateChildLogger(i,this.name)}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const r=[];return this.values.forEach(i=>{if(typeof i.response<"u")return;const n={topic:i.topic,request:vs(i.request.method,i.request.params,i.id),chainId:i.chainId};return r.push(n)}),r}async setJsonRpcRecords(r){await this.core.storage.setItem(this.storageKey,r)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(r){this.isInitialized();const i=this.records.get(r);if(!i){const{message:n}=Z("NO_MATCHING_KEY",`${this.name}: ${r}`);throw new Error(n)}return i}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Br.sync)}async restore(){try{const r=await this.getJsonRpcRecords();if(typeof r>"u"||!r.length)return;if(this.records.size){const{message:i}=Z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(i),new Error(i)}this.cached=r,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(r){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(r)}}registerEventListeners(){this.events.on(Br.created,r=>{const i=Br.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,record:r}),this.persist()}),this.events.on(Br.updated,r=>{const i=Br.updated;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,record:r}),this.persist()}),this.events.on(Br.deleted,r=>{const i=Br.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,record:r}),this.persist()}),this.core.heartbeat.on(ms.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(r=>{se.toMiliseconds(r.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${r.id}`),this.delete(r.topic,r.id))})}catch(r){this.logger.warn(r)}}isInitialized(){if(!this.initialized){const{message:r}=Z("NOT_INITIALIZED",this.name);throw new Error(r)}}}class Gb extends j1{constructor(r,i){super(r,i),this.core=r,this.logger=i,this.expirations=new Map,this.events=new yr.EventEmitter,this.name=Ib,this.version=Pb,this.cached=[],this.initialized=!1,this.storagePrefix=xi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.expirations.set(n.target,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=n=>{try{const o=this.formatTarget(n);return typeof this.getExpiration(o)<"u"}catch{return!1}},this.set=(n,o)=>{this.isInitialized();const h=this.formatTarget(n),p={target:h,expiry:o};this.expirations.set(h,p),this.checkExpiry(h,p),this.events.emit(Or.created,{target:h,expiration:p})},this.get=n=>{this.isInitialized();const o=this.formatTarget(n);return this.getExpiration(o)},this.del=n=>{if(this.isInitialized(),this.has(n)){const o=this.formatTarget(n),h=this.getExpiration(o);this.expirations.delete(o),this.events.emit(Or.deleted,{target:o,expiration:h})}},this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.logger=Ce.generateChildLogger(i,this.name)}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(r){if(typeof r=="string")return zm(r);if(typeof r=="number")return Um(r);const{message:i}=Z("UNKNOWN_TYPE",`Target type: ${typeof r}`);throw new Error(i)}async setExpirations(r){await this.core.storage.setItem(this.storageKey,r)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Or.sync)}async restore(){try{const r=await this.getExpirations();if(typeof r>"u"||!r.length)return;if(this.expirations.size){const{message:i}=Z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(i),new Error(i)}this.cached=r,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(r){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(r)}}getExpiration(r){const i=this.expirations.get(r);if(!i){const{message:n}=Z("NO_MATCHING_KEY",`${this.name}: ${r}`);throw this.logger.error(n),new Error(n)}return i}checkExpiry(r,i){const{expiry:n}=i;se.toMiliseconds(n)-Date.now()<=0&&this.expire(r,i)}expire(r,i){this.expirations.delete(r),this.events.emit(Or.expired,{target:r,expiration:i})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((r,i)=>this.checkExpiry(i,r))}registerEventListeners(){this.core.heartbeat.on(ms.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(Or.created,r=>{const i=Or.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),this.persist()}),this.events.on(Or.expired,r=>{const i=Or.expired;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),this.persist()}),this.events.on(Or.deleted,r=>{const i=Or.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),this.persist()})}isInitialized(){if(!this.initialized){const{message:r}=Z("NOT_INITIALIZED",this.name);throw new Error(r)}}}class Wb extends z1{constructor(r,i){super(r,i),this.projectId=r,this.logger=i,this.name=sc,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async()=>{if(this.verifyDisabled||Hm()||!Jl())return;const n=go;this.verifyUrl!==n&&this.removeIframe(),this.verifyUrl=n;try{await this.createIframe()}catch(o){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(o)}if(!this.initialized){this.removeIframe(),this.verifyUrl=ml;try{await this.createIframe()}catch(o){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(o),this.verifyDisabled=!0}}},this.register=async n=>{this.initialized?this.sendPost(n.attestationId):(this.addToQueue(n.attestationId),await this.init())},this.resolve=async n=>{if(this.isDevEnv)return"";const o=(n==null?void 0:n.verifyUrl)||go;let h;try{h=await this.fetchAttestation(n.attestationId,o)}catch(p){this.logger.info(`failed to resolve attestation: ${n.attestationId} from url: ${o}`),this.logger.info(p),h=await this.fetchAttestation(n.attestationId,ml)}return h},this.fetchAttestation=async(n,o)=>{this.logger.info(`resolving attestation: ${n} from url: ${o}`);const h=this.startAbortTimer(se.ONE_SECOND*2),p=await fetch(`${o}/attestation/${n}`,{signal:this.abortController.signal});return clearTimeout(h),p.status===200?await p.json():void 0},this.addToQueue=n=>{this.queue.push(n)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(n=>this.sendPost(n)),this.queue=[])},this.sendPost=n=>{var o;try{if(!this.iframe)return;(o=this.iframe.contentWindow)==null||o.postMessage(n,"*"),this.logger.info(`postMessage sent: ${n} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let n;const o=h=>{h.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",o),n())};await Promise.race([new Promise(h=>{if(document.getElementById(sc))return h();window.addEventListener("message",o);const p=document.createElement("iframe");p.id=sc,p.src=`${this.verifyUrl}/${this.projectId}`,p.style.display="none",document.body.append(p),this.iframe=p,n=h}),new Promise((h,p)=>setTimeout(()=>{window.removeEventListener("message",o),p("verify iframe load timeout")},se.toMiliseconds(se.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.logger=Ce.generateChildLogger(i,this.name),this.verifyUrl=go,this.abortController=new AbortController,this.isDevEnv=km()&&{}.IS_VITEST}get context(){return Ce.getLoggerContext(this.logger)}startAbortTimer(r){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),se.toMiliseconds(r))}}var Jb=Object.defineProperty,Sl=Object.getOwnPropertySymbols,Qb=Object.prototype.hasOwnProperty,Yb=Object.prototype.propertyIsEnumerable,Ol=(c,r,i)=>r in c?Jb(c,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):c[r]=i,Al=(c,r)=>{for(var i in r||(r={}))Qb.call(r,i)&&Ol(c,i,r[i]);if(Sl)for(var i of Sl(r))Yb.call(r,i)&&Ol(c,i,r[i]);return c};class Tc extends N1{constructor(r){super(r),this.protocol=Ff,this.version=X_,this.name=Cc,this.events=new yr.EventEmitter,this.initialized=!1,this.on=(n,o)=>this.events.on(n,o),this.once=(n,o)=>this.events.once(n,o),this.off=(n,o)=>this.events.off(n,o),this.removeListener=(n,o)=>this.events.removeListener(n,o),this.projectId=r==null?void 0:r.projectId,this.relayUrl=(r==null?void 0:r.relayUrl)||$f,this.customStoragePrefix=r!=null&&r.customStoragePrefix?`:${r.customStoragePrefix}`:"";const i=typeof(r==null?void 0:r.logger)<"u"&&typeof(r==null?void 0:r.logger)!="string"?r.logger:Ce.pino(Ce.getDefaultLoggerOptions({level:(r==null?void 0:r.logger)||Z_.logger}));this.logger=Ce.generateChildLogger(i,this.name),this.heartbeat=new ms.HeartBeat,this.crypto=new Ob(this,this.logger,r==null?void 0:r.keychain),this.history=new Kb(this,this.logger),this.expirer=new Gb(this,this.logger),this.storage=r!=null&&r.storage?r.storage:new x1(Al(Al({},eb),r==null?void 0:r.storageOptions)),this.relayer=new Ub({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new Vb(this,this.logger),this.verify=new Wb(this.projectId||"",this.logger)}static async init(r){const i=new Tc(r);await i.initialize();const n=await i.crypto.getClientId();return await i.storage.setItem(vb,n),i}get context(){return Ce.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(r){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,r),this.logger.error(r.message),r}}}const Xb=Tc,qf="wc",Mf=2,jf="client",Nc=`${qf}@${Mf}:${jf}:`,oc={name:jf,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},Rl="WALLETCONNECT_DEEPLINK_CHOICE",Zb="proposal",zf="Proposal expired",eE="session",co=se.SEVEN_DAYS,tE="engine",Vs={wc_sessionPropose:{req:{ttl:se.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:se.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:se.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:se.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:se.ONE_DAY,prompt:!1,tag:1104},res:{ttl:se.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:se.ONE_DAY,prompt:!1,tag:1106},res:{ttl:se.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:se.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:se.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:se.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:se.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:se.ONE_DAY,prompt:!1,tag:1112},res:{ttl:se.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:se.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:se.THIRTY_SECONDS,prompt:!1,tag:1115}}},ac={min:se.FIVE_MINUTES,max:se.SEVEN_DAYS},oi={idle:"IDLE",active:"ACTIVE"},rE="request",iE=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var sE=Object.defineProperty,nE=Object.defineProperties,oE=Object.getOwnPropertyDescriptors,Cl=Object.getOwnPropertySymbols,aE=Object.prototype.hasOwnProperty,cE=Object.prototype.propertyIsEnumerable,Tl=(c,r,i)=>r in c?sE(c,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):c[r]=i,cr=(c,r)=>{for(var i in r||(r={}))aE.call(r,i)&&Tl(c,i,r[i]);if(Cl)for(var i of Cl(r))cE.call(r,i)&&Tl(c,i,r[i]);return c},Ks=(c,r)=>nE(c,oE(r));class uE extends H1{constructor(r){super(r),this.name=tE,this.events=new xc,this.initialized=!1,this.ignoredPayloadTypes=[Gl],this.requestQueue={state:oi.idle,queue:[]},this.sessionRequestQueue={state:oi.idle,queue:[]},this.requestQueueDelay=se.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(Vs)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},se.toMiliseconds(this.requestQueueDelay)))},this.connect=async i=>{await this.isInitialized();const n=Ks(cr({},i),{requiredNamespaces:i.requiredNamespaces||{},optionalNamespaces:i.optionalNamespaces||{}});await this.isValidConnect(n);const{pairingTopic:o,requiredNamespaces:h,optionalNamespaces:p,sessionProperties:g,relays:w}=n;let S=o,L,H=!1;if(S&&(H=this.client.core.pairing.pairings.get(S).active),!S||!H){const{topic:pe,uri:he}=await this.client.core.pairing.create();S=pe,L=he}const B=await this.client.core.crypto.generateKeyPair(),K=cr({requiredNamespaces:h,optionalNamespaces:p,relays:w??[{protocol:Df}],proposer:{publicKey:B,metadata:this.client.metadata}},g&&{sessionProperties:g}),{reject:q,resolve:W,done:ie}=ls(se.FIVE_MINUTES,zf);if(this.events.once(Ft("session_connect"),async({error:pe,session:he})=>{if(pe)q(pe);else if(he){he.self.publicKey=B;const le=Ks(cr({},he),{requiredNamespaces:he.requiredNamespaces,optionalNamespaces:he.optionalNamespaces});await this.client.session.set(he.topic,le),await this.setExpiry(he.topic,he.expiry),S&&await this.client.core.pairing.updateMetadata({topic:S,metadata:he.peer.metadata}),W(le)}}),!S){const{message:pe}=Z("NO_MATCHING_KEY",`connect() pairing topic: ${S}`);throw new Error(pe)}const Ee=await this.sendRequest({topic:S,method:"wc_sessionPropose",params:K}),ge=Dr(se.FIVE_MINUTES);return await this.setProposal(Ee,cr({id:Ee,expiry:ge},K)),{uri:L,approval:ie}},this.pair=async i=>(await this.isInitialized(),await this.client.core.pairing.pair(i)),this.approve=async i=>{await this.isInitialized(),await this.isValidApprove(i);const{id:n,relayProtocol:o,namespaces:h,sessionProperties:p}=i,g=this.client.proposal.get(n);let{pairingTopic:w,proposer:S,requiredNamespaces:L,optionalNamespaces:H}=g;w=w||"",fo(L)||(L=Vm(h,"approve()"));const B=await this.client.core.crypto.generateKeyPair(),K=S.publicKey,q=await this.client.core.crypto.generateSharedKey(B,K);w&&n&&(await this.client.core.pairing.updateMetadata({topic:w,metadata:S.metadata}),await this.sendResult({id:n,topic:w,result:{relay:{protocol:o??"irn"},responderPublicKey:B}}),await this.client.proposal.delete(n,tr("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:w}));const W=cr({relay:{protocol:o??"irn"},namespaces:h,requiredNamespaces:L,optionalNamespaces:H,pairingTopic:w,controller:{publicKey:B,metadata:this.client.metadata},expiry:Dr(co)},p&&{sessionProperties:p});await this.client.core.relayer.subscribe(q),await this.sendRequest({topic:q,method:"wc_sessionSettle",params:W,throwOnFailedPublish:!0});const ie=Ks(cr({},W),{topic:q,pairingTopic:w,acknowledged:!1,self:W.controller,peer:{publicKey:S.publicKey,metadata:S.metadata},controller:B});return await this.client.session.set(q,ie),await this.setExpiry(q,Dr(co)),{topic:q,acknowledged:()=>new Promise(Ee=>setTimeout(()=>Ee(this.client.session.get(q)),500))}},this.reject=async i=>{await this.isInitialized(),await this.isValidReject(i);const{id:n,reason:o}=i,{pairingTopic:h}=this.client.proposal.get(n);h&&(await this.sendError(n,h,o),await this.client.proposal.delete(n,tr("USER_DISCONNECTED")))},this.update=async i=>{await this.isInitialized(),await this.isValidUpdate(i);const{topic:n,namespaces:o}=i,h=await this.sendRequest({topic:n,method:"wc_sessionUpdate",params:{namespaces:o}}),{done:p,resolve:g,reject:w}=ls();return this.events.once(Ft("session_update",h),({error:S})=>{S?w(S):g()}),await this.client.session.update(n,{namespaces:o}),{acknowledged:p}},this.extend=async i=>{await this.isInitialized(),await this.isValidExtend(i);const{topic:n}=i,o=await this.sendRequest({topic:n,method:"wc_sessionExtend",params:{}}),{done:h,resolve:p,reject:g}=ls();return this.events.once(Ft("session_extend",o),({error:w})=>{w?g(w):p()}),await this.setExpiry(n,Dr(co)),{acknowledged:h}},this.request=async i=>{await this.isInitialized(),await this.isValidRequest(i);const{chainId:n,request:o,topic:h,expiry:p}=i,g=Oc(),{done:w,resolve:S,reject:L}=ls(p,"Request expired. Please try again.");return this.events.once(Ft("session_request",g),({error:H,result:B})=>{H?L(H):S(B)}),await Promise.all([new Promise(async H=>{await this.sendRequest({clientRpcId:g,topic:h,method:"wc_sessionRequest",params:{request:o,chainId:n},expiry:p,throwOnFailedPublish:!0}).catch(B=>L(B)),this.client.events.emit("session_request_sent",{topic:h,request:o,chainId:n,id:g}),H()}),new Promise(async H=>{const B=await this.client.core.storage.getItem(Rl);Km({id:g,topic:h,wcDeepLink:B}),H()}),w()]).then(H=>H[2])},this.respond=async i=>{await this.isInitialized(),await this.isValidRespond(i);const{topic:n,response:o}=i,{id:h}=o;ai(o)?await this.sendResult({id:h,topic:n,result:o.result,throwOnFailedPublish:!0}):$r(o)&&await this.sendError(h,n,o.error),this.cleanupAfterResponse(i)},this.ping=async i=>{await this.isInitialized(),await this.isValidPing(i);const{topic:n}=i;if(this.client.session.keys.includes(n)){const o=await this.sendRequest({topic:n,method:"wc_sessionPing",params:{}}),{done:h,resolve:p,reject:g}=ls();this.events.once(Ft("session_ping",o),({error:w})=>{w?g(w):p()}),await h()}else this.client.core.pairing.pairings.keys.includes(n)&&await this.client.core.pairing.ping({topic:n})},this.emit=async i=>{await this.isInitialized(),await this.isValidEmit(i);const{topic:n,event:o,chainId:h}=i;await this.sendRequest({topic:n,method:"wc_sessionEvent",params:{event:o,chainId:h}})},this.disconnect=async i=>{await this.isInitialized(),await this.isValidDisconnect(i);const{topic:n}=i;this.client.session.keys.includes(n)?(await this.sendRequest({topic:n,method:"wc_sessionDelete",params:tr("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession(n)):await this.client.core.pairing.disconnect({topic:n})},this.find=i=>(this.isInitialized(),this.client.session.getAll().filter(n=>Gm(n,i))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async i=>{if(i.pairingTopic)try{const n=this.client.core.pairing.pairings.get(i.pairingTopic),o=this.client.core.pairing.pairings.getAll().filter(h=>{var p,g;return((p=h.peerMetadata)==null?void 0:p.url)&&((g=h.peerMetadata)==null?void 0:g.url)===i.peer.metadata.url&&h.topic&&h.topic!==n.topic});if(o.length===0)return;this.client.logger.info(`Cleaning up ${o.length} duplicate pairing(s)`),await Promise.all(o.map(h=>this.client.core.pairing.disconnect({topic:h.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(n){this.client.logger.error(n)}},this.deleteSession=async(i,n)=>{const{self:o}=this.client.session.get(i);await this.client.core.relayer.unsubscribe(i),this.client.session.delete(i,tr("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(o.publicKey)&&await this.client.core.crypto.deleteKeyPair(o.publicKey),this.client.core.crypto.keychain.has(i)&&await this.client.core.crypto.deleteSymKey(i),n||this.client.core.expirer.del(i),this.client.core.storage.removeItem(Rl).catch(h=>this.client.logger.warn(h))},this.deleteProposal=async(i,n)=>{await Promise.all([this.client.proposal.delete(i,tr("USER_DISCONNECTED")),n?Promise.resolve():this.client.core.expirer.del(i)])},this.deletePendingSessionRequest=async(i,n,o=!1)=>{await Promise.all([this.client.pendingRequest.delete(i,n),o?Promise.resolve():this.client.core.expirer.del(i)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(h=>h.id!==i),o&&(this.sessionRequestQueue.state=oi.idle)},this.setExpiry=async(i,n)=>{this.client.session.keys.includes(i)&&await this.client.session.update(i,{expiry:n}),this.client.core.expirer.set(i,n)},this.setProposal=async(i,n)=>{await this.client.proposal.set(i,n),this.client.core.expirer.set(i,n.expiry)},this.setPendingSessionRequest=async i=>{const n=Vs.wc_sessionRequest.req.ttl,{id:o,topic:h,params:p,verifyContext:g}=i;await this.client.pendingRequest.set(o,{id:o,topic:h,params:p,verifyContext:g}),n&&this.client.core.expirer.set(o,Dr(n))},this.sendRequest=async i=>{const{topic:n,method:o,params:h,expiry:p,relayRpcId:g,clientRpcId:w,throwOnFailedPublish:S}=i,L=vs(o,h,w);if(Jl()&&iE.includes(o)){const K=ds(JSON.stringify(L));this.client.core.verify.register({attestationId:K})}const H=await this.client.core.crypto.encode(n,L),B=Vs[o].req;return p&&(B.ttl=p),g&&(B.id=g),this.client.core.history.set(n,L),S?(B.internal=Ks(cr({},B.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(n,H,B)):this.client.core.relayer.publish(n,H,B).catch(K=>this.client.logger.error(K)),L.id},this.sendResult=async i=>{const{id:n,topic:o,result:h,throwOnFailedPublish:p}=i,g=Ac(n,h),w=await this.client.core.crypto.encode(o,g),S=await this.client.core.history.get(o,n),L=Vs[S.request.method].res;p?(L.internal=Ks(cr({},L.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(o,w,L)):this.client.core.relayer.publish(o,w,L).catch(H=>this.client.logger.error(H)),await this.client.core.history.resolve(g)},this.sendError=async(i,n,o)=>{const h=Eo(i,o),p=await this.client.core.crypto.encode(n,h),g=await this.client.core.history.get(n,i),w=Vs[g.request.method].res;this.client.core.relayer.publish(n,p,w),await this.client.core.history.resolve(h)},this.cleanup=async()=>{const i=[],n=[];this.client.session.getAll().forEach(o=>{bi(o.expiry)&&i.push(o.topic)}),this.client.proposal.getAll().forEach(o=>{bi(o.expiry)&&n.push(o.id)}),await Promise.all([...i.map(o=>this.deleteSession(o)),...n.map(o=>this.deleteProposal(o))])},this.onRelayEventRequest=async i=>{this.requestQueue.queue.push(i),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===oi.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=oi.active;const i=this.requestQueue.queue.shift();if(i)try{this.processRequest(i),await new Promise(n=>setTimeout(n,300))}catch(n){this.client.logger.warn(n)}}this.requestQueue.state=oi.idle},this.processRequest=i=>{const{topic:n,payload:o}=i,h=o.method;switch(h){case"wc_sessionPropose":return this.onSessionProposeRequest(n,o);case"wc_sessionSettle":return this.onSessionSettleRequest(n,o);case"wc_sessionUpdate":return this.onSessionUpdateRequest(n,o);case"wc_sessionExtend":return this.onSessionExtendRequest(n,o);case"wc_sessionPing":return this.onSessionPingRequest(n,o);case"wc_sessionDelete":return this.onSessionDeleteRequest(n,o);case"wc_sessionRequest":return this.onSessionRequest(n,o);case"wc_sessionEvent":return this.onSessionEventRequest(n,o);default:return this.client.logger.info(`Unsupported request method ${h}`)}},this.onRelayEventResponse=async i=>{const{topic:n,payload:o}=i,h=(await this.client.core.history.get(n,o.id)).request.method;switch(h){case"wc_sessionPropose":return this.onSessionProposeResponse(n,o);case"wc_sessionSettle":return this.onSessionSettleResponse(n,o);case"wc_sessionUpdate":return this.onSessionUpdateResponse(n,o);case"wc_sessionExtend":return this.onSessionExtendResponse(n,o);case"wc_sessionPing":return this.onSessionPingResponse(n,o);case"wc_sessionRequest":return this.onSessionRequestResponse(n,o);default:return this.client.logger.info(`Unsupported response method ${h}`)}},this.onRelayEventUnknownPayload=i=>{const{topic:n}=i,{message:o}=Z("MISSING_OR_INVALID",`Decoded payload on topic ${n} is not identifiable as a JSON-RPC request or a response.`);throw new Error(o)},this.onSessionProposeRequest=async(i,n)=>{const{params:o,id:h}=n;try{this.isValidConnect(cr({},n.params));const p=Dr(se.FIVE_MINUTES),g=cr({id:h,pairingTopic:i,expiry:p},o);await this.setProposal(h,g);const w=ds(JSON.stringify(n)),S=await this.getVerifyContext(w,g.proposer.metadata);this.client.events.emit("session_proposal",{id:h,params:g,verifyContext:S})}catch(p){await this.sendError(h,i,p),this.client.logger.error(p)}},this.onSessionProposeResponse=async(i,n)=>{const{id:o}=n;if(ai(n)){const{result:h}=n;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:h});const p=this.client.proposal.get(o);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:p});const g=p.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:g});const w=h.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:w});const S=await this.client.core.crypto.generateSharedKey(g,w);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:S});const L=await this.client.core.relayer.subscribe(S);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:L}),await this.client.core.pairing.activate({topic:i})}else $r(n)&&(await this.client.proposal.delete(o,tr("USER_DISCONNECTED")),this.events.emit(Ft("session_connect"),{error:n.error}))},this.onSessionSettleRequest=async(i,n)=>{const{id:o,params:h}=n;try{this.isValidSessionSettleRequest(h);const{relay:p,controller:g,expiry:w,namespaces:S,requiredNamespaces:L,optionalNamespaces:H,sessionProperties:B,pairingTopic:K}=n.params,q=cr({topic:i,relay:p,expiry:w,namespaces:S,acknowledged:!0,pairingTopic:K,requiredNamespaces:L,optionalNamespaces:H,controller:g.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:g.publicKey,metadata:g.metadata}},B&&{sessionProperties:B});await this.sendResult({id:n.id,topic:i,result:!0}),this.events.emit(Ft("session_connect"),{session:q}),this.cleanupDuplicatePairings(q)}catch(p){await this.sendError(o,i,p),this.client.logger.error(p)}},this.onSessionSettleResponse=async(i,n)=>{const{id:o}=n;ai(n)?(await this.client.session.update(i,{acknowledged:!0}),this.events.emit(Ft("session_approve",o),{})):$r(n)&&(await this.client.session.delete(i,tr("USER_DISCONNECTED")),this.events.emit(Ft("session_approve",o),{error:n.error}))},this.onSessionUpdateRequest=async(i,n)=>{const{params:o,id:h}=n;try{const p=`${i}_session_update`,g=ao.get(p);if(g&&this.isRequestOutOfSync(g,h)){this.client.logger.info(`Discarding out of sync request - ${h}`);return}this.isValidUpdate(cr({topic:i},o)),await this.client.session.update(i,{namespaces:o.namespaces}),await this.sendResult({id:h,topic:i,result:!0}),this.client.events.emit("session_update",{id:h,topic:i,params:o}),ao.set(p,h)}catch(p){await this.sendError(h,i,p),this.client.logger.error(p)}},this.isRequestOutOfSync=(i,n)=>parseInt(n.toString().slice(0,-3))<=parseInt(i.toString().slice(0,-3)),this.onSessionUpdateResponse=(i,n)=>{const{id:o}=n;ai(n)?this.events.emit(Ft("session_update",o),{}):$r(n)&&this.events.emit(Ft("session_update",o),{error:n.error})},this.onSessionExtendRequest=async(i,n)=>{const{id:o}=n;try{this.isValidExtend({topic:i}),await this.setExpiry(i,Dr(co)),await this.sendResult({id:o,topic:i,result:!0}),this.client.events.emit("session_extend",{id:o,topic:i})}catch(h){await this.sendError(o,i,h),this.client.logger.error(h)}},this.onSessionExtendResponse=(i,n)=>{const{id:o}=n;ai(n)?this.events.emit(Ft("session_extend",o),{}):$r(n)&&this.events.emit(Ft("session_extend",o),{error:n.error})},this.onSessionPingRequest=async(i,n)=>{const{id:o}=n;try{this.isValidPing({topic:i}),await this.sendResult({id:o,topic:i,result:!0}),this.client.events.emit("session_ping",{id:o,topic:i})}catch(h){await this.sendError(o,i,h),this.client.logger.error(h)}},this.onSessionPingResponse=(i,n)=>{const{id:o}=n;setTimeout(()=>{ai(n)?this.events.emit(Ft("session_ping",o),{}):$r(n)&&this.events.emit(Ft("session_ping",o),{error:n.error})},500)},this.onSessionDeleteRequest=async(i,n)=>{const{id:o}=n;try{this.isValidDisconnect({topic:i,reason:n.params}),await Promise.all([new Promise(h=>{this.client.core.relayer.once(Gt.publish,async()=>{h(await this.deleteSession(i))})}),this.sendResult({id:o,topic:i,result:!0})]),this.client.events.emit("session_delete",{id:o,topic:i})}catch(h){this.client.logger.error(h)}},this.onSessionRequest=async(i,n)=>{const{id:o,params:h}=n;try{this.isValidRequest(cr({topic:i},h));const p=ds(JSON.stringify(vs("wc_sessionRequest",h,o))),g=this.client.session.get(i),w=await this.getVerifyContext(p,g.peer.metadata),S={id:o,topic:i,params:h,verifyContext:w};await this.setPendingSessionRequest(S),this.addSessionRequestToSessionRequestQueue(S),this.processSessionRequestQueue()}catch(p){await this.sendError(o,i,p),this.client.logger.error(p)}},this.onSessionRequestResponse=(i,n)=>{const{id:o}=n;ai(n)?this.events.emit(Ft("session_request",o),{result:n.result}):$r(n)&&this.events.emit(Ft("session_request",o),{error:n.error})},this.onSessionEventRequest=async(i,n)=>{const{id:o,params:h}=n;try{const p=`${i}_session_event_${h.event.name}`,g=ao.get(p);if(g&&this.isRequestOutOfSync(g,o)){this.client.logger.info(`Discarding out of sync request - ${o}`);return}this.isValidEmit(cr({topic:i},h)),this.client.events.emit("session_event",{id:o,topic:i,params:h}),ao.set(p,o)}catch(p){await this.sendError(o,i,p),this.client.logger.error(p)}},this.addSessionRequestToSessionRequestQueue=i=>{this.sessionRequestQueue.queue.push(i)},this.cleanupAfterResponse=i=>{this.deletePendingSessionRequest(i.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=oi.idle,this.processSessionRequestQueue()},se.toMiliseconds(this.requestQueueDelay))},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===oi.active){this.client.logger.info("session request queue is already active.");return}const i=this.sessionRequestQueue.queue[0];if(!i){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=oi.active,this.client.events.emit("session_request",i)}catch(n){this.client.logger.error(n)}},this.onPairingCreated=i=>{if(i.active)return;const n=this.client.proposal.getAll().find(o=>o.pairingTopic===i.topic);n&&this.onSessionProposeRequest(i.topic,vs("wc_sessionPropose",{requiredNamespaces:n.requiredNamespaces,optionalNamespaces:n.optionalNamespaces,relays:n.relays,proposer:n.proposer},n.id))},this.isValidConnect=async i=>{if(!ur(i)){const{message:w}=Z("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(i)}`);throw new Error(w)}const{pairingTopic:n,requiredNamespaces:o,optionalNamespaces:h,sessionProperties:p,relays:g}=i;if(Ei(n)||await this.isValidPairingTopic(n),!Wm(g,!0)){const{message:w}=Z("MISSING_OR_INVALID",`connect() relays: ${g}`);throw new Error(w)}!Ei(o)&&fo(o)!==0&&this.validateNamespaces(o,"requiredNamespaces"),!Ei(h)&&fo(h)!==0&&this.validateNamespaces(h,"optionalNamespaces"),Ei(p)||this.validateSessionProps(p,"sessionProperties")},this.validateNamespaces=(i,n)=>{const o=Jm(i,"connect()",n);if(o)throw new Error(o.message)},this.isValidApprove=async i=>{if(!ur(i))throw new Error(Z("MISSING_OR_INVALID",`approve() params: ${i}`).message);const{id:n,namespaces:o,relayProtocol:h,sessionProperties:p}=i;await this.isValidProposalId(n);const g=this.client.proposal.get(n),w=Qa(o,"approve()");if(w)throw new Error(w.message);const S=qh(g.requiredNamespaces,o,"approve()");if(S)throw new Error(S.message);if(!fs(h,!0)){const{message:L}=Z("MISSING_OR_INVALID",`approve() relayProtocol: ${h}`);throw new Error(L)}Ei(p)||this.validateSessionProps(p,"sessionProperties")},this.isValidReject=async i=>{if(!ur(i)){const{message:h}=Z("MISSING_OR_INVALID",`reject() params: ${i}`);throw new Error(h)}const{id:n,reason:o}=i;if(await this.isValidProposalId(n),!Qm(o)){const{message:h}=Z("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(o)}`);throw new Error(h)}},this.isValidSessionSettleRequest=i=>{if(!ur(i)){const{message:S}=Z("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${i}`);throw new Error(S)}const{relay:n,controller:o,namespaces:h,expiry:p}=i;if(!Ym(n)){const{message:S}=Z("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(S)}const g=Xm(o,"onSessionSettleRequest()");if(g)throw new Error(g.message);const w=Qa(h,"onSessionSettleRequest()");if(w)throw new Error(w.message);if(bi(p)){const{message:S}=Z("EXPIRED","onSessionSettleRequest()");throw new Error(S)}},this.isValidUpdate=async i=>{if(!ur(i)){const{message:w}=Z("MISSING_OR_INVALID",`update() params: ${i}`);throw new Error(w)}const{topic:n,namespaces:o}=i;await this.isValidSessionTopic(n);const h=this.client.session.get(n),p=Qa(o,"update()");if(p)throw new Error(p.message);const g=qh(h.requiredNamespaces,o,"update()");if(g)throw new Error(g.message)},this.isValidExtend=async i=>{if(!ur(i)){const{message:o}=Z("MISSING_OR_INVALID",`extend() params: ${i}`);throw new Error(o)}const{topic:n}=i;await this.isValidSessionTopic(n)},this.isValidRequest=async i=>{if(!ur(i)){const{message:w}=Z("MISSING_OR_INVALID",`request() params: ${i}`);throw new Error(w)}const{topic:n,request:o,chainId:h,expiry:p}=i;await this.isValidSessionTopic(n);const{namespaces:g}=this.client.session.get(n);if(!Mh(g,h)){const{message:w}=Z("MISSING_OR_INVALID",`request() chainId: ${h}`);throw new Error(w)}if(!Zm(o)){const{message:w}=Z("MISSING_OR_INVALID",`request() ${JSON.stringify(o)}`);throw new Error(w)}if(!e1(g,h,o.method)){const{message:w}=Z("MISSING_OR_INVALID",`request() method: ${o.method}`);throw new Error(w)}if(p&&!t1(p,ac)){const{message:w}=Z("MISSING_OR_INVALID",`request() expiry: ${p}. Expiry must be a number (in seconds) between ${ac.min} and ${ac.max}`);throw new Error(w)}},this.isValidRespond=async i=>{if(!ur(i)){const{message:h}=Z("MISSING_OR_INVALID",`respond() params: ${i}`);throw new Error(h)}const{topic:n,response:o}=i;if(await this.isValidSessionTopic(n),!r1(o)){const{message:h}=Z("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(o)}`);throw new Error(h)}},this.isValidPing=async i=>{if(!ur(i)){const{message:o}=Z("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(o)}const{topic:n}=i;await this.isValidSessionOrPairingTopic(n)},this.isValidEmit=async i=>{if(!ur(i)){const{message:g}=Z("MISSING_OR_INVALID",`emit() params: ${i}`);throw new Error(g)}const{topic:n,event:o,chainId:h}=i;await this.isValidSessionTopic(n);const{namespaces:p}=this.client.session.get(n);if(!Mh(p,h)){const{message:g}=Z("MISSING_OR_INVALID",`emit() chainId: ${h}`);throw new Error(g)}if(!i1(o)){const{message:g}=Z("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(o)}`);throw new Error(g)}if(!s1(p,h,o.name)){const{message:g}=Z("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(o)}`);throw new Error(g)}},this.isValidDisconnect=async i=>{if(!ur(i)){const{message:o}=Z("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(o)}const{topic:n}=i;await this.isValidSessionOrPairingTopic(n)},this.getVerifyContext=async(i,n)=>{const o={verified:{verifyUrl:n.verifyUrl||go,validation:"UNKNOWN",origin:n.url||""}};try{const h=await this.client.core.verify.resolve({attestationId:i,verifyUrl:n.verifyUrl});h&&(o.verified.origin=h.origin,o.verified.isScam=h.isScam,o.verified.validation=h.origin===new URL(n.url).origin?"VALID":"INVALID")}catch(h){this.client.logger.info(h)}return this.client.logger.info(`Verify context: ${JSON.stringify(o)}`),o},this.validateSessionProps=(i,n)=>{Object.values(i).forEach(o=>{if(!fs(o,!1)){const{message:h}=Z("MISSING_OR_INVALID",`${n} must be in Record<string, string> format. Received: ${JSON.stringify(o)}`);throw new Error(h)}})}}async isInitialized(){if(!this.initialized){const{message:r}=Z("NOT_INITIALIZED",this.name);throw new Error(r)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Gt.message,async r=>{const{topic:i,message:n}=r;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(n)))return;const o=await this.client.core.crypto.decode(i,n);try{Rc(o)?(this.client.core.history.set(i,o),this.onRelayEventRequest({topic:i,payload:o})):xo(o)?(await this.client.core.history.resolve(o),await this.onRelayEventResponse({topic:i,payload:o}),this.client.core.history.delete(i,o.id)):this.onRelayEventUnknownPayload({topic:i,payload:o})}catch(h){this.client.logger.error(h)}})}registerExpirerEvents(){this.client.core.expirer.on(Or.expired,async r=>{const{topic:i,id:n}=Wl(r.target);if(n&&this.client.pendingRequest.keys.includes(n))return await this.deletePendingSessionRequest(n,Z("EXPIRED"),!0);i?this.client.session.keys.includes(i)&&(await this.deleteSession(i,!0),this.client.events.emit("session_expire",{topic:i})):n&&(await this.deleteProposal(n,!0),this.client.events.emit("proposal_expire",{id:n}))})}registerPairingEvents(){this.client.core.pairing.events.on(Js.create,r=>this.onPairingCreated(r))}isValidPairingTopic(r){if(!fs(r,!1)){const{message:i}=Z("MISSING_OR_INVALID",`pairing topic should be a string: ${r}`);throw new Error(i)}if(!this.client.core.pairing.pairings.keys.includes(r)){const{message:i}=Z("NO_MATCHING_KEY",`pairing topic doesn't exist: ${r}`);throw new Error(i)}if(bi(this.client.core.pairing.pairings.get(r).expiry)){const{message:i}=Z("EXPIRED",`pairing topic: ${r}`);throw new Error(i)}}async isValidSessionTopic(r){if(!fs(r,!1)){const{message:i}=Z("MISSING_OR_INVALID",`session topic should be a string: ${r}`);throw new Error(i)}if(!this.client.session.keys.includes(r)){const{message:i}=Z("NO_MATCHING_KEY",`session topic doesn't exist: ${r}`);throw new Error(i)}if(bi(this.client.session.get(r).expiry)){await this.deleteSession(r);const{message:i}=Z("EXPIRED",`session topic: ${r}`);throw new Error(i)}}async isValidSessionOrPairingTopic(r){if(this.client.session.keys.includes(r))await this.isValidSessionTopic(r);else if(this.client.core.pairing.pairings.keys.includes(r))this.isValidPairingTopic(r);else if(fs(r,!1)){const{message:i}=Z("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${r}`);throw new Error(i)}else{const{message:i}=Z("MISSING_OR_INVALID",`session or pairing topic should be a string: ${r}`);throw new Error(i)}}async isValidProposalId(r){if(!n1(r)){const{message:i}=Z("MISSING_OR_INVALID",`proposal id should be a number: ${r}`);throw new Error(i)}if(!this.client.proposal.keys.includes(r)){const{message:i}=Z("NO_MATCHING_KEY",`proposal id doesn't exist: ${r}`);throw new Error(i)}if(bi(this.client.proposal.get(r).expiry)){await this.deleteProposal(r);const{message:i}=Z("EXPIRED",`proposal id: ${r}`);throw new Error(i)}}}class hE extends Po{constructor(r,i){super(r,i,Zb,Nc),this.core=r,this.logger=i}}class lE extends Po{constructor(r,i){super(r,i,eE,Nc),this.core=r,this.logger=i}}class fE extends Po{constructor(r,i){super(r,i,rE,Nc,n=>n.id),this.core=r,this.logger=i}}let pE=class Uf extends U1{constructor(r){super(r),this.protocol=qf,this.version=Mf,this.name=oc.name,this.events=new yr.EventEmitter,this.on=(n,o)=>this.events.on(n,o),this.once=(n,o)=>this.events.once(n,o),this.off=(n,o)=>this.events.off(n,o),this.removeListener=(n,o)=>this.events.removeListener(n,o),this.removeAllListeners=n=>this.events.removeAllListeners(n),this.connect=async n=>{try{return await this.engine.connect(n)}catch(o){throw this.logger.error(o.message),o}},this.pair=async n=>{try{return await this.engine.pair(n)}catch(o){throw this.logger.error(o.message),o}},this.approve=async n=>{try{return await this.engine.approve(n)}catch(o){throw this.logger.error(o.message),o}},this.reject=async n=>{try{return await this.engine.reject(n)}catch(o){throw this.logger.error(o.message),o}},this.update=async n=>{try{return await this.engine.update(n)}catch(o){throw this.logger.error(o.message),o}},this.extend=async n=>{try{return await this.engine.extend(n)}catch(o){throw this.logger.error(o.message),o}},this.request=async n=>{try{return await this.engine.request(n)}catch(o){throw this.logger.error(o.message),o}},this.respond=async n=>{try{return await this.engine.respond(n)}catch(o){throw this.logger.error(o.message),o}},this.ping=async n=>{try{return await this.engine.ping(n)}catch(o){throw this.logger.error(o.message),o}},this.emit=async n=>{try{return await this.engine.emit(n)}catch(o){throw this.logger.error(o.message),o}},this.disconnect=async n=>{try{return await this.engine.disconnect(n)}catch(o){throw this.logger.error(o.message),o}},this.find=n=>{try{return this.engine.find(n)}catch(o){throw this.logger.error(o.message),o}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(n){throw this.logger.error(n.message),n}},this.name=(r==null?void 0:r.name)||oc.name,this.metadata=(r==null?void 0:r.metadata)||Bm();const i=typeof(r==null?void 0:r.logger)<"u"&&typeof(r==null?void 0:r.logger)!="string"?r.logger:Ce.pino(Ce.getDefaultLoggerOptions({level:(r==null?void 0:r.logger)||oc.logger}));this.core=(r==null?void 0:r.core)||new Xb(r),this.logger=Ce.generateChildLogger(i,this.name),this.session=new lE(this.core,this.logger),this.proposal=new hE(this.core,this.logger),this.pendingRequest=new fE(this.core,this.logger),this.engine=new uE(this)}static async init(r){const i=new Uf(r);return await i.initialize(),i}get context(){return Ce.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(r){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(r.message),r}}};var vc={exports:{}};(function(c,r){var i=typeof self<"u"?self:hr,n=function(){function h(){this.fetch=!1,this.DOMException=i.DOMException}return h.prototype=i,new h}();(function(h){(function(p){var g={searchParams:"URLSearchParams"in h,iterable:"Symbol"in h&&"iterator"in Symbol,blob:"FileReader"in h&&"Blob"in h&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in h,arrayBuffer:"ArrayBuffer"in h};function w(y){return y&&DataView.prototype.isPrototypeOf(y)}if(g.arrayBuffer)var S=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],L=ArrayBuffer.isView||function(y){return y&&S.indexOf(Object.prototype.toString.call(y))>-1};function H(y){if(typeof y!="string"&&(y=String(y)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(y))throw new TypeError("Invalid character in header field name");return y.toLowerCase()}function B(y){return typeof y!="string"&&(y=String(y)),y}function K(y){var E={next:function(){var Y=y.shift();return{done:Y===void 0,value:Y}}};return g.iterable&&(E[Symbol.iterator]=function(){return E}),E}function q(y){this.map={},y instanceof q?y.forEach(function(E,Y){this.append(Y,E)},this):Array.isArray(y)?y.forEach(function(E){this.append(E[0],E[1])},this):y&&Object.getOwnPropertyNames(y).forEach(function(E){this.append(E,y[E])},this)}q.prototype.append=function(y,E){y=H(y),E=B(E);var Y=this.map[y];this.map[y]=Y?Y+", "+E:E},q.prototype.delete=function(y){delete this.map[H(y)]},q.prototype.get=function(y){return y=H(y),this.has(y)?this.map[y]:null},q.prototype.has=function(y){return this.map.hasOwnProperty(H(y))},q.prototype.set=function(y,E){this.map[H(y)]=B(E)},q.prototype.forEach=function(y,E){for(var Y in this.map)this.map.hasOwnProperty(Y)&&y.call(E,this.map[Y],Y,this)},q.prototype.keys=function(){var y=[];return this.forEach(function(E,Y){y.push(Y)}),K(y)},q.prototype.values=function(){var y=[];return this.forEach(function(E){y.push(E)}),K(y)},q.prototype.entries=function(){var y=[];return this.forEach(function(E,Y){y.push([Y,E])}),K(y)},g.iterable&&(q.prototype[Symbol.iterator]=q.prototype.entries);function W(y){if(y.bodyUsed)return Promise.reject(new TypeError("Already read"));y.bodyUsed=!0}function ie(y){return new Promise(function(E,Y){y.onload=function(){E(y.result)},y.onerror=function(){Y(y.error)}})}function Ee(y){var E=new FileReader,Y=ie(E);return E.readAsArrayBuffer(y),Y}function ge(y){var E=new FileReader,Y=ie(E);return E.readAsText(y),Y}function pe(y){for(var E=new Uint8Array(y),Y=new Array(E.length),ce=0;ce<E.length;ce++)Y[ce]=String.fromCharCode(E[ce]);return Y.join("")}function he(y){if(y.slice)return y.slice(0);var E=new Uint8Array(y.byteLength);return E.set(new Uint8Array(y)),E.buffer}function le(){return this.bodyUsed=!1,this._initBody=function(y){this._bodyInit=y,y?typeof y=="string"?this._bodyText=y:g.blob&&Blob.prototype.isPrototypeOf(y)?this._bodyBlob=y:g.formData&&FormData.prototype.isPrototypeOf(y)?this._bodyFormData=y:g.searchParams&&URLSearchParams.prototype.isPrototypeOf(y)?this._bodyText=y.toString():g.arrayBuffer&&g.blob&&w(y)?(this._bodyArrayBuffer=he(y.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):g.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(y)||L(y))?this._bodyArrayBuffer=he(y):this._bodyText=y=Object.prototype.toString.call(y):this._bodyText="",this.headers.get("content-type")||(typeof y=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):g.searchParams&&URLSearchParams.prototype.isPrototypeOf(y)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},g.blob&&(this.blob=function(){var y=W(this);if(y)return y;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?W(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(Ee)}),this.text=function(){var y=W(this);if(y)return y;if(this._bodyBlob)return ge(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(pe(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},g.formData&&(this.formData=function(){return this.text().then(ve)}),this.json=function(){return this.text().then(JSON.parse)},this}var T=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function M(y){var E=y.toUpperCase();return T.indexOf(E)>-1?E:y}function G(y,E){E=E||{};var Y=E.body;if(y instanceof G){if(y.bodyUsed)throw new TypeError("Already read");this.url=y.url,this.credentials=y.credentials,E.headers||(this.headers=new q(y.headers)),this.method=y.method,this.mode=y.mode,this.signal=y.signal,!Y&&y._bodyInit!=null&&(Y=y._bodyInit,y.bodyUsed=!0)}else this.url=String(y);if(this.credentials=E.credentials||this.credentials||"same-origin",(E.headers||!this.headers)&&(this.headers=new q(E.headers)),this.method=M(E.method||this.method||"GET"),this.mode=E.mode||this.mode||null,this.signal=E.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&Y)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(Y)}G.prototype.clone=function(){return new G(this,{body:this._bodyInit})};function ve(y){var E=new FormData;return y.trim().split("&").forEach(function(Y){if(Y){var ce=Y.split("="),k=ce.shift().replace(/\+/g," "),j=ce.join("=").replace(/\+/g," ");E.append(decodeURIComponent(k),decodeURIComponent(j))}}),E}function re(y){var E=new q,Y=y.replace(/\r?\n[\t ]+/g," ");return Y.split(/\r?\n/).forEach(function(ce){var k=ce.split(":"),j=k.shift().trim();if(j){var U=k.join(":").trim();E.append(j,U)}}),E}le.call(G.prototype);function ue(y,E){E||(E={}),this.type="default",this.status=E.status===void 0?200:E.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in E?E.statusText:"OK",this.headers=new q(E.headers),this.url=E.url||"",this._initBody(y)}le.call(ue.prototype),ue.prototype.clone=function(){return new ue(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new q(this.headers),url:this.url})},ue.error=function(){var y=new ue(null,{status:0,statusText:""});return y.type="error",y};var Te=[301,302,303,307,308];ue.redirect=function(y,E){if(Te.indexOf(E)===-1)throw new RangeError("Invalid status code");return new ue(null,{status:E,headers:{location:y}})},p.DOMException=h.DOMException;try{new p.DOMException}catch{p.DOMException=function(E,Y){this.message=E,this.name=Y;var ce=Error(E);this.stack=ce.stack},p.DOMException.prototype=Object.create(Error.prototype),p.DOMException.prototype.constructor=p.DOMException}function ze(y,E){return new Promise(function(Y,ce){var k=new G(y,E);if(k.signal&&k.signal.aborted)return ce(new p.DOMException("Aborted","AbortError"));var j=new XMLHttpRequest;function U(){j.abort()}j.onload=function(){var V={status:j.status,statusText:j.statusText,headers:re(j.getAllResponseHeaders()||"")};V.url="responseURL"in j?j.responseURL:V.headers.get("X-Request-URL");var Qe="response"in j?j.response:j.responseText;Y(new ue(Qe,V))},j.onerror=function(){ce(new TypeError("Network request failed"))},j.ontimeout=function(){ce(new TypeError("Network request failed"))},j.onabort=function(){ce(new p.DOMException("Aborted","AbortError"))},j.open(k.method,k.url,!0),k.credentials==="include"?j.withCredentials=!0:k.credentials==="omit"&&(j.withCredentials=!1),"responseType"in j&&g.blob&&(j.responseType="blob"),k.headers.forEach(function(V,Qe){j.setRequestHeader(Qe,V)}),k.signal&&(k.signal.addEventListener("abort",U),j.onreadystatechange=function(){j.readyState===4&&k.signal.removeEventListener("abort",U)}),j.send(typeof k._bodyInit>"u"?null:k._bodyInit)})}return ze.polyfill=!0,h.fetch||(h.fetch=ze,h.Headers=q,h.Request=G,h.Response=ue),p.Headers=q,p.Request=G,p.Response=ue,p.fetch=ze,Object.defineProperty(p,"__esModule",{value:!0}),p})({})})(n),n.fetch.ponyfill=!0,delete n.fetch.polyfill;var o=n;r=o.fetch,r.default=o.fetch,r.fetch=o.fetch,r.Headers=o.Headers,r.Request=o.Request,r.Response=o.Response,c.exports=r})(vc,vc.exports);var dE=vc.exports;const Nl=_c(dE),gE={Accept:"application/json","Content-Type":"application/json"},vE="POST",Ll={headers:gE,method:vE},Fl=10;class Si{constructor(r,i=!1){if(this.url=r,this.disableProviderPing=i,this.events=new yr.EventEmitter,this.isAvailable=!1,this.registering=!1,!ol(r))throw new Error(`Provided URL is not compatible with HTTP connection: ${r}`);this.url=r,this.disableProviderPing=i}get connected(){return this.isAvailable}get connecting(){return this.registering}on(r,i){this.events.on(r,i)}once(r,i){this.events.once(r,i)}off(r,i){this.events.off(r,i)}removeListener(r,i){this.events.removeListener(r,i)}async open(r=this.url){await this.register(r)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(r,i){this.isAvailable||await this.register();try{const n=Zs(r),h=await(await Nl(this.url,Object.assign(Object.assign({},Ll),{body:n}))).json();this.onPayload({data:h})}catch(n){this.onError(r.id,n)}}async register(r=this.url){if(!ol(r))throw new Error(`Provided URL is not compatible with HTTP connection: ${r}`);if(this.registering){const i=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=i||this.events.listenerCount("open")>=i)&&this.events.setMaxListeners(i+1),new Promise((n,o)=>{this.events.once("register_error",h=>{this.resetMaxListeners(),o(h)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return o(new Error("HTTP connection is missing or invalid"));n()})})}this.url=r,this.registering=!0;try{if(!this.disableProviderPing){const i=Zs({id:1,jsonrpc:"2.0",method:"test",params:[]});await Nl(r,Object.assign(Object.assign({},Ll),{body:i}))}this.onOpen()}catch(i){const n=this.parseError(i);throw this.events.emit("register_error",n),this.onClose(),n}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(r){if(typeof r.data>"u")return;const i=typeof r.data=="string"?Ic(r.data):r.data;this.events.emit("payload",i)}onError(r,i){const n=this.parseError(i),o=n.message||n.toString(),h=Eo(r,o);this.events.emit("payload",h)}parseError(r,i=this.url){return mf(r,i,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>Fl&&this.events.setMaxListeners(Fl)}}const Dl="error",yE="wss://relay.walletconnect.com",mE="wc",wE="universal_provider",$l=`${mE}@2:${wE}:`,_E="https://rpc.walletconnect.com/v1/",ui={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var Gs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},yc={exports:{}};/**
* @license
* Lodash <https://lodash.com/>
* Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
* Released under MIT license <https://lodash.com/license>
* Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
* Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
*/(function(c,r){(function(){var i,n="4.17.21",o=200,h="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",p="Expected a function",g="Invalid `variable` option passed into `_.template`",w="__lodash_hash_undefined__",S=500,L="__lodash_placeholder__",H=1,B=2,K=4,q=1,W=2,ie=1,Ee=2,ge=4,pe=8,he=16,le=32,T=64,M=128,G=256,ve=512,re=30,ue="...",Te=800,ze=16,y=1,E=2,Y=3,ce=1/0,k=9007199254740991,j=17976931348623157e292,U=0/0,V=4294967295,Qe=V-1,Be=V>>>1,qr=[["ary",M],["bind",ie],["bindKey",Ee],["curry",pe],["curryRight",he],["flip",ve],["partial",le],["partialRight",T],["rearg",G]],xe="[object Arguments]",It="[object Array]",C="[object AsyncFunction]",R="[object Boolean]",O="[object Date]",u="[object DOMException]",b="[object Error]",ee="[object Function]",fe="[object GeneratorFunction]",_e="[object Map]",Ne="[object Number]",Fe="[object Null]",Se="[object Object]",Pt="[object Promise]",wt="[object Proxy]",at="[object RegExp]",$e="[object Set]",Xe="[object String]",Ze="[object Symbol]",ct="[object Undefined]",Ue="[object WeakMap]",et="[object WeakSet]",Le="[object ArrayBuffer]",Ve="[object DataView]",lt="[object Float32Array]",Me="[object Float64Array]",St="[object Int8Array]",Dt="[object Int16Array]",Ut="[object Int32Array]",Ht="[object Uint8Array]",Mt="[object Uint8ClampedArray]",Wt="[object Uint16Array]",rr="[object Uint32Array]",Mr=/\b__p \+= '';/g,Jt=/\b(__p \+=) '' \+/g,Vr=/(__e\(.*?\)|\b__t\)) \+\n'';/g,hi=/&(?:amp|lt|gt|quot|#39);/g,Oi=/[&<>"']/g,ft=RegExp(hi.source),it=RegExp(Oi.source),pt=/<%-([\s\S]+?)%>/g,dt=/<%([\s\S]+?)%>/g,ut=/<%=([\s\S]+?)%>/g,st=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ot=/^\w*$/,At=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,gt=/[\\^$.*+?()[\]{}|]/g,Rt=RegExp(gt.source),vt=/^\s+/,_t=/\s/,yt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Ye=/\{\n\/\* \[wrapped with (.+)\] \*/,Ct=/,? & /,Tt=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,So=/[()=,{}\[\]\/\s]/,Oo=/\\(\\)?/g,Ao=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,mr=/\w*$/,Ro=/^[-+]0x[0-9a-f]+$/i,Co=/^0b[01]+$/i,To=/^\[object .+?Constructor\]$/,No=/^0o[0-7]+$/i,Lo=/^(?:0|[1-9]\d*)$/,Kr=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Vi=/($^)/,Fo=/['\n\r\u2028\u2029\\]/g,Ki="\\ud800-\\udfff",Do="\\u0300-\\u036f",$o="\\ufe20-\\ufe2f",Gi="\\u20d0-\\u20ff",rn=Do+$o+Gi,sn="\\u2700-\\u27bf",Ar="a-z\\xdf-\\xf6\\xf8-\\xff",qo="\\xac\\xb1\\xd7\\xf7",Mo="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",jo="\\u2000-\\u206f",zo=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",nn="A-Z\\xc0-\\xd6\\xd8-\\xde",on="\\ufe0e\\ufe0f",Ai=qo+Mo+jo+zo,ws="[']",Ri="["+Ki+"]",_s="["+Ai+"]",Ci="["+rn+"]",an="\\d+",Uo="["+sn+"]",cn="["+Ar+"]",un="[^"+Ki+Ai+an+sn+Ar+nn+"]",Wi="\\ud83c[\\udffb-\\udfff]",Ho="(?:"+Ci+"|"+Wi+")",hn="[^"+Ki+"]",Ji="(?:\\ud83c[\\udde6-\\uddff]){2}",li="[\\ud800-\\udbff][\\udc00-\\udfff]",lr="["+nn+"]",ln="\\u200d",fn="(?:"+cn+"|"+un+")",jr="(?:"+lr+"|"+un+")",pn="(?:"+ws+"(?:d|ll|m|re|s|t|ve))?",dn="(?:"+ws+"(?:D|LL|M|RE|S|T|VE))?",gn=Ho+"?",vn="["+on+"]?",ko="(?:"+ln+"(?:"+[hn,Ji,li].join("|")+")"+vn+gn+")*",Gr="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",yn="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",mn=vn+gn+ko,Qi="(?:"+[Uo,Ji,li].join("|")+")"+mn,Bo="(?:"+[hn+Ci+"?",Ci,Ji,li,Ri].join("|")+")",bs=RegExp(ws,"g"),Vo=RegExp(Ci,"g"),Yi=RegExp(Wi+"(?="+Wi+")|"+Bo+mn,"g"),wn=RegExp([lr+"?"+cn+"+"+pn+"(?="+[_s,lr,"$"].join("|")+")",jr+"+"+dn+"(?="+[_s,lr+fn,"$"].join("|")+")",lr+"?"+fn+"+"+pn,lr+"+"+dn,yn,Gr,an,Qi].join("|"),"g"),_n=RegExp("["+ln+Ki+rn+on+"]"),Ti=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,bn=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Ko=-1,Ke={};Ke[lt]=Ke[Me]=Ke[St]=Ke[Dt]=Ke[Ut]=Ke[Ht]=Ke[Mt]=Ke[Wt]=Ke[rr]=!0,Ke[xe]=Ke[It]=Ke[Le]=Ke[R]=Ke[Ve]=Ke[O]=Ke[b]=Ke[ee]=Ke[_e]=Ke[Ne]=Ke[Se]=Ke[at]=Ke[$e]=Ke[Xe]=Ke[Ue]=!1;var He={};He[xe]=He[It]=He[Le]=He[Ve]=He[R]=He[O]=He[lt]=He[Me]=He[St]=He[Dt]=He[Ut]=He[_e]=He[Ne]=He[Se]=He[at]=He[$e]=He[Xe]=He[Ze]=He[Ht]=He[Mt]=He[Wt]=He[rr]=!0,He[b]=He[ee]=He[Ue]=!1;var v={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"},x={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},$={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Q={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Ge=parseFloat,ye=parseInt,tt=typeof Gs=="object"&&Gs&&Gs.Object===Object&&Gs,Nt=typeof self=="object"&&self&&self.Object===Object&&self,Ae=tt||Nt||Function("return this")(),We=r&&!r.nodeType&&r,bt=We&&!0&&c&&!c.nodeType&&c,ir=bt&&bt.exports===We,Lt=ir&&tt.process,rt=function(){try{var I=bt&&bt.require&&bt.require("util").types;return I||Lt&&Lt.binding&&Lt.binding("util")}catch{}}(),Qt=rt&&rt.isArrayBuffer,Rr=rt&&rt.isDate,wr=rt&&rt.isMap,zr=rt&&rt.isRegExp,Es=rt&&rt.isSet,Ni=rt&&rt.isTypedArray;function jt(I,N,A){switch(A.length){case 0:return I.call(N);case 1:return I.call(N,A[0]);case 2:return I.call(N,A[0],A[1]);case 3:return I.call(N,A[0],A[1],A[2])}return I.apply(N,A)}function Bf(I,N,A,X){for(var de=-1,De=I==null?0:I.length;++de<De;){var $t=I[de];N(X,$t,A($t),I)}return X}function _r(I,N){for(var A=-1,X=I==null?0:I.length;++A<X&&N(I[A],A,I)!==!1;);return I}function Vf(I,N){for(var A=I==null?0:I.length;A--&&N(I[A],A,I)!==!1;);return I}function Dc(I,N){for(var A=-1,X=I==null?0:I.length;++A<X;)if(!N(I[A],A,I))return!1;return!0}function fi(I,N){for(var A=-1,X=I==null?0:I.length,de=0,De=[];++A<X;){var $t=I[A];N($t,A,I)&&(De[de++]=$t)}return De}function En(I,N){var A=I==null?0:I.length;return!!A&&Xi(I,N,0)>-1}function Go(I,N,A){for(var X=-1,de=I==null?0:I.length;++X<de;)if(A(N,I[X]))return!0;return!1}function nt(I,N){for(var A=-1,X=I==null?0:I.length,de=Array(X);++A<X;)de[A]=N(I[A],A,I);return de}function pi(I,N){for(var A=-1,X=N.length,de=I.length;++A<X;)I[de+A]=N[A];return I}function Wo(I,N,A,X){var de=-1,De=I==null?0:I.length;for(X&&De&&(A=I[++de]);++de<De;)A=N(A,I[de],de,I);return A}function Kf(I,N,A,X){var de=I==null?0:I.length;for(X&&de&&(A=I[--de]);de--;)A=N(A,I[de],de,I);return A}function Jo(I,N){for(var A=-1,X=I==null?0:I.length;++A<X;)if(N(I[A],A,I))return!0;return!1}var Gf=Qo("length");function Wf(I){return I.split("")}function Jf(I){return I.match(Tt)||[]}function $c(I,N,A){var X;return A(I,function(de,De,$t){if(N(de,De,$t))return X=De,!1}),X}function xn(I,N,A,X){for(var de=I.length,De=A+(X?1:-1);X?De--:++De<de;)if(N(I[De],De,I))return De;return-1}function Xi(I,N,A){return N===N?ap(I,N,A):xn(I,qc,A)}function Qf(I,N,A,X){for(var de=A-1,De=I.length;++de<De;)if(X(I[de],N))return de;return-1}function qc(I){return I!==I}function Mc(I,N){var A=I==null?0:I.length;return A?Xo(I,N)/A:U}function Qo(I){return function(N){return N==null?i:N[I]}}function Yo(I){return function(N){return I==null?i:I[N]}}function jc(I,N,A,X,de){return de(I,function(De,$t,Je){A=X?(X=!1,De):N(A,De,$t,Je)}),A}function Yf(I,N){var A=I.length;for(I.sort(N);A--;)I[A]=I[A].value;return I}function Xo(I,N){for(var A,X=-1,de=I.length;++X<de;){var De=N(I[X]);De!==i&&(A=A===i?De:A+De)}return A}function Zo(I,N){for(var A=-1,X=Array(I);++A<I;)X[A]=N(A);return X}function Xf(I,N){return nt(N,function(A){return[A,I[A]]})}function zc(I){return I&&I.slice(0,Bc(I)+1).replace(vt,"")}function fr(I){return function(N){return I(N)}}function ea(I,N){return nt(N,function(A){return I[A]})}function xs(I,N){return I.has(N)}function Uc(I,N){for(var A=-1,X=I.length;++A<X&&Xi(N,I[A],0)>-1;);return A}function Hc(I,N){for(var A=I.length;A--&&Xi(N,I[A],0)>-1;);return A}function Zf(I,N){for(var A=I.length,X=0;A--;)I[A]===N&&++X;return X}var ep=Yo(v),tp=Yo(x);function rp(I){return"\\"+Q[I]}function ip(I,N){return I==null?i:I[N]}function Zi(I){return _n.test(I)}function sp(I){return Ti.test(I)}function np(I){for(var N,A=[];!(N=I.next()).done;)A.push(N.value);return A}function ta(I){var N=-1,A=Array(I.size);return I.forEach(function(X,de){A[++N]=[de,X]}),A}function kc(I,N){return function(A){return I(N(A))}}function di(I,N){for(var A=-1,X=I.length,de=0,De=[];++A<X;){var $t=I[A];($t===N||$t===L)&&(I[A]=L,De[de++]=A)}return De}function In(I){var N=-1,A=Array(I.size);return I.forEach(function(X){A[++N]=X}),A}function op(I){var N=-1,A=Array(I.size);return I.forEach(function(X){A[++N]=[X,X]}),A}function ap(I,N,A){for(var X=A-1,de=I.length;++X<de;)if(I[X]===N)return X;return-1}function cp(I,N,A){for(var X=A+1;X--;)if(I[X]===N)return X;return X}function es(I){return Zi(I)?hp(I):Gf(I)}function Cr(I){return Zi(I)?lp(I):Wf(I)}function Bc(I){for(var N=I.length;N--&&_t.test(I.charAt(N)););return N}var up=Yo($);function hp(I){for(var N=Yi.lastIndex=0;Yi.test(I);)++N;return N}function lp(I){return I.match(Yi)||[]}function fp(I){return I.match(wn)||[]}var pp=function I(N){N=N==null?Ae:ts.defaults(Ae.Object(),N,ts.pick(Ae,bn));var A=N.Array,X=N.Date,de=N.Error,De=N.Function,$t=N.Math,Je=N.Object,ra=N.RegExp,dp=N.String,br=N.TypeError,Pn=A.prototype,gp=De.prototype,rs=Je.prototype,Sn=N["__core-js_shared__"],On=gp.toString,je=rs.hasOwnProperty,vp=0,Vc=function(){var e=/[^.]+$/.exec(Sn&&Sn.keys&&Sn.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),An=rs.toString,yp=On.call(Je),mp=Ae._,wp=ra("^"+On.call(je).replace(gt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Rn=ir?N.Buffer:i,gi=N.Symbol,Cn=N.Uint8Array,Kc=Rn?Rn.allocUnsafe:i,Tn=kc(Je.getPrototypeOf,Je),Gc=Je.create,Wc=rs.propertyIsEnumerable,Nn=Pn.splice,Jc=gi?gi.isConcatSpreadable:i,Is=gi?gi.iterator:i,Li=gi?gi.toStringTag:i,Ln=function(){try{var e=Mi(Je,"defineProperty");return e({},"",{}),e}catch{}}(),_p=N.clearTimeout!==Ae.clearTimeout&&N.clearTimeout,bp=X&&X.now!==Ae.Date.now&&X.now,Ep=N.setTimeout!==Ae.setTimeout&&N.setTimeout,Fn=$t.ceil,Dn=$t.floor,ia=Je.getOwnPropertySymbols,xp=Rn?Rn.isBuffer:i,Qc=N.isFinite,Ip=Pn.join,Pp=kc(Je.keys,Je),qt=$t.max,Vt=$t.min,Sp=X.now,Op=N.parseInt,Yc=$t.random,Ap=Pn.reverse,sa=Mi(N,"DataView"),Ps=Mi(N,"Map"),na=Mi(N,"Promise"),is=Mi(N,"Set"),Ss=Mi(N,"WeakMap"),Os=Mi(Je,"create"),$n=Ss&&new Ss,ss={},Rp=ji(sa),Cp=ji(Ps),Tp=ji(na),Np=ji(is),Lp=ji(Ss),qn=gi?gi.prototype:i,As=qn?qn.valueOf:i,Xc=qn?qn.toString:i;function f(e){if(mt(e)&&!me(e)&&!(e instanceof Oe)){if(e instanceof Er)return e;if(je.call(e,"__wrapped__"))return Zu(e)}return new Er(e)}var ns=function(){function e(){}return function(t){if(!ht(t))return{};if(Gc)return Gc(t);e.prototype=t;var s=new e;return e.prototype=i,s}}();function Mn(){}function Er(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=i}f.templateSettings={escape:pt,evaluate:dt,interpolate:ut,variable:"",imports:{_:f}},f.prototype=Mn.prototype,f.prototype.constructor=f,Er.prototype=ns(Mn.prototype),Er.prototype.constructor=Er;function Oe(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=V,this.__views__=[]}function Fp(){var e=new Oe(this.__wrapped__);return e.__actions__=sr(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=sr(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=sr(this.__views__),e}function Dp(){if(this.__filtered__){var e=new Oe(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function $p(){var e=this.__wrapped__.value(),t=this.__dir__,s=me(e),a=t<0,l=s?e.length:0,d=Wd(0,l,this.__views__),m=d.start,_=d.end,P=_-m,F=a?_:m-1,D=this.__iteratees__,z=D.length,J=0,te=Vt(P,this.__takeCount__);if(!s||!a&&l==P&&te==P)return Eu(e,this.__actions__);var oe=[];e:for(;P--&&J<te;){F+=t;for(var be=-1,ae=e[F];++be<z;){var Pe=D[be],Re=Pe.iteratee,gr=Pe.type,Zt=Re(ae);if(gr==E)ae=Zt;else if(!Zt){if(gr==y)continue e;break e}}oe[J++]=ae}return oe}Oe.prototype=ns(Mn.prototype),Oe.prototype.constructor=Oe;function Fi(e){var t=-1,s=e==null?0:e.length;for(this.clear();++t<s;){var a=e[t];this.set(a[0],a[1])}}function qp(){this.__data__=Os?Os(null):{},this.size=0}function Mp(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}function jp(e){var t=this.__data__;if(Os){var s=t[e];return s===w?i:s}return je.call(t,e)?t[e]:i}function zp(e){var t=this.__data__;return Os?t[e]!==i:je.call(t,e)}function Up(e,t){var s=this.__data__;return this.size+=this.has(e)?0:1,s[e]=Os&&t===i?w:t,this}Fi.prototype.clear=qp,Fi.prototype.delete=Mp,Fi.prototype.get=jp,Fi.prototype.has=zp,Fi.prototype.set=Up;function Wr(e){var t=-1,s=e==null?0:e.length;for(this.clear();++t<s;){var a=e[t];this.set(a[0],a[1])}}function Hp(){this.__data__=[],this.size=0}function kp(e){var t=this.__data__,s=jn(t,e);if(s<0)return!1;var a=t.length-1;return s==a?t.pop():Nn.call(t,s,1),--this.size,!0}function Bp(e){var t=this.__data__,s=jn(t,e);return s<0?i:t[s][1]}function Vp(e){return jn(this.__data__,e)>-1}function Kp(e,t){var s=this.__data__,a=jn(s,e);return a<0?(++this.size,s.push([e,t])):s[a][1]=t,this}Wr.prototype.clear=Hp,Wr.prototype.delete=kp,Wr.prototype.get=Bp,Wr.prototype.has=Vp,Wr.prototype.set=Kp;function Jr(e){var t=-1,s=e==null?0:e.length;for(this.clear();++t<s;){var a=e[t];this.set(a[0],a[1])}}function Gp(){this.size=0,this.__data__={hash:new Fi,map:new(Ps||Wr),string:new Fi}}function Wp(e){var t=Yn(this,e).delete(e);return this.size-=t?1:0,t}function Jp(e){return Yn(this,e).get(e)}function Qp(e){return Yn(this,e).has(e)}function Yp(e,t){var s=Yn(this,e),a=s.size;return s.set(e,t),this.size+=s.size==a?0:1,this}Jr.prototype.clear=Gp,Jr.prototype.delete=Wp,Jr.prototype.get=Jp,Jr.prototype.has=Qp,Jr.prototype.set=Yp;function Di(e){var t=-1,s=e==null?0:e.length;for(this.__data__=new Jr;++t<s;)this.add(e[t])}function Xp(e){return this.__data__.set(e,w),this}function Zp(e){return this.__data__.has(e)}Di.prototype.add=Di.prototype.push=Xp,Di.prototype.has=Zp;function Tr(e){var t=this.__data__=new Wr(e);this.size=t.size}function ed(){this.__data__=new Wr,this.size=0}function td(e){var t=this.__data__,s=t.delete(e);return this.size=t.size,s}function rd(e){return this.__data__.get(e)}function id(e){return this.__data__.has(e)}function sd(e,t){var s=this.__data__;if(s instanceof Wr){var a=s.__data__;if(!Ps||a.length<o-1)return a.push([e,t]),this.size=++s.size,this;s=this.__data__=new Jr(a)}return s.set(e,t),this.size=s.size,this}Tr.prototype.clear=ed,Tr.prototype.delete=td,Tr.prototype.get=rd,Tr.prototype.has=id,Tr.prototype.set=sd;function Zc(e,t){var s=me(e),a=!s&&zi(e),l=!s&&!a&&_i(e),d=!s&&!a&&!l&&us(e),m=s||a||l||d,_=m?Zo(e.length,dp):[],P=_.length;for(var F in e)(t||je.call(e,F))&&!(m&&(F=="length"||l&&(F=="offset"||F=="parent")||d&&(F=="buffer"||F=="byteLength"||F=="byteOffset")||Zr(F,P)))&&_.push(F);return _}function eu(e){var t=e.length;return t?e[va(0,t-1)]:i}function nd(e,t){return Xn(sr(e),$i(t,0,e.length))}function od(e){return Xn(sr(e))}function oa(e,t,s){(s!==i&&!Nr(e[t],s)||s===i&&!(t in e))&&Qr(e,t,s)}function Rs(e,t,s){var a=e[t];(!(je.call(e,t)&&Nr(a,s))||s===i&&!(t in e))&&Qr(e,t,s)}function jn(e,t){for(var s=e.length;s--;)if(Nr(e[s][0],t))return s;return-1}function ad(e,t,s,a){return vi(e,function(l,d,m){t(a,l,s(l),m)}),a}function tu(e,t){return e&&Hr(t,zt(t),e)}function cd(e,t){return e&&Hr(t,or(t),e)}function Qr(e,t,s){t=="__proto__"&&Ln?Ln(e,t,{configurable:!0,enumerable:!0,value:s,writable:!0}):e[t]=s}function aa(e,t){for(var s=-1,a=t.length,l=A(a),d=e==null;++s<a;)l[s]=d?i:Ua(e,t[s]);return l}function $i(e,t,s){return e===e&&(s!==i&&(e=e<=s?e:s),t!==i&&(e=e>=t?e:t)),e}function xr(e,t,s,a,l,d){var m,_=t&H,P=t&B,F=t&K;if(s&&(m=l?s(e,a,l,d):s(e)),m!==i)return m;if(!ht(e))return e;var D=me(e);if(D){if(m=Qd(e),!_)return sr(e,m)}else{var z=Kt(e),J=z==ee||z==fe;if(_i(e))return Pu(e,_);if(z==Se||z==xe||J&&!l){if(m=P||J?{}:Bu(e),!_)return P?jd(e,cd(m,e)):Md(e,tu(m,e))}else{if(!He[z])return l?e:{};m=Yd(e,z,_)}}d||(d=new Tr);var te=d.get(e);if(te)return te;d.set(e,m),wh(e)?e.forEach(function(ae){m.add(xr(ae,t,s,ae,e,d))}):yh(e)&&e.forEach(function(ae,Pe){m.set(Pe,xr(ae,t,s,Pe,e,d))});var oe=F?P?Oa:Sa:P?or:zt,be=D?i:oe(e);return _r(be||e,function(ae,Pe){be&&(Pe=ae,ae=e[Pe]),Rs(m,Pe,xr(ae,t,s,Pe,e,d))}),m}function ud(e){var t=zt(e);return function(s){return ru(s,e,t)}}function ru(e,t,s){var a=s.length;if(e==null)return!a;for(e=Je(e);a--;){var l=s[a],d=t[l],m=e[l];if(m===i&&!(l in e)||!d(m))return!1}return!0}function iu(e,t,s){if(typeof e!="function")throw new br(p);return $s(function(){e.apply(i,s)},t)}function Cs(e,t,s,a){var l=-1,d=En,m=!0,_=e.length,P=[],F=t.length;if(!_)return P;s&&(t=nt(t,fr(s))),a?(d=Go,m=!1):t.length>=o&&(d=xs,m=!1,t=new Di(t));e:for(;++l<_;){var D=e[l],z=s==null?D:s(D);if(D=a||D!==0?D:0,m&&z===z){for(var J=F;J--;)if(t[J]===z)continue e;P.push(D)}else d(t,z,a)||P.push(D)}return P}var vi=Cu(Ur),su=Cu(ua,!0);function hd(e,t){var s=!0;return vi(e,function(a,l,d){return s=!!t(a,l,d),s}),s}function zn(e,t,s){for(var a=-1,l=e.length;++a<l;){var d=e[a],m=t(d);if(m!=null&&(_===i?m===m&&!dr(m):s(m,_)))var _=m,P=d}return P}function ld(e,t,s,a){var l=e.length;for(s=we(s),s<0&&(s=-s>l?0:l+s),a=a===i||a>l?l:we(a),a<0&&(a+=l),a=s>a?0:bh(a);s<a;)e[s++]=t;return e}function nu(e,t){var s=[];return vi(e,function(a,l,d){t(a,l,d)&&s.push(a)}),s}function kt(e,t,s,a,l){var d=-1,m=e.length;for(s||(s=Zd),l||(l=[]);++d<m;){var _=e[d];t>0&&s(_)?t>1?kt(_,t-1,s,a,l):pi(l,_):a||(l[l.length]=_)}return l}var ca=Tu(),ou=Tu(!0);function Ur(e,t){return e&&ca(e,t,zt)}function ua(e,t){return e&&ou(e,t,zt)}function Un(e,t){return fi(t,function(s){return ei(e[s])})}function qi(e,t){t=mi(t,e);for(var s=0,a=t.length;e!=null&&s<a;)e=e[kr(t[s++])];return s&&s==a?e:i}function au(e,t,s){var a=t(e);return me(e)?a:pi(a,s(e))}function Yt(e){return e==null?e===i?ct:Fe:Li&&Li in Je(e)?Gd(e):og(e)}function ha(e,t){return e>t}function fd(e,t){return e!=null&&je.call(e,t)}function pd(e,t){return e!=null&&t in Je(e)}function dd(e,t,s){return e>=Vt(t,s)&&e<qt(t,s)}function la(e,t,s){for(var a=s?Go:En,l=e[0].length,d=e.length,m=d,_=A(d),P=1/0,F=[];m--;){var D=e[m];m&&t&&(D=nt(D,fr(t))),P=Vt(D.length,P),_[m]=!s&&(t||l>=120&&D.length>=120)?new Di(m&&D):i}D=e[0];var z=-1,J=_[0];e:for(;++z<l&&F.length<P;){var te=D[z],oe=t?t(te):te;if(te=s||te!==0?te:0,!(J?xs(J,oe):a(F,oe,s))){for(m=d;--m;){var be=_[m];if(!(be?xs(be,oe):a(e[m],oe,s)))continue e}J&&J.push(oe),F.push(te)}}return F}function gd(e,t,s,a){return Ur(e,function(l,d,m){t(a,s(l),d,m)}),a}function Ts(e,t,s){t=mi(t,e),e=Wu(e,t);var a=e==null?e:e[kr(Pr(t))];return a==null?i:jt(a,e,s)}function cu(e){return mt(e)&&Yt(e)==xe}function vd(e){return mt(e)&&Yt(e)==Le}function yd(e){return mt(e)&&Yt(e)==O}function Ns(e,t,s,a,l){return e===t?!0:e==null||t==null||!mt(e)&&!mt(t)?e!==e&&t!==t:md(e,t,s,a,Ns,l)}function md(e,t,s,a,l,d){var m=me(e),_=me(t),P=m?It:Kt(e),F=_?It:Kt(t);P=P==xe?Se:P,F=F==xe?Se:F;var D=P==Se,z=F==Se,J=P==F;if(J&&_i(e)){if(!_i(t))return!1;m=!0,D=!1}if(J&&!D)return d||(d=new Tr),m||us(e)?Uu(e,t,s,a,l,d):Vd(e,t,P,s,a,l,d);if(!(s&q)){var te=D&&je.call(e,"__wrapped__"),oe=z&&je.call(t,"__wrapped__");if(te||oe){var be=te?e.value():e,ae=oe?t.value():t;return d||(d=new Tr),l(be,ae,s,a,d)}}return J?(d||(d=new Tr),Kd(e,t,s,a,l,d)):!1}function wd(e){return mt(e)&&Kt(e)==_e}function fa(e,t,s,a){var l=s.length,d=l,m=!a;if(e==null)return!d;for(e=Je(e);l--;){var _=s[l];if(m&&_[2]?_[1]!==e[_[0]]:!(_[0]in e))return!1}for(;++l<d;){_=s[l];var P=_[0],F=e[P],D=_[1];if(m&&_[2]){if(F===i&&!(P in e))return!1}else{var z=new Tr;if(a)var J=a(F,D,P,e,t,z);if(!(J===i?Ns(D,F,q|W,a,z):J))return!1}}return!0}function uu(e){if(!ht(e)||tg(e))return!1;var t=ei(e)?wp:To;return t.test(ji(e))}function _d(e){return mt(e)&&Yt(e)==at}function bd(e){return mt(e)&&Kt(e)==$e}function Ed(e){return mt(e)&&so(e.length)&&!!Ke[Yt(e)]}function hu(e){return typeof e=="function"?e:e==null?ar:typeof e=="object"?me(e)?pu(e[0],e[1]):fu(e):Nh(e)}function pa(e){if(!Ds(e))return Pp(e);var t=[];for(var s in Je(e))je.call(e,s)&&s!="constructor"&&t.push(s);return t}function xd(e){if(!ht(e))return ng(e);var t=Ds(e),s=[];for(var a in e)a=="constructor"&&(t||!je.call(e,a))||s.push(a);return s}function da(e,t){return e<t}function lu(e,t){var s=-1,a=nr(e)?A(e.length):[];return vi(e,function(l,d,m){a[++s]=t(l,d,m)}),a}function fu(e){var t=Ra(e);return t.length==1&&t[0][2]?Ku(t[0][0],t[0][1]):function(s){return s===e||fa(s,e,t)}}function pu(e,t){return Ta(e)&&Vu(t)?Ku(kr(e),t):function(s){var a=Ua(s,e);return a===i&&a===t?Ha(s,e):Ns(t,a,q|W)}}function Hn(e,t,s,a,l){e!==t&&ca(t,function(d,m){if(l||(l=new Tr),ht(d))Id(e,t,m,s,Hn,a,l);else{var _=a?a(La(e,m),d,m+"",e,t,l):i;_===i&&(_=d),oa(e,m,_)}},or)}function Id(e,t,s,a,l,d,m){var _=La(e,s),P=La(t,s),F=m.get(P);if(F){oa(e,s,F);return}var D=d?d(_,P,s+"",e,t,m):i,z=D===i;if(z){var J=me(P),te=!J&&_i(P),oe=!J&&!te&&us(P);D=P,J||te||oe?me(_)?D=_:Et(_)?D=sr(_):te?(z=!1,D=Pu(P,!0)):oe?(z=!1,D=Su(P,!0)):D=[]:qs(P)||zi(P)?(D=_,zi(_)?D=Eh(_):(!ht(_)||ei(_))&&(D=Bu(P))):z=!1}z&&(m.set(P,D),l(D,P,a,d,m),m.delete(P)),oa(e,s,D)}function du(e,t){var s=e.length;if(s)return t+=t<0?s:0,Zr(t,s)?e[t]:i}function gu(e,t,s){t.length?t=nt(t,function(d){return me(d)?function(m){return qi(m,d.length===1?d[0]:d)}:d}):t=[ar];var a=-1;t=nt(t,fr(ne()));var l=lu(e,function(d,m,_){var P=nt(t,function(F){return F(d)});return{criteria:P,index:++a,value:d}});return Yf(l,function(d,m){return qd(d,m,s)})}function Pd(e,t){return vu(e,t,function(s,a){return Ha(e,a)})}function vu(e,t,s){for(var a=-1,l=t.length,d={};++a<l;){var m=t[a],_=qi(e,m);s(_,m)&&Ls(d,mi(m,e),_)}return d}function Sd(e){return function(t){return qi(t,e)}}function ga(e,t,s,a){var l=a?Qf:Xi,d=-1,m=t.length,_=e;for(e===t&&(t=sr(t)),s&&(_=nt(e,fr(s)));++d<m;)for(var P=0,F=t[d],D=s?s(F):F;(P=l(_,D,P,a))>-1;)_!==e&&Nn.call(_,P,1),Nn.call(e,P,1);return e}function yu(e,t){for(var s=e?t.length:0,a=s-1;s--;){var l=t[s];if(s==a||l!==d){var d=l;Zr(l)?Nn.call(e,l,1):wa(e,l)}}return e}function va(e,t){return e+Dn(Yc()*(t-e+1))}function Od(e,t,s,a){for(var l=-1,d=qt(Fn((t-e)/(s||1)),0),m=A(d);d--;)m[a?d:++l]=e,e+=s;return m}function ya(e,t){var s="";if(!e||t<1||t>k)return s;do t%2&&(s+=e),t=Dn(t/2),t&&(e+=e);while(t);return s}function Ie(e,t){return Fa(Gu(e,t,ar),e+"")}function Ad(e){return eu(hs(e))}function Rd(e,t){var s=hs(e);return Xn(s,$i(t,0,s.length))}function Ls(e,t,s,a){if(!ht(e))return e;t=mi(t,e);for(var l=-1,d=t.length,m=d-1,_=e;_!=null&&++l<d;){var P=kr(t[l]),F=s;if(P==="__proto__"||P==="constructor"||P==="prototype")return e;if(l!=m){var D=_[P];F=a?a(D,P,_):i,F===i&&(F=ht(D)?D:Zr(t[l+1])?[]:{})}Rs(_,P,F),_=_[P]}return e}var mu=$n?function(e,t){return $n.set(e,t),e}:ar,Cd=Ln?function(e,t){return Ln(e,"toString",{configurable:!0,enumerable:!1,value:Ba(t),writable:!0})}:ar;function Td(e){return Xn(hs(e))}function Ir(e,t,s){var a=-1,l=e.length;t<0&&(t=-t>l?0:l+t),s=s>l?l:s,s<0&&(s+=l),l=t>s?0:s-t>>>0,t>>>=0;for(var d=A(l);++a<l;)d[a]=e[a+t];return d}function Nd(e,t){var s;return vi(e,function(a,l,d){return s=t(a,l,d),!s}),!!s}function kn(e,t,s){var a=0,l=e==null?a:e.length;if(typeof t=="number"&&t===t&&l<=Be){for(;a<l;){var d=a+l>>>1,m=e[d];m!==null&&!dr(m)&&(s?m<=t:m<t)?a=d+1:l=d}return l}return ma(e,t,ar,s)}function ma(e,t,s,a){var l=0,d=e==null?0:e.length;if(d===0)return 0;t=s(t);for(var m=t!==t,_=t===null,P=dr(t),F=t===i;l<d;){var D=Dn((l+d)/2),z=s(e[D]),J=z!==i,te=z===null,oe=z===z,be=dr(z);if(m)var ae=a||oe;else F?ae=oe&&(a||J):_?ae=oe&&J&&(a||!te):P?ae=oe&&J&&!te&&(a||!be):te||be?ae=!1:ae=a?z<=t:z<t;ae?l=D+1:d=D}return Vt(d,Qe)}function wu(e,t){for(var s=-1,a=e.length,l=0,d=[];++s<a;){var m=e[s],_=t?t(m):m;if(!s||!Nr(_,P)){var P=_;d[l++]=m===0?0:m}}return d}function _u(e){return typeof e=="number"?e:dr(e)?U:+e}function pr(e){if(typeof e=="string")return e;if(me(e))return nt(e,pr)+"";if(dr(e))return Xc?Xc.call(e):"";var t=e+"";return t=="0"&&1/e==-ce?"-0":t}function yi(e,t,s){var a=-1,l=En,d=e.length,m=!0,_=[],P=_;if(s)m=!1,l=Go;else if(d>=o){var F=t?null:kd(e);if(F)return In(F);m=!1,l=xs,P=new Di}else P=t?[]:_;e:for(;++a<d;){var D=e[a],z=t?t(D):D;if(D=s||D!==0?D:0,m&&z===z){for(var J=P.length;J--;)if(P[J]===z)continue e;t&&P.push(z),_.push(D)}else l(P,z,s)||(P!==_&&P.push(z),_.push(D))}return _}function wa(e,t){return t=mi(t,e),e=Wu(e,t),e==null||delete e[kr(Pr(t))]}function bu(e,t,s,a){return Ls(e,t,s(qi(e,t)),a)}function Bn(e,t,s,a){for(var l=e.length,d=a?l:-1;(a?d--:++d<l)&&t(e[d],d,e););return s?Ir(e,a?0:d,a?d+1:l):Ir(e,a?d+1:0,a?l:d)}function Eu(e,t){var s=e;return s instanceof Oe&&(s=s.value()),Wo(t,function(a,l){return l.func.apply(l.thisArg,pi([a],l.args))},s)}function _a(e,t,s){var a=e.length;if(a<2)return a?yi(e[0]):[];for(var l=-1,d=A(a);++l<a;)for(var m=e[l],_=-1;++_<a;)_!=l&&(d[l]=Cs(d[l]||m,e[_],t,s));return yi(kt(d,1),t,s)}function xu(e,t,s){for(var a=-1,l=e.length,d=t.length,m={};++a<l;){var _=a<d?t[a]:i;s(m,e[a],_)}return m}function ba(e){return Et(e)?e:[]}function Ea(e){return typeof e=="function"?e:ar}function mi(e,t){return me(e)?e:Ta(e,t)?[e]:Xu(qe(e))}var Ld=Ie;function wi(e,t,s){var a=e.length;return s=s===i?a:s,!t&&s>=a?e:Ir(e,t,s)}var Iu=_p||function(e){return Ae.clearTimeout(e)};function Pu(e,t){if(t)return e.slice();var s=e.length,a=Kc?Kc(s):new e.constructor(s);return e.copy(a),a}function xa(e){var t=new e.constructor(e.byteLength);return new Cn(t).set(new Cn(e)),t}function Fd(e,t){var s=t?xa(e.buffer):e.buffer;return new e.constructor(s,e.byteOffset,e.byteLength)}function Dd(e){var t=new e.constructor(e.source,mr.exec(e));return t.lastIndex=e.lastIndex,t}function $d(e){return As?Je(As.call(e)):{}}function Su(e,t){var s=t?xa(e.buffer):e.buffer;return new e.constructor(s,e.byteOffset,e.length)}function Ou(e,t){if(e!==t){var s=e!==i,a=e===null,l=e===e,d=dr(e),m=t!==i,_=t===null,P=t===t,F=dr(t);if(!_&&!F&&!d&&e>t||d&&m&&P&&!_&&!F||a&&m&&P||!s&&P||!l)return 1;if(!a&&!d&&!F&&e<t||F&&s&&l&&!a&&!d||_&&s&&l||!m&&l||!P)return-1}return 0}function qd(e,t,s){for(var a=-1,l=e.criteria,d=t.criteria,m=l.length,_=s.length;++a<m;){var P=Ou(l[a],d[a]);if(P){if(a>=_)return P;var F=s[a];return P*(F=="desc"?-1:1)}}return e.index-t.index}function Au(e,t,s,a){for(var l=-1,d=e.length,m=s.length,_=-1,P=t.length,F=qt(d-m,0),D=A(P+F),z=!a;++_<P;)D[_]=t[_];for(;++l<m;)(z||l<d)&&(D[s[l]]=e[l]);for(;F--;)D[_++]=e[l++];return D}function Ru(e,t,s,a){for(var l=-1,d=e.length,m=-1,_=s.length,P=-1,F=t.length,D=qt(d-_,0),z=A(D+F),J=!a;++l<D;)z[l]=e[l];for(var te=l;++P<F;)z[te+P]=t[P];for(;++m<_;)(J||l<d)&&(z[te+s[m]]=e[l++]);return z}function sr(e,t){var s=-1,a=e.length;for(t||(t=A(a));++s<a;)t[s]=e[s];return t}function Hr(e,t,s,a){var l=!s;s||(s={});for(var d=-1,m=t.length;++d<m;){var _=t[d],P=a?a(s[_],e[_],_,s,e):i;P===i&&(P=e[_]),l?Qr(s,_,P):Rs(s,_,P)}return s}function Md(e,t){return Hr(e,Ca(e),t)}function jd(e,t){return Hr(e,Hu(e),t)}function Vn(e,t){return function(s,a){var l=me(s)?Bf:ad,d=t?t():{};return l(s,e,ne(a,2),d)}}function os(e){return Ie(function(t,s){var a=-1,l=s.length,d=l>1?s[l-1]:i,m=l>2?s[2]:i;for(d=e.length>3&&typeof d=="function"?(l--,d):i,m&&Xt(s[0],s[1],m)&&(d=l<3?i:d,l=1),t=Je(t);++a<l;){var _=s[a];_&&e(t,_,a,d)}return t})}function Cu(e,t){return function(s,a){if(s==null)return s;if(!nr(s))return e(s,a);for(var l=s.length,d=t?l:-1,m=Je(s);(t?d--:++d<l)&&a(m[d],d,m)!==!1;);return s}}function Tu(e){return function(t,s,a){for(var l=-1,d=Je(t),m=a(t),_=m.length;_--;){var P=m[e?_:++l];if(s(d[P],P,d)===!1)break}return t}}function zd(e,t,s){var a=t&ie,l=Fs(e);function d(){var m=this&&this!==Ae&&this instanceof d?l:e;return m.apply(a?s:this,arguments)}return d}function Nu(e){return function(t){t=qe(t);var s=Zi(t)?Cr(t):i,a=s?s[0]:t.charAt(0),l=s?wi(s,1).join(""):t.slice(1);return a[e]()+l}}function as(e){return function(t){return Wo(Ch(Rh(t).replace(bs,"")),e,"")}}function Fs(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var s=ns(e.prototype),a=e.apply(s,t);return ht(a)?a:s}}function Ud(e,t,s){var a=Fs(e);function l(){for(var d=arguments.length,m=A(d),_=d,P=cs(l);_--;)m[_]=arguments[_];var F=d<3&&m[0]!==P&&m[d-1]!==P?[]:di(m,P);if(d-=F.length,d<s)return qu(e,t,Kn,l.placeholder,i,m,F,i,i,s-d);var D=this&&this!==Ae&&this instanceof l?a:e;return jt(D,this,m)}return l}function Lu(e){return function(t,s,a){var l=Je(t);if(!nr(t)){var d=ne(s,3);t=zt(t),s=function(_){return d(l[_],_,l)}}var m=e(t,s,a);return m>-1?l[d?t[m]:m]:i}}function Fu(e){return Xr(function(t){var s=t.length,a=s,l=Er.prototype.thru;for(e&&t.reverse();a--;){var d=t[a];if(typeof d!="function")throw new br(p);if(l&&!m&&Qn(d)=="wrapper")var m=new Er([],!0)}for(a=m?a:s;++a<s;){d=t[a];var _=Qn(d),P=_=="wrapper"?Aa(d):i;P&&Na(P[0])&&P[1]==(M|pe|le|G)&&!P[4].length&&P[9]==1?m=m[Qn(P[0])].apply(m,P[3]):m=d.length==1&&Na(d)?m[_]():m.thru(d)}return function(){var F=arguments,D=F[0];if(m&&F.length==1&&me(D))return m.plant(D).value();for(var z=0,J=s?t[z].apply(this,F):D;++z<s;)J=t[z].call(this,J);return J}})}function Kn(e,t,s,a,l,d,m,_,P,F){var D=t&M,z=t&ie,J=t&Ee,te=t&(pe|he),oe=t&ve,be=J?i:Fs(e);function ae(){for(var Pe=arguments.length,Re=A(Pe),gr=Pe;gr--;)Re[gr]=arguments[gr];if(te)var Zt=cs(ae),vr=Zf(Re,Zt);if(a&&(Re=Au(Re,a,l,te)),d&&(Re=Ru(Re,d,m,te)),Pe-=vr,te&&Pe<F){var xt=di(Re,Zt);return qu(e,t,Kn,ae.placeholder,s,Re,xt,_,P,F-Pe)}var Lr=z?s:this,ri=J?Lr[e]:e;return Pe=Re.length,_?Re=ag(Re,_):oe&&Pe>1&&Re.reverse(),D&&P<Pe&&(Re.length=P),this&&this!==Ae&&this instanceof ae&&(ri=be||Fs(ri)),ri.apply(Lr,Re)}return ae}function Du(e,t){return function(s,a){return gd(s,e,t(a),{})}}function Gn(e,t){return function(s,a){var l;if(s===i&&a===i)return t;if(s!==i&&(l=s),a!==i){if(l===i)return a;typeof s=="string"||typeof a=="string"?(s=pr(s),a=pr(a)):(s=_u(s),a=_u(a)),l=e(s,a)}return l}}function Ia(e){return Xr(function(t){return t=nt(t,fr(ne())),Ie(function(s){var a=this;return e(t,function(l){return jt(l,a,s)})})})}function Wn(e,t){t=t===i?" ":pr(t);var s=t.length;if(s<2)return s?ya(t,e):t;var a=ya(t,Fn(e/es(t)));return Zi(t)?wi(Cr(a),0,e).join(""):a.slice(0,e)}function Hd(e,t,s,a){var l=t&ie,d=Fs(e);function m(){for(var _=-1,P=arguments.length,F=-1,D=a.length,z=A(D+P),J=this&&this!==Ae&&this instanceof m?d:e;++F<D;)z[F]=a[F];for(;P--;)z[F++]=arguments[++_];return jt(J,l?s:this,z)}return m}function $u(e){return function(t,s,a){return a&&typeof a!="number"&&Xt(t,s,a)&&(s=a=i),t=ti(t),s===i?(s=t,t=0):s=ti(s),a=a===i?t<s?1:-1:ti(a),Od(t,s,a,e)}}function Jn(e){return function(t,s){return typeof t=="string"&&typeof s=="string"||(t=Sr(t),s=Sr(s)),e(t,s)}}function qu(e,t,s,a,l,d,m,_,P,F){var D=t&pe,z=D?m:i,J=D?i:m,te=D?d:i,oe=D?i:d;t|=D?le:T,t&=~(D?T:le),t&ge||(t&=~(ie|Ee));var be=[e,t,l,te,z,oe,J,_,P,F],ae=s.apply(i,be);return Na(e)&&Ju(ae,be),ae.placeholder=a,Qu(ae,e,t)}function Pa(e){var t=$t[e];return function(s,a){if(s=Sr(s),a=a==null?0:Vt(we(a),292),a&&Qc(s)){var l=(qe(s)+"e").split("e"),d=t(l[0]+"e"+(+l[1]+a));return l=(qe(d)+"e").split("e"),+(l[0]+"e"+(+l[1]-a))}return t(s)}}var kd=is&&1/In(new is([,-0]))[1]==ce?function(e){return new is(e)}:Ga;function Mu(e){return function(t){var s=Kt(t);return s==_e?ta(t):s==$e?op(t):Xf(t,e(t))}}function Yr(e,t,s,a,l,d,m,_){var P=t&Ee;if(!P&&typeof e!="function")throw new br(p);var F=a?a.length:0;if(F||(t&=~(le|T),a=l=i),m=m===i?m:qt(we(m),0),_=_===i?_:we(_),F-=l?l.length:0,t&T){var D=a,z=l;a=l=i}var J=P?i:Aa(e),te=[e,t,s,a,l,D,z,d,m,_];if(J&&sg(te,J),e=te[0],t=te[1],s=te[2],a=te[3],l=te[4],_=te[9]=te[9]===i?P?0:e.length:qt(te[9]-F,0),!_&&t&(pe|he)&&(t&=~(pe|he)),!t||t==ie)var oe=zd(e,t,s);else t==pe||t==he?oe=Ud(e,t,_):(t==le||t==(ie|le))&&!l.length?oe=Hd(e,t,s,a):oe=Kn.apply(i,te);var be=J?mu:Ju;return Qu(be(oe,te),e,t)}function ju(e,t,s,a){return e===i||Nr(e,rs[s])&&!je.call(a,s)?t:e}function zu(e,t,s,a,l,d){return ht(e)&&ht(t)&&(d.set(t,e),Hn(e,t,i,zu,d),d.delete(t)),e}function Bd(e){return qs(e)?i:e}function Uu(e,t,s,a,l,d){var m=s&q,_=e.length,P=t.length;if(_!=P&&!(m&&P>_))return!1;var F=d.get(e),D=d.get(t);if(F&&D)return F==t&&D==e;var z=-1,J=!0,te=s&W?new Di:i;for(d.set(e,t),d.set(t,e);++z<_;){var oe=e[z],be=t[z];if(a)var ae=m?a(be,oe,z,t,e,d):a(oe,be,z,e,t,d);if(ae!==i){if(ae)continue;J=!1;break}if(te){if(!Jo(t,function(Pe,Re){if(!xs(te,Re)&&(oe===Pe||l(oe,Pe,s,a,d)))return te.push(Re)})){J=!1;break}}else if(!(oe===be||l(oe,be,s,a,d))){J=!1;break}}return d.delete(e),d.delete(t),J}function Vd(e,t,s,a,l,d,m){switch(s){case Ve:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case Le:return!(e.byteLength!=t.byteLength||!d(new Cn(e),new Cn(t)));case R:case O:case Ne:return Nr(+e,+t);case b:return e.name==t.name&&e.message==t.message;case at:case Xe:return e==t+"";case _e:var _=ta;case $e:var P=a&q;if(_||(_=In),e.size!=t.size&&!P)return!1;var F=m.get(e);if(F)return F==t;a|=W,m.set(e,t);var D=Uu(_(e),_(t),a,l,d,m);return m.delete(e),D;case Ze:if(As)return As.call(e)==As.call(t)}return!1}function Kd(e,t,s,a,l,d){var m=s&q,_=Sa(e),P=_.length,F=Sa(t),D=F.length;if(P!=D&&!m)return!1;for(var z=P;z--;){var J=_[z];if(!(m?J in t:je.call(t,J)))return!1}var te=d.get(e),oe=d.get(t);if(te&&oe)return te==t&&oe==e;var be=!0;d.set(e,t),d.set(t,e);for(var ae=m;++z<P;){J=_[z];var Pe=e[J],Re=t[J];if(a)var gr=m?a(Re,Pe,J,t,e,d):a(Pe,Re,J,e,t,d);if(!(gr===i?Pe===Re||l(Pe,Re,s,a,d):gr)){be=!1;break}ae||(ae=J=="constructor")}if(be&&!ae){var Zt=e.constructor,vr=t.constructor;Zt!=vr&&"constructor"in e&&"constructor"in t&&!(typeof Zt=="function"&&Zt instanceof Zt&&typeof vr=="function"&&vr instanceof vr)&&(be=!1)}return d.delete(e),d.delete(t),be}function Xr(e){return Fa(Gu(e,i,rh),e+"")}function Sa(e){return au(e,zt,Ca)}function Oa(e){return au(e,or,Hu)}var Aa=$n?function(e){return $n.get(e)}:Ga;function Qn(e){for(var t=e.name+"",s=ss[t],a=je.call(ss,t)?s.length:0;a--;){var l=s[a],d=l.func;if(d==null||d==e)return l.name}return t}function cs(e){var t=je.call(f,"placeholder")?f:e;return t.placeholder}function ne(){var e=f.iteratee||Va;return e=e===Va?hu:e,arguments.length?e(arguments[0],arguments[1]):e}function Yn(e,t){var s=e.__data__;return eg(t)?s[typeof t=="string"?"string":"hash"]:s.map}function Ra(e){for(var t=zt(e),s=t.length;s--;){var a=t[s],l=e[a];t[s]=[a,l,Vu(l)]}return t}function Mi(e,t){var s=ip(e,t);return uu(s)?s:i}function Gd(e){var t=je.call(e,Li),s=e[Li];try{e[Li]=i;var a=!0}catch{}var l=An.call(e);return a&&(t?e[Li]=s:delete e[Li]),l}var Ca=ia?function(e){return e==null?[]:(e=Je(e),fi(ia(e),function(t){return Wc.call(e,t)}))}:Wa,Hu=ia?function(e){for(var t=[];e;)pi(t,Ca(e)),e=Tn(e);return t}:Wa,Kt=Yt;(sa&&Kt(new sa(new ArrayBuffer(1)))!=Ve||Ps&&Kt(new Ps)!=_e||na&&Kt(na.resolve())!=Pt||is&&Kt(new is)!=$e||Ss&&Kt(new Ss)!=Ue)&&(Kt=function(e){var t=Yt(e),s=t==Se?e.constructor:i,a=s?ji(s):"";if(a)switch(a){case Rp:return Ve;case Cp:return _e;case Tp:return Pt;case Np:return $e;case Lp:return Ue}return t});function Wd(e,t,s){for(var a=-1,l=s.length;++a<l;){var d=s[a],m=d.size;switch(d.type){case"drop":e+=m;break;case"dropRight":t-=m;break;case"take":t=Vt(t,e+m);break;case"takeRight":e=qt(e,t-m);break}}return{start:e,end:t}}function Jd(e){var t=e.match(Ye);return t?t[1].split(Ct):[]}function ku(e,t,s){t=mi(t,e);for(var a=-1,l=t.length,d=!1;++a<l;){var m=kr(t[a]);if(!(d=e!=null&&s(e,m)))break;e=e[m]}return d||++a!=l?d:(l=e==null?0:e.length,!!l&&so(l)&&Zr(m,l)&&(me(e)||zi(e)))}function Qd(e){var t=e.length,s=new e.constructor(t);return t&&typeof e[0]=="string"&&je.call(e,"index")&&(s.index=e.index,s.input=e.input),s}function Bu(e){return typeof e.constructor=="function"&&!Ds(e)?ns(Tn(e)):{}}function Yd(e,t,s){var a=e.constructor;switch(t){case Le:return xa(e);case R:case O:return new a(+e);case Ve:return Fd(e,s);case lt:case Me:case St:case Dt:case Ut:case Ht:case Mt:case Wt:case rr:return Su(e,s);case _e:return new a;case Ne:case Xe:return new a(e);case at:return Dd(e);case $e:return new a;case Ze:return $d(e)}}function Xd(e,t){var s=t.length;if(!s)return e;var a=s-1;return t[a]=(s>1?"& ":"")+t[a],t=t.join(s>2?", ":" "),e.replace(yt,`{
/* [wrapped with `+t+`] */
`)}function Zd(e){return me(e)||zi(e)||!!(Jc&&e&&e[Jc])}function Zr(e,t){var s=typeof e;return t=t??k,!!t&&(s=="number"||s!="symbol"&&Lo.test(e))&&e>-1&&e%1==0&&e<t}function Xt(e,t,s){if(!ht(s))return!1;var a=typeof t;return(a=="number"?nr(s)&&Zr(t,s.length):a=="string"&&t in s)?Nr(s[t],e):!1}function Ta(e,t){if(me(e))return!1;var s=typeof e;return s=="number"||s=="symbol"||s=="boolean"||e==null||dr(e)?!0:Ot.test(e)||!st.test(e)||t!=null&&e in Je(t)}function eg(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function Na(e){var t=Qn(e),s=f[t];if(typeof s!="function"||!(t in Oe.prototype))return!1;if(e===s)return!0;var a=Aa(s);return!!a&&e===a[0]}function tg(e){return!!Vc&&Vc in e}var rg=Sn?ei:Ja;function Ds(e){var t=e&&e.constructor,s=typeof t=="function"&&t.prototype||rs;return e===s}function Vu(e){return e===e&&!ht(e)}function Ku(e,t){return function(s){return s==null?!1:s[e]===t&&(t!==i||e in Je(s))}}function ig(e){var t=ro(e,function(a){return s.size===S&&s.clear(),a}),s=t.cache;return t}function sg(e,t){var s=e[1],a=t[1],l=s|a,d=l<(ie|Ee|M),m=a==M&&s==pe||a==M&&s==G&&e[7].length<=t[8]||a==(M|G)&&t[7].length<=t[8]&&s==pe;if(!(d||m))return e;a&ie&&(e[2]=t[2],l|=s&ie?0:ge);var _=t[3];if(_){var P=e[3];e[3]=P?Au(P,_,t[4]):_,e[4]=P?di(e[3],L):t[4]}return _=t[5],_&&(P=e[5],e[5]=P?Ru(P,_,t[6]):_,e[6]=P?di(e[5],L):t[6]),_=t[7],_&&(e[7]=_),a&M&&(e[8]=e[8]==null?t[8]:Vt(e[8],t[8])),e[9]==null&&(e[9]=t[9]),e[0]=t[0],e[1]=l,e}function ng(e){var t=[];if(e!=null)for(var s in Je(e))t.push(s);return t}function og(e){return An.call(e)}function Gu(e,t,s){return t=qt(t===i?e.length-1:t,0),function(){for(var a=arguments,l=-1,d=qt(a.length-t,0),m=A(d);++l<d;)m[l]=a[t+l];l=-1;for(var _=A(t+1);++l<t;)_[l]=a[l];return _[t]=s(m),jt(e,this,_)}}function Wu(e,t){return t.length<2?e:qi(e,Ir(t,0,-1))}function ag(e,t){for(var s=e.length,a=Vt(t.length,s),l=sr(e);a--;){var d=t[a];e[a]=Zr(d,s)?l[d]:i}return e}function La(e,t){if(!(t==="constructor"&&typeof e[t]=="function")&&t!="__proto__")return e[t]}var Ju=Yu(mu),$s=Ep||function(e,t){return Ae.setTimeout(e,t)},Fa=Yu(Cd);function Qu(e,t,s){var a=t+"";return Fa(e,Xd(a,cg(Jd(a),s)))}function Yu(e){var t=0,s=0;return function(){var a=Sp(),l=ze-(a-s);if(s=a,l>0){if(++t>=Te)return arguments[0]}else t=0;return e.apply(i,arguments)}}function Xn(e,t){var s=-1,a=e.length,l=a-1;for(t=t===i?a:t;++s<t;){var d=va(s,l),m=e[d];e[d]=e[s],e[s]=m}return e.length=t,e}var Xu=ig(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(At,function(s,a,l,d){t.push(l?d.replace(Oo,"$1"):a||s)}),t});function kr(e){if(typeof e=="string"||dr(e))return e;var t=e+"";return t=="0"&&1/e==-ce?"-0":t}function ji(e){if(e!=null){try{return On.call(e)}catch{}try{return e+""}catch{}}return""}function cg(e,t){return _r(qr,function(s){var a="_."+s[0];t&s[1]&&!En(e,a)&&e.push(a)}),e.sort()}function Zu(e){if(e instanceof Oe)return e.clone();var t=new Er(e.__wrapped__,e.__chain__);return t.__actions__=sr(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}function ug(e,t,s){(s?Xt(e,t,s):t===i)?t=1:t=qt(we(t),0);var a=e==null?0:e.length;if(!a||t<1)return[];for(var l=0,d=0,m=A(Fn(a/t));l<a;)m[d++]=Ir(e,l,l+=t);return m}function hg(e){for(var t=-1,s=e==null?0:e.length,a=0,l=[];++t<s;){var d=e[t];d&&(l[a++]=d)}return l}function lg(){var e=arguments.length;if(!e)return[];for(var t=A(e-1),s=arguments[0],a=e;a--;)t[a-1]=arguments[a];return pi(me(s)?sr(s):[s],kt(t,1))}var fg=Ie(function(e,t){return Et(e)?Cs(e,kt(t,1,Et,!0)):[]}),pg=Ie(function(e,t){var s=Pr(t);return Et(s)&&(s=i),Et(e)?Cs(e,kt(t,1,Et,!0),ne(s,2)):[]}),dg=Ie(function(e,t){var s=Pr(t);return Et(s)&&(s=i),Et(e)?Cs(e,kt(t,1,Et,!0),i,s):[]});function gg(e,t,s){var a=e==null?0:e.length;return a?(t=s||t===i?1:we(t),Ir(e,t<0?0:t,a)):[]}function vg(e,t,s){var a=e==null?0:e.length;return a?(t=s||t===i?1:we(t),t=a-t,Ir(e,0,t<0?0:t)):[]}function yg(e,t){return e&&e.length?Bn(e,ne(t,3),!0,!0):[]}function mg(e,t){return e&&e.length?Bn(e,ne(t,3),!0):[]}function wg(e,t,s,a){var l=e==null?0:e.length;return l?(s&&typeof s!="number"&&Xt(e,t,s)&&(s=0,a=l),ld(e,t,s,a)):[]}function eh(e,t,s){var a=e==null?0:e.length;if(!a)return-1;var l=s==null?0:we(s);return l<0&&(l=qt(a+l,0)),xn(e,ne(t,3),l)}function th(e,t,s){var a=e==null?0:e.length;if(!a)return-1;var l=a-1;return s!==i&&(l=we(s),l=s<0?qt(a+l,0):Vt(l,a-1)),xn(e,ne(t,3),l,!0)}function rh(e){var t=e==null?0:e.length;return t?kt(e,1):[]}function _g(e){var t=e==null?0:e.length;return t?kt(e,ce):[]}function bg(e,t){var s=e==null?0:e.length;return s?(t=t===i?1:we(t),kt(e,t)):[]}function Eg(e){for(var t=-1,s=e==null?0:e.length,a={};++t<s;){var l=e[t];a[l[0]]=l[1]}return a}function ih(e){return e&&e.length?e[0]:i}function xg(e,t,s){var a=e==null?0:e.length;if(!a)return-1;var l=s==null?0:we(s);return l<0&&(l=qt(a+l,0)),Xi(e,t,l)}function Ig(e){var t=e==null?0:e.length;return t?Ir(e,0,-1):[]}var Pg=Ie(function(e){var t=nt(e,ba);return t.length&&t[0]===e[0]?la(t):[]}),Sg=Ie(function(e){var t=Pr(e),s=nt(e,ba);return t===Pr(s)?t=i:s.pop(),s.length&&s[0]===e[0]?la(s,ne(t,2)):[]}),Og=Ie(function(e){var t=Pr(e),s=nt(e,ba);return t=typeof t=="function"?t:i,t&&s.pop(),s.length&&s[0]===e[0]?la(s,i,t):[]});function Ag(e,t){return e==null?"":Ip.call(e,t)}function Pr(e){var t=e==null?0:e.length;return t?e[t-1]:i}function Rg(e,t,s){var a=e==null?0:e.length;if(!a)return-1;var l=a;return s!==i&&(l=we(s),l=l<0?qt(a+l,0):Vt(l,a-1)),t===t?cp(e,t,l):xn(e,qc,l,!0)}function Cg(e,t){return e&&e.length?du(e,we(t)):i}var Tg=Ie(sh);function sh(e,t){return e&&e.length&&t&&t.length?ga(e,t):e}function Ng(e,t,s){return e&&e.length&&t&&t.length?ga(e,t,ne(s,2)):e}function Lg(e,t,s){return e&&e.length&&t&&t.length?ga(e,t,i,s):e}var Fg=Xr(function(e,t){var s=e==null?0:e.length,a=aa(e,t);return yu(e,nt(t,function(l){return Zr(l,s)?+l:l}).sort(Ou)),a});function Dg(e,t){var s=[];if(!(e&&e.length))return s;var a=-1,l=[],d=e.length;for(t=ne(t,3);++a<d;){var m=e[a];t(m,a,e)&&(s.push(m),l.push(a))}return yu(e,l),s}function Da(e){return e==null?e:Ap.call(e)}function $g(e,t,s){var a=e==null?0:e.length;return a?(s&&typeof s!="number"&&Xt(e,t,s)?(t=0,s=a):(t=t==null?0:we(t),s=s===i?a:we(s)),Ir(e,t,s)):[]}function qg(e,t){return kn(e,t)}function Mg(e,t,s){return ma(e,t,ne(s,2))}function jg(e,t){var s=e==null?0:e.length;if(s){var a=kn(e,t);if(a<s&&Nr(e[a],t))return a}return-1}function zg(e,t){return kn(e,t,!0)}function Ug(e,t,s){return ma(e,t,ne(s,2),!0)}function Hg(e,t){var s=e==null?0:e.length;if(s){var a=kn(e,t,!0)-1;if(Nr(e[a],t))return a}return-1}function kg(e){return e&&e.length?wu(e):[]}function Bg(e,t){return e&&e.length?wu(e,ne(t,2)):[]}function Vg(e){var t=e==null?0:e.length;return t?Ir(e,1,t):[]}function Kg(e,t,s){return e&&e.length?(t=s||t===i?1:we(t),Ir(e,0,t<0?0:t)):[]}function Gg(e,t,s){var a=e==null?0:e.length;return a?(t=s||t===i?1:we(t),t=a-t,Ir(e,t<0?0:t,a)):[]}function Wg(e,t){return e&&e.length?Bn(e,ne(t,3),!1,!0):[]}function Jg(e,t){return e&&e.length?Bn(e,ne(t,3)):[]}var Qg=Ie(function(e){return yi(kt(e,1,Et,!0))}),Yg=Ie(function(e){var t=Pr(e);return Et(t)&&(t=i),yi(kt(e,1,Et,!0),ne(t,2))}),Xg=Ie(function(e){var t=Pr(e);return t=typeof t=="function"?t:i,yi(kt(e,1,Et,!0),i,t)});function Zg(e){return e&&e.length?yi(e):[]}function ev(e,t){return e&&e.length?yi(e,ne(t,2)):[]}function tv(e,t){return t=typeof t=="function"?t:i,e&&e.length?yi(e,i,t):[]}function $a(e){if(!(e&&e.length))return[];var t=0;return e=fi(e,function(s){if(Et(s))return t=qt(s.length,t),!0}),Zo(t,function(s){return nt(e,Qo(s))})}function nh(e,t){if(!(e&&e.length))return[];var s=$a(e);return t==null?s:nt(s,function(a){return jt(t,i,a)})}var rv=Ie(function(e,t){return Et(e)?Cs(e,t):[]}),iv=Ie(function(e){return _a(fi(e,Et))}),sv=Ie(function(e){var t=Pr(e);return Et(t)&&(t=i),_a(fi(e,Et),ne(t,2))}),nv=Ie(function(e){var t=Pr(e);return t=typeof t=="function"?t:i,_a(fi(e,Et),i,t)}),ov=Ie($a);function av(e,t){return xu(e||[],t||[],Rs)}function cv(e,t){return xu(e||[],t||[],Ls)}var uv=Ie(function(e){var t=e.length,s=t>1?e[t-1]:i;return s=typeof s=="function"?(e.pop(),s):i,nh(e,s)});function oh(e){var t=f(e);return t.__chain__=!0,t}function hv(e,t){return t(e),e}function Zn(e,t){return t(e)}var lv=Xr(function(e){var t=e.length,s=t?e[0]:0,a=this.__wrapped__,l=function(d){return aa(d,e)};return t>1||this.__actions__.length||!(a instanceof Oe)||!Zr(s)?this.thru(l):(a=a.slice(s,+s+(t?1:0)),a.__actions__.push({func:Zn,args:[l],thisArg:i}),new Er(a,this.__chain__).thru(function(d){return t&&!d.length&&d.push(i),d}))});function fv(){return oh(this)}function pv(){return new Er(this.value(),this.__chain__)}function dv(){this.__values__===i&&(this.__values__=_h(this.value()));var e=this.__index__>=this.__values__.length,t=e?i:this.__values__[this.__index__++];return{done:e,value:t}}function gv(){return this}function vv(e){for(var t,s=this;s instanceof Mn;){var a=Zu(s);a.__index__=0,a.__values__=i,t?l.__wrapped__=a:t=a;var l=a;s=s.__wrapped__}return l.__wrapped__=e,t}function yv(){var e=this.__wrapped__;if(e instanceof Oe){var t=e;return this.__actions__.length&&(t=new Oe(this)),t=t.reverse(),t.__actions__.push({func:Zn,args:[Da],thisArg:i}),new Er(t,this.__chain__)}return this.thru(Da)}function mv(){return Eu(this.__wrapped__,this.__actions__)}var wv=Vn(function(e,t,s){je.call(e,s)?++e[s]:Qr(e,s,1)});function _v(e,t,s){var a=me(e)?Dc:hd;return s&&Xt(e,t,s)&&(t=i),a(e,ne(t,3))}function bv(e,t){var s=me(e)?fi:nu;return s(e,ne(t,3))}var Ev=Lu(eh),xv=Lu(th);function Iv(e,t){return kt(eo(e,t),1)}function Pv(e,t){return kt(eo(e,t),ce)}function Sv(e,t,s){return s=s===i?1:we(s),kt(eo(e,t),s)}function ah(e,t){var s=me(e)?_r:vi;return s(e,ne(t,3))}function ch(e,t){var s=me(e)?Vf:su;return s(e,ne(t,3))}var Ov=Vn(function(e,t,s){je.call(e,s)?e[s].push(t):Qr(e,s,[t])});function Av(e,t,s,a){e=nr(e)?e:hs(e),s=s&&!a?we(s):0;var l=e.length;return s<0&&(s=qt(l+s,0)),no(e)?s<=l&&e.indexOf(t,s)>-1:!!l&&Xi(e,t,s)>-1}var Rv=Ie(function(e,t,s){var a=-1,l=typeof t=="function",d=nr(e)?A(e.length):[];return vi(e,function(m){d[++a]=l?jt(t,m,s):Ts(m,t,s)}),d}),Cv=Vn(function(e,t,s){Qr(e,s,t)});function eo(e,t){var s=me(e)?nt:lu;return s(e,ne(t,3))}function Tv(e,t,s,a){return e==null?[]:(me(t)||(t=t==null?[]:[t]),s=a?i:s,me(s)||(s=s==null?[]:[s]),gu(e,t,s))}var Nv=Vn(function(e,t,s){e[s?0:1].push(t)},function(){return[[],[]]});function Lv(e,t,s){var a=me(e)?Wo:jc,l=arguments.length<3;return a(e,ne(t,4),s,l,vi)}function Fv(e,t,s){var a=me(e)?Kf:jc,l=arguments.length<3;return a(e,ne(t,4),s,l,su)}function Dv(e,t){var s=me(e)?fi:nu;return s(e,io(ne(t,3)))}function $v(e){var t=me(e)?eu:Ad;return t(e)}function qv(e,t,s){(s?Xt(e,t,s):t===i)?t=1:t=we(t);var a=me(e)?nd:Rd;return a(e,t)}function Mv(e){var t=me(e)?od:Td;return t(e)}function jv(e){if(e==null)return 0;if(nr(e))return no(e)?es(e):e.length;var t=Kt(e);return t==_e||t==$e?e.size:pa(e).length}function zv(e,t,s){var a=me(e)?Jo:Nd;return s&&Xt(e,t,s)&&(t=i),a(e,ne(t,3))}var Uv=Ie(function(e,t){if(e==null)return[];var s=t.length;return s>1&&Xt(e,t[0],t[1])?t=[]:s>2&&Xt(t[0],t[1],t[2])&&(t=[t[0]]),gu(e,kt(t,1),[])}),to=bp||function(){return Ae.Date.now()};function Hv(e,t){if(typeof t!="function")throw new br(p);return e=we(e),function(){if(--e<1)return t.apply(this,arguments)}}function uh(e,t,s){return t=s?i:t,t=e&&t==null?e.length:t,Yr(e,M,i,i,i,i,t)}function hh(e,t){var s;if(typeof t!="function")throw new br(p);return e=we(e),function(){return--e>0&&(s=t.apply(this,arguments)),e<=1&&(t=i),s}}var qa=Ie(function(e,t,s){var a=ie;if(s.length){var l=di(s,cs(qa));a|=le}return Yr(e,a,t,s,l)}),lh=Ie(function(e,t,s){var a=ie|Ee;if(s.length){var l=di(s,cs(lh));a|=le}return Yr(t,a,e,s,l)});function fh(e,t,s){t=s?i:t;var a=Yr(e,pe,i,i,i,i,i,t);return a.placeholder=fh.placeholder,a}function ph(e,t,s){t=s?i:t;var a=Yr(e,he,i,i,i,i,i,t);return a.placeholder=ph.placeholder,a}function dh(e,t,s){var a,l,d,m,_,P,F=0,D=!1,z=!1,J=!0;if(typeof e!="function")throw new br(p);t=Sr(t)||0,ht(s)&&(D=!!s.leading,z="maxWait"in s,d=z?qt(Sr(s.maxWait)||0,t):d,J="trailing"in s?!!s.trailing:J);function te(xt){var Lr=a,ri=l;return a=l=i,F=xt,m=e.apply(ri,Lr),m}function oe(xt){return F=xt,_=$s(Pe,t),D?te(xt):m}function be(xt){var Lr=xt-P,ri=xt-F,Lh=t-Lr;return z?Vt(Lh,d-ri):Lh}function ae(xt){var Lr=xt-P,ri=xt-F;return P===i||Lr>=t||Lr<0||z&&ri>=d}function Pe(){var xt=to();if(ae(xt))return Re(xt);_=$s(Pe,be(xt))}function Re(xt){return _=i,J&&a?te(xt):(a=l=i,m)}function gr(){_!==i&&Iu(_),F=0,a=P=l=_=i}function Zt(){return _===i?m:Re(to())}function vr(){var xt=to(),Lr=ae(xt);if(a=arguments,l=this,P=xt,Lr){if(_===i)return oe(P);if(z)return Iu(_),_=$s(Pe,t),te(P)}return _===i&&(_=$s(Pe,t)),m}return vr.cancel=gr,vr.flush=Zt,vr}var kv=Ie(function(e,t){return iu(e,1,t)}),Bv=Ie(function(e,t,s){return iu(e,Sr(t)||0,s)});function Vv(e){return Yr(e,ve)}function ro(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new br(p);var s=function(){var a=arguments,l=t?t.apply(this,a):a[0],d=s.cache;if(d.has(l))return d.get(l);var m=e.apply(this,a);return s.cache=d.set(l,m)||d,m};return s.cache=new(ro.Cache||Jr),s}ro.Cache=Jr;function io(e){if(typeof e!="function")throw new br(p);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function Kv(e){return hh(2,e)}var Gv=Ld(function(e,t){t=t.length==1&&me(t[0])?nt(t[0],fr(ne())):nt(kt(t,1),fr(ne()));var s=t.length;return Ie(function(a){for(var l=-1,d=Vt(a.length,s);++l<d;)a[l]=t[l].call(this,a[l]);return jt(e,this,a)})}),Ma=Ie(function(e,t){var s=di(t,cs(Ma));return Yr(e,le,i,t,s)}),gh=Ie(function(e,t){var s=di(t,cs(gh));return Yr(e,T,i,t,s)}),Wv=Xr(function(e,t){return Yr(e,G,i,i,i,t)});function Jv(e,t){if(typeof e!="function")throw new br(p);return t=t===i?t:we(t),Ie(e,t)}function Qv(e,t){if(typeof e!="function")throw new br(p);return t=t==null?0:qt(we(t),0),Ie(function(s){var a=s[t],l=wi(s,0,t);return a&&pi(l,a),jt(e,this,l)})}function Yv(e,t,s){var a=!0,l=!0;if(typeof e!="function")throw new br(p);return ht(s)&&(a="leading"in s?!!s.leading:a,l="trailing"in s?!!s.trailing:l),dh(e,t,{leading:a,maxWait:t,trailing:l})}function Xv(e){return uh(e,1)}function Zv(e,t){return Ma(Ea(t),e)}function ey(){if(!arguments.length)return[];var e=arguments[0];return me(e)?e:[e]}function ty(e){return xr(e,K)}function ry(e,t){return t=typeof t=="function"?t:i,xr(e,K,t)}function iy(e){return xr(e,H|K)}function sy(e,t){return t=typeof t=="function"?t:i,xr(e,H|K,t)}function ny(e,t){return t==null||ru(e,t,zt(t))}function Nr(e,t){return e===t||e!==e&&t!==t}var oy=Jn(ha),ay=Jn(function(e,t){return e>=t}),zi=cu(function(){return arguments}())?cu:function(e){return mt(e)&&je.call(e,"callee")&&!Wc.call(e,"callee")},me=A.isArray,cy=Qt?fr(Qt):vd;function nr(e){return e!=null&&so(e.length)&&!ei(e)}function Et(e){return mt(e)&&nr(e)}function uy(e){return e===!0||e===!1||mt(e)&&Yt(e)==R}var _i=xp||Ja,hy=Rr?fr(Rr):yd;function ly(e){return mt(e)&&e.nodeType===1&&!qs(e)}function fy(e){if(e==null)return!0;if(nr(e)&&(me(e)||typeof e=="string"||typeof e.splice=="function"||_i(e)||us(e)||zi(e)))return!e.length;var t=Kt(e);if(t==_e||t==$e)return!e.size;if(Ds(e))return!pa(e).length;for(var s in e)if(je.call(e,s))return!1;return!0}function py(e,t){return Ns(e,t)}function dy(e,t,s){s=typeof s=="function"?s:i;var a=s?s(e,t):i;return a===i?Ns(e,t,i,s):!!a}function ja(e){if(!mt(e))return!1;var t=Yt(e);return t==b||t==u||typeof e.message=="string"&&typeof e.name=="string"&&!qs(e)}function gy(e){return typeof e=="number"&&Qc(e)}function ei(e){if(!ht(e))return!1;var t=Yt(e);return t==ee||t==fe||t==C||t==wt}function vh(e){return typeof e=="number"&&e==we(e)}function so(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=k}function ht(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}function mt(e){return e!=null&&typeof e=="object"}var yh=wr?fr(wr):wd;function vy(e,t){return e===t||fa(e,t,Ra(t))}function yy(e,t,s){return s=typeof s=="function"?s:i,fa(e,t,Ra(t),s)}function my(e){return mh(e)&&e!=+e}function wy(e){if(rg(e))throw new de(h);return uu(e)}function _y(e){return e===null}function by(e){return e==null}function mh(e){return typeof e=="number"||mt(e)&&Yt(e)==Ne}function qs(e){if(!mt(e)||Yt(e)!=Se)return!1;var t=Tn(e);if(t===null)return!0;var s=je.call(t,"constructor")&&t.constructor;return typeof s=="function"&&s instanceof s&&On.call(s)==yp}var za=zr?fr(zr):_d;function Ey(e){return vh(e)&&e>=-k&&e<=k}var wh=Es?fr(Es):bd;function no(e){return typeof e=="string"||!me(e)&&mt(e)&&Yt(e)==Xe}function dr(e){return typeof e=="symbol"||mt(e)&&Yt(e)==Ze}var us=Ni?fr(Ni):Ed;function xy(e){return e===i}function Iy(e){return mt(e)&&Kt(e)==Ue}function Py(e){return mt(e)&&Yt(e)==et}var Sy=Jn(da),Oy=Jn(function(e,t){return e<=t});function _h(e){if(!e)return[];if(nr(e))return no(e)?Cr(e):sr(e);if(Is&&e[Is])return np(e[Is]());var t=Kt(e),s=t==_e?ta:t==$e?In:hs;return s(e)}function ti(e){if(!e)return e===0?e:0;if(e=Sr(e),e===ce||e===-ce){var t=e<0?-1:1;return t*j}return e===e?e:0}function we(e){var t=ti(e),s=t%1;return t===t?s?t-s:t:0}function bh(e){return e?$i(we(e),0,V):0}function Sr(e){if(typeof e=="number")return e;if(dr(e))return U;if(ht(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=ht(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=zc(e);var s=Co.test(e);return s||No.test(e)?ye(e.slice(2),s?2:8):Ro.test(e)?U:+e}function Eh(e){return Hr(e,or(e))}function Ay(e){return e?$i(we(e),-k,k):e===0?e:0}function qe(e){return e==null?"":pr(e)}var Ry=os(function(e,t){if(Ds(t)||nr(t)){Hr(t,zt(t),e);return}for(var s in t)je.call(t,s)&&Rs(e,s,t[s])}),xh=os(function(e,t){Hr(t,or(t),e)}),oo=os(function(e,t,s,a){Hr(t,or(t),e,a)}),Cy=os(function(e,t,s,a){Hr(t,zt(t),e,a)}),Ty=Xr(aa);function Ny(e,t){var s=ns(e);return t==null?s:tu(s,t)}var Ly=Ie(function(e,t){e=Je(e);var s=-1,a=t.length,l=a>2?t[2]:i;for(l&&Xt(t[0],t[1],l)&&(a=1);++s<a;)for(var d=t[s],m=or(d),_=-1,P=m.length;++_<P;){var F=m[_],D=e[F];(D===i||Nr(D,rs[F])&&!je.call(e,F))&&(e[F]=d[F])}return e}),Fy=Ie(function(e){return e.push(i,zu),jt(Ih,i,e)});function Dy(e,t){return $c(e,ne(t,3),Ur)}function $y(e,t){return $c(e,ne(t,3),ua)}function qy(e,t){return e==null?e:ca(e,ne(t,3),or)}function My(e,t){return e==null?e:ou(e,ne(t,3),or)}function jy(e,t){return e&&Ur(e,ne(t,3))}function zy(e,t){return e&&ua(e,ne(t,3))}function Uy(e){return e==null?[]:Un(e,zt(e))}function Hy(e){return e==null?[]:Un(e,or(e))}function Ua(e,t,s){var a=e==null?i:qi(e,t);return a===i?s:a}function ky(e,t){return e!=null&&ku(e,t,fd)}function Ha(e,t){return e!=null&&ku(e,t,pd)}var By=Du(function(e,t,s){t!=null&&typeof t.toString!="function"&&(t=An.call(t)),e[t]=s},Ba(ar)),Vy=Du(function(e,t,s){t!=null&&typeof t.toString!="function"&&(t=An.call(t)),je.call(e,t)?e[t].push(s):e[t]=[s]},ne),Ky=Ie(Ts);function zt(e){return nr(e)?Zc(e):pa(e)}function or(e){return nr(e)?Zc(e,!0):xd(e)}function Gy(e,t){var s={};return t=ne(t,3),Ur(e,function(a,l,d){Qr(s,t(a,l,d),a)}),s}function Wy(e,t){var s={};return t=ne(t,3),Ur(e,function(a,l,d){Qr(s,l,t(a,l,d))}),s}var Jy=os(function(e,t,s){Hn(e,t,s)}),Ih=os(function(e,t,s,a){Hn(e,t,s,a)}),Qy=Xr(function(e,t){var s={};if(e==null)return s;var a=!1;t=nt(t,function(d){return d=mi(d,e),a||(a=d.length>1),d}),Hr(e,Oa(e),s),a&&(s=xr(s,H|B|K,Bd));for(var l=t.length;l--;)wa(s,t[l]);return s});function Yy(e,t){return Ph(e,io(ne(t)))}var Xy=Xr(function(e,t){return e==null?{}:Pd(e,t)});function Ph(e,t){if(e==null)return{};var s=nt(Oa(e),function(a){return[a]});return t=ne(t),vu(e,s,function(a,l){return t(a,l[0])})}function Zy(e,t,s){t=mi(t,e);var a=-1,l=t.length;for(l||(l=1,e=i);++a<l;){var d=e==null?i:e[kr(t[a])];d===i&&(a=l,d=s),e=ei(d)?d.call(e):d}return e}function e0(e,t,s){return e==null?e:Ls(e,t,s)}function t0(e,t,s,a){return a=typeof a=="function"?a:i,e==null?e:Ls(e,t,s,a)}var Sh=Mu(zt),Oh=Mu(or);function r0(e,t,s){var a=me(e),l=a||_i(e)||us(e);if(t=ne(t,4),s==null){var d=e&&e.constructor;l?s=a?new d:[]:ht(e)?s=ei(d)?ns(Tn(e)):{}:s={}}return(l?_r:Ur)(e,function(m,_,P){return t(s,m,_,P)}),s}function i0(e,t){return e==null?!0:wa(e,t)}function s0(e,t,s){return e==null?e:bu(e,t,Ea(s))}function n0(e,t,s,a){return a=typeof a=="function"?a:i,e==null?e:bu(e,t,Ea(s),a)}function hs(e){return e==null?[]:ea(e,zt(e))}function o0(e){return e==null?[]:ea(e,or(e))}function a0(e,t,s){return s===i&&(s=t,t=i),s!==i&&(s=Sr(s),s=s===s?s:0),t!==i&&(t=Sr(t),t=t===t?t:0),$i(Sr(e),t,s)}function c0(e,t,s){return t=ti(t),s===i?(s=t,t=0):s=ti(s),e=Sr(e),dd(e,t,s)}function u0(e,t,s){if(s&&typeof s!="boolean"&&Xt(e,t,s)&&(t=s=i),s===i&&(typeof t=="boolean"?(s=t,t=i):typeof e=="boolean"&&(s=e,e=i)),e===i&&t===i?(e=0,t=1):(e=ti(e),t===i?(t=e,e=0):t=ti(t)),e>t){var a=e;e=t,t=a}if(s||e%1||t%1){var l=Yc();return Vt(e+l*(t-e+Ge("1e-"+((l+"").length-1))),t)}return va(e,t)}var h0=as(function(e,t,s){return t=t.toLowerCase(),e+(s?Ah(t):t)});function Ah(e){return ka(qe(e).toLowerCase())}function Rh(e){return e=qe(e),e&&e.replace(Kr,ep).replace(Vo,"")}function l0(e,t,s){e=qe(e),t=pr(t);var a=e.length;s=s===i?a:$i(we(s),0,a);var l=s;return s-=t.length,s>=0&&e.slice(s,l)==t}function f0(e){return e=qe(e),e&&it.test(e)?e.replace(Oi,tp):e}function p0(e){return e=qe(e),e&&Rt.test(e)?e.replace(gt,"\\$&"):e}var d0=as(function(e,t,s){return e+(s?"-":"")+t.toLowerCase()}),g0=as(function(e,t,s){return e+(s?" ":"")+t.toLowerCase()}),v0=Nu("toLowerCase");function y0(e,t,s){e=qe(e),t=we(t);var a=t?es(e):0;if(!t||a>=t)return e;var l=(t-a)/2;return Wn(Dn(l),s)+e+Wn(Fn(l),s)}function m0(e,t,s){e=qe(e),t=we(t);var a=t?es(e):0;return t&&a<t?e+Wn(t-a,s):e}function w0(e,t,s){e=qe(e),t=we(t);var a=t?es(e):0;return t&&a<t?Wn(t-a,s)+e:e}function _0(e,t,s){return s||t==null?t=0:t&&(t=+t),Op(qe(e).replace(vt,""),t||0)}function b0(e,t,s){return(s?Xt(e,t,s):t===i)?t=1:t=we(t),ya(qe(e),t)}function E0(){var e=arguments,t=qe(e[0]);return e.length<3?t:t.replace(e[1],e[2])}var x0=as(function(e,t,s){return e+(s?"_":"")+t.toLowerCase()});function I0(e,t,s){return s&&typeof s!="number"&&Xt(e,t,s)&&(t=s=i),s=s===i?V:s>>>0,s?(e=qe(e),e&&(typeof t=="string"||t!=null&&!za(t))&&(t=pr(t),!t&&Zi(e))?wi(Cr(e),0,s):e.split(t,s)):[]}var P0=as(function(e,t,s){return e+(s?" ":"")+ka(t)});function S0(e,t,s){return e=qe(e),s=s==null?0:$i(we(s),0,e.length),t=pr(t),e.slice(s,s+t.length)==t}function O0(e,t,s){var a=f.templateSettings;s&&Xt(e,t,s)&&(t=i),e=qe(e),t=oo({},t,a,ju);var l=oo({},t.imports,a.imports,ju),d=zt(l),m=ea(l,d),_,P,F=0,D=t.interpolate||Vi,z="__p += '",J=ra((t.escape||Vi).source+"|"+D.source+"|"+(D===ut?Ao:Vi).source+"|"+(t.evaluate||Vi).source+"|$","g"),te="//# sourceURL="+(je.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Ko+"]")+`
`;e.replace(J,function(ae,Pe,Re,gr,Zt,vr){return Re||(Re=gr),z+=e.slice(F,vr).replace(Fo,rp),Pe&&(_=!0,z+=`' +
__e(`+Pe+`) +
'`),Zt&&(P=!0,z+=`';
`+Zt+`;
__p += '`),Re&&(z+=`' +
((__t = (`+Re+`)) == null ? '' : __t) +
'`),F=vr+ae.length,ae}),z+=`';
`;var oe=je.call(t,"variable")&&t.variable;if(!oe)z=`with (obj) {
`+z+`
}
`;else if(So.test(oe))throw new de(g);z=(P?z.replace(Mr,""):z).replace(Jt,"$1").replace(Vr,"$1;"),z="function("+(oe||"obj")+`) {
`+(oe?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(_?", __e = _.escape":"")+(P?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+z+`return __p
}`;var be=Th(function(){return De(d,te+"return "+z).apply(i,m)});if(be.source=z,ja(be))throw be;return be}function A0(e){return qe(e).toLowerCase()}function R0(e){return qe(e).toUpperCase()}function C0(e,t,s){if(e=qe(e),e&&(s||t===i))return zc(e);if(!e||!(t=pr(t)))return e;var a=Cr(e),l=Cr(t),d=Uc(a,l),m=Hc(a,l)+1;return wi(a,d,m).join("")}function T0(e,t,s){if(e=qe(e),e&&(s||t===i))return e.slice(0,Bc(e)+1);if(!e||!(t=pr(t)))return e;var a=Cr(e),l=Hc(a,Cr(t))+1;return wi(a,0,l).join("")}function N0(e,t,s){if(e=qe(e),e&&(s||t===i))return e.replace(vt,"");if(!e||!(t=pr(t)))return e;var a=Cr(e),l=Uc(a,Cr(t));return wi(a,l).join("")}function L0(e,t){var s=re,a=ue;if(ht(t)){var l="separator"in t?t.separator:l;s="length"in t?we(t.length):s,a="omission"in t?pr(t.omission):a}e=qe(e);var d=e.length;if(Zi(e)){var m=Cr(e);d=m.length}if(s>=d)return e;var _=s-es(a);if(_<1)return a;var P=m?wi(m,0,_).join(""):e.slice(0,_);if(l===i)return P+a;if(m&&(_+=P.length-_),za(l)){if(e.slice(_).search(l)){var F,D=P;for(l.global||(l=ra(l.source,qe(mr.exec(l))+"g")),l.lastIndex=0;F=l.exec(D);)var z=F.index;P=P.slice(0,z===i?_:z)}}else if(e.indexOf(pr(l),_)!=_){var J=P.lastIndexOf(l);J>-1&&(P=P.slice(0,J))}return P+a}function F0(e){return e=qe(e),e&&ft.test(e)?e.replace(hi,up):e}var D0=as(function(e,t,s){return e+(s?" ":"")+t.toUpperCase()}),ka=Nu("toUpperCase");function Ch(e,t,s){return e=qe(e),t=s?i:t,t===i?sp(e)?fp(e):Jf(e):e.match(t)||[]}var Th=Ie(function(e,t){try{return jt(e,i,t)}catch(s){return ja(s)?s:new de(s)}}),$0=Xr(function(e,t){return _r(t,function(s){s=kr(s),Qr(e,s,qa(e[s],e))}),e});function q0(e){var t=e==null?0:e.length,s=ne();return e=t?nt(e,function(a){if(typeof a[1]!="function")throw new br(p);return[s(a[0]),a[1]]}):[],Ie(function(a){for(var l=-1;++l<t;){var d=e[l];if(jt(d[0],this,a))return jt(d[1],this,a)}})}function M0(e){return ud(xr(e,H))}function Ba(e){return function(){return e}}function j0(e,t){return e==null||e!==e?t:e}var z0=Fu(),U0=Fu(!0);function ar(e){return e}function Va(e){return hu(typeof e=="function"?e:xr(e,H))}function H0(e){return fu(xr(e,H))}function k0(e,t){return pu(e,xr(t,H))}var B0=Ie(function(e,t){return function(s){return Ts(s,e,t)}}),V0=Ie(function(e,t){return function(s){return Ts(e,s,t)}});function Ka(e,t,s){var a=zt(t),l=Un(t,a);s==null&&!(ht(t)&&(l.length||!a.length))&&(s=t,t=e,e=this,l=Un(t,zt(t)));var d=!(ht(s)&&"chain"in s)||!!s.chain,m=ei(e);return _r(l,function(_){var P=t[_];e[_]=P,m&&(e.prototype[_]=function(){var F=this.__chain__;if(d||F){var D=e(this.__wrapped__),z=D.__actions__=sr(this.__actions__);return z.push({func:P,args:arguments,thisArg:e}),D.__chain__=F,D}return P.apply(e,pi([this.value()],arguments))})}),e}function K0(){return Ae._===this&&(Ae._=mp),this}function Ga(){}function G0(e){return e=we(e),Ie(function(t){return du(t,e)})}var W0=Ia(nt),J0=Ia(Dc),Q0=Ia(Jo);function Nh(e){return Ta(e)?Qo(kr(e)):Sd(e)}function Y0(e){return function(t){return e==null?i:qi(e,t)}}var X0=$u(),Z0=$u(!0);function Wa(){return[]}function Ja(){return!1}function em(){return{}}function tm(){return""}function rm(){return!0}function im(e,t){if(e=we(e),e<1||e>k)return[];var s=V,a=Vt(e,V);t=ne(t),e-=V;for(var l=Zo(a,t);++s<e;)t(s);return l}function sm(e){return me(e)?nt(e,kr):dr(e)?[e]:sr(Xu(qe(e)))}function nm(e){var t=++vp;return qe(e)+t}var om=Gn(function(e,t){return e+t},0),am=Pa("ceil"),cm=Gn(function(e,t){return e/t},1),um=Pa("floor");function hm(e){return e&&e.length?zn(e,ar,ha):i}function lm(e,t){return e&&e.length?zn(e,ne(t,2),ha):i}function fm(e){return Mc(e,ar)}function pm(e,t){return Mc(e,ne(t,2))}function dm(e){return e&&e.length?zn(e,ar,da):i}function gm(e,t){return e&&e.length?zn(e,ne(t,2),da):i}var vm=Gn(function(e,t){return e*t},1),ym=Pa("round"),mm=Gn(function(e,t){return e-t},0);function wm(e){return e&&e.length?Xo(e,ar):0}function _m(e,t){return e&&e.length?Xo(e,ne(t,2)):0}return f.after=Hv,f.ary=uh,f.assign=Ry,f.assignIn=xh,f.assignInWith=oo,f.assignWith=Cy,f.at=Ty,f.before=hh,f.bind=qa,f.bindAll=$0,f.bindKey=lh,f.castArray=ey,f.chain=oh,f.chunk=ug,f.compact=hg,f.concat=lg,f.cond=q0,f.conforms=M0,f.constant=Ba,f.countBy=wv,f.create=Ny,f.curry=fh,f.curryRight=ph,f.debounce=dh,f.defaults=Ly,f.defaultsDeep=Fy,f.defer=kv,f.delay=Bv,f.difference=fg,f.differenceBy=pg,f.differenceWith=dg,f.drop=gg,f.dropRight=vg,f.dropRightWhile=yg,f.dropWhile=mg,f.fill=wg,f.filter=bv,f.flatMap=Iv,f.flatMapDeep=Pv,f.flatMapDepth=Sv,f.flatten=rh,f.flattenDeep=_g,f.flattenDepth=bg,f.flip=Vv,f.flow=z0,f.flowRight=U0,f.fromPairs=Eg,f.functions=Uy,f.functionsIn=Hy,f.groupBy=Ov,f.initial=Ig,f.intersection=Pg,f.intersectionBy=Sg,f.intersectionWith=Og,f.invert=By,f.invertBy=Vy,f.invokeMap=Rv,f.iteratee=Va,f.keyBy=Cv,f.keys=zt,f.keysIn=or,f.map=eo,f.mapKeys=Gy,f.mapValues=Wy,f.matches=H0,f.matchesProperty=k0,f.memoize=ro,f.merge=Jy,f.mergeWith=Ih,f.method=B0,f.methodOf=V0,f.mixin=Ka,f.negate=io,f.nthArg=G0,f.omit=Qy,f.omitBy=Yy,f.once=Kv,f.orderBy=Tv,f.over=W0,f.overArgs=Gv,f.overEvery=J0,f.overSome=Q0,f.partial=Ma,f.partialRight=gh,f.partition=Nv,f.pick=Xy,f.pickBy=Ph,f.property=Nh,f.propertyOf=Y0,f.pull=Tg,f.pullAll=sh,f.pullAllBy=Ng,f.pullAllWith=Lg,f.pullAt=Fg,f.range=X0,f.rangeRight=Z0,f.rearg=Wv,f.reject=Dv,f.remove=Dg,f.rest=Jv,f.reverse=Da,f.sampleSize=qv,f.set=e0,f.setWith=t0,f.shuffle=Mv,f.slice=$g,f.sortBy=Uv,f.sortedUniq=kg,f.sortedUniqBy=Bg,f.split=I0,f.spread=Qv,f.tail=Vg,f.take=Kg,f.takeRight=Gg,f.takeRightWhile=Wg,f.takeWhile=Jg,f.tap=hv,f.throttle=Yv,f.thru=Zn,f.toArray=_h,f.toPairs=Sh,f.toPairsIn=Oh,f.toPath=sm,f.toPlainObject=Eh,f.transform=r0,f.unary=Xv,f.union=Qg,f.unionBy=Yg,f.unionWith=Xg,f.uniq=Zg,f.uniqBy=ev,f.uniqWith=tv,f.unset=i0,f.unzip=$a,f.unzipWith=nh,f.update=s0,f.updateWith=n0,f.values=hs,f.valuesIn=o0,f.without=rv,f.words=Ch,f.wrap=Zv,f.xor=iv,f.xorBy=sv,f.xorWith=nv,f.zip=ov,f.zipObject=av,f.zipObjectDeep=cv,f.zipWith=uv,f.entries=Sh,f.entriesIn=Oh,f.extend=xh,f.extendWith=oo,Ka(f,f),f.add=om,f.attempt=Th,f.camelCase=h0,f.capitalize=Ah,f.ceil=am,f.clamp=a0,f.clone=ty,f.cloneDeep=iy,f.cloneDeepWith=sy,f.cloneWith=ry,f.conformsTo=ny,f.deburr=Rh,f.defaultTo=j0,f.divide=cm,f.endsWith=l0,f.eq=Nr,f.escape=f0,f.escapeRegExp=p0,f.every=_v,f.find=Ev,f.findIndex=eh,f.findKey=Dy,f.findLast=xv,f.findLastIndex=th,f.findLastKey=$y,f.floor=um,f.forEach=ah,f.forEachRight=ch,f.forIn=qy,f.forInRight=My,f.forOwn=jy,f.forOwnRight=zy,f.get=Ua,f.gt=oy,f.gte=ay,f.has=ky,f.hasIn=Ha,f.head=ih,f.identity=ar,f.includes=Av,f.indexOf=xg,f.inRange=c0,f.invoke=Ky,f.isArguments=zi,f.isArray=me,f.isArrayBuffer=cy,f.isArrayLike=nr,f.isArrayLikeObject=Et,f.isBoolean=uy,f.isBuffer=_i,f.isDate=hy,f.isElement=ly,f.isEmpty=fy,f.isEqual=py,f.isEqualWith=dy,f.isError=ja,f.isFinite=gy,f.isFunction=ei,f.isInteger=vh,f.isLength=so,f.isMap=yh,f.isMatch=vy,f.isMatchWith=yy,f.isNaN=my,f.isNative=wy,f.isNil=by,f.isNull=_y,f.isNumber=mh,f.isObject=ht,f.isObjectLike=mt,f.isPlainObject=qs,f.isRegExp=za,f.isSafeInteger=Ey,f.isSet=wh,f.isString=no,f.isSymbol=dr,f.isTypedArray=us,f.isUndefined=xy,f.isWeakMap=Iy,f.isWeakSet=Py,f.join=Ag,f.kebabCase=d0,f.last=Pr,f.lastIndexOf=Rg,f.lowerCase=g0,f.lowerFirst=v0,f.lt=Sy,f.lte=Oy,f.max=hm,f.maxBy=lm,f.mean=fm,f.meanBy=pm,f.min=dm,f.minBy=gm,f.stubArray=Wa,f.stubFalse=Ja,f.stubObject=em,f.stubString=tm,f.stubTrue=rm,f.multiply=vm,f.nth=Cg,f.noConflict=K0,f.noop=Ga,f.now=to,f.pad=y0,f.padEnd=m0,f.padStart=w0,f.parseInt=_0,f.random=u0,f.reduce=Lv,f.reduceRight=Fv,f.repeat=b0,f.replace=E0,f.result=Zy,f.round=ym,f.runInContext=I,f.sample=$v,f.size=jv,f.snakeCase=x0,f.some=zv,f.sortedIndex=qg,f.sortedIndexBy=Mg,f.sortedIndexOf=jg,f.sortedLastIndex=zg,f.sortedLastIndexBy=Ug,f.sortedLastIndexOf=Hg,f.startCase=P0,f.startsWith=S0,f.subtract=mm,f.sum=wm,f.sumBy=_m,f.template=O0,f.times=im,f.toFinite=ti,f.toInteger=we,f.toLength=bh,f.toLower=A0,f.toNumber=Sr,f.toSafeInteger=Ay,f.toString=qe,f.toUpper=R0,f.trim=C0,f.trimEnd=T0,f.trimStart=N0,f.truncate=L0,f.unescape=F0,f.uniqueId=nm,f.upperCase=D0,f.upperFirst=ka,f.each=ah,f.eachRight=ch,f.first=ih,Ka(f,function(){var e={};return Ur(f,function(t,s){je.call(f.prototype,s)||(e[s]=t)}),e}(),{chain:!1}),f.VERSION=n,_r(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){f[e].placeholder=f}),_r(["drop","take"],function(e,t){Oe.prototype[e]=function(s){s=s===i?1:qt(we(s),0);var a=this.__filtered__&&!t?new Oe(this):this.clone();return a.__filtered__?a.__takeCount__=Vt(s,a.__takeCount__):a.__views__.push({size:Vt(s,V),type:e+(a.__dir__<0?"Right":"")}),a},Oe.prototype[e+"Right"]=function(s){return this.reverse()[e](s).reverse()}}),_r(["filter","map","takeWhile"],function(e,t){var s=t+1,a=s==y||s==Y;Oe.prototype[e]=function(l){var d=this.clone();return d.__iteratees__.push({iteratee:ne(l,3),type:s}),d.__filtered__=d.__filtered__||a,d}}),_r(["head","last"],function(e,t){var s="take"+(t?"Right":"");Oe.prototype[e]=function(){return this[s](1).value()[0]}}),_r(["initial","tail"],function(e,t){var s="drop"+(t?"":"Right");Oe.prototype[e]=function(){return this.__filtered__?new Oe(this):this[s](1)}}),Oe.prototype.compact=function(){return this.filter(ar)},Oe.prototype.find=function(e){return this.filter(e).head()},Oe.prototype.findLast=function(e){return this.reverse().find(e)},Oe.prototype.invokeMap=Ie(function(e,t){return typeof e=="function"?new Oe(this):this.map(function(s){return Ts(s,e,t)})}),Oe.prototype.reject=function(e){return this.filter(io(ne(e)))},Oe.prototype.slice=function(e,t){e=we(e);var s=this;return s.__filtered__&&(e>0||t<0)?new Oe(s):(e<0?s=s.takeRight(-e):e&&(s=s.drop(e)),t!==i&&(t=we(t),s=t<0?s.dropRight(-t):s.take(t-e)),s)},Oe.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},Oe.prototype.toArray=function(){return this.take(V)},Ur(Oe.prototype,function(e,t){var s=/^(?:filter|find|map|reject)|While$/.test(t),a=/^(?:head|last)$/.test(t),l=f[a?"take"+(t=="last"?"Right":""):t],d=a||/^find/.test(t);l&&(f.prototype[t]=function(){var m=this.__wrapped__,_=a?[1]:arguments,P=m instanceof Oe,F=_[0],D=P||me(m),z=function(Pe){var Re=l.apply(f,pi([Pe],_));return a&&J?Re[0]:Re};D&&s&&typeof F=="function"&&F.length!=1&&(P=D=!1);var J=this.__chain__,te=!!this.__actions__.length,oe=d&&!J,be=P&&!te;if(!d&&D){m=be?m:new Oe(this);var ae=e.apply(m,_);return ae.__actions__.push({func:Zn,args:[z],thisArg:i}),new Er(ae,J)}return oe&&be?e.apply(this,_):(ae=this.thru(z),oe?a?ae.value()[0]:ae.value():ae)})}),_r(["pop","push","shift","sort","splice","unshift"],function(e){var t=Pn[e],s=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",a=/^(?:pop|shift)$/.test(e);f.prototype[e]=function(){var l=arguments;if(a&&!this.__chain__){var d=this.value();return t.apply(me(d)?d:[],l)}return this[s](function(m){return t.apply(me(m)?m:[],l)})}}),Ur(Oe.prototype,function(e,t){var s=f[t];if(s){var a=s.name+"";je.call(ss,a)||(ss[a]=[]),ss[a].push({name:t,func:s})}}),ss[Kn(i,Ee).name]=[{name:"wrapper",func:i}],Oe.prototype.clone=Fp,Oe.prototype.reverse=Dp,Oe.prototype.value=$p,f.prototype.at=lv,f.prototype.chain=fv,f.prototype.commit=pv,f.prototype.next=dv,f.prototype.plant=vv,f.prototype.reverse=yv,f.prototype.toJSON=f.prototype.valueOf=f.prototype.value=mv,f.prototype.first=f.prototype.head,Is&&(f.prototype[Is]=gv),f},ts=pp();bt?((bt.exports=ts)._=ts,We._=ts):Ae._=ts}).call(Gs)})(yc,yc.exports);var bE=Object.defineProperty,EE=Object.defineProperties,xE=Object.getOwnPropertyDescriptors,ql=Object.getOwnPropertySymbols,IE=Object.prototype.hasOwnProperty,PE=Object.prototype.propertyIsEnumerable,Ml=(c,r,i)=>r in c?bE(c,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):c[r]=i,uo=(c,r)=>{for(var i in r||(r={}))IE.call(r,i)&&Ml(c,i,r[i]);if(ql)for(var i of ql(r))PE.call(r,i)&&Ml(c,i,r[i]);return c},SE=(c,r)=>EE(c,xE(r));function Ii(c,r,i){var n;const o=o1(c);return((n=r.rpcMap)==null?void 0:n[o.reference])||`${_E}?chainId=${o.namespace}:${o.reference}&projectId=${i}`}function Bi(c){return c.includes(":")?c.split(":")[1]:c}function Hf(c){return c.map(r=>`${r.split(":")[0]}:${r.split(":")[1]}`)}function OE(c,r){const i=Object.keys(r.namespaces).filter(o=>o.includes(c));if(!i.length)return[];const n=[];return i.forEach(o=>{const h=r.namespaces[o].accounts;n.push(...h)}),n}function AE(c={},r={}){const i=jl(c),n=jl(r);return yc.exports.merge(i,n)}function jl(c){var r,i,n,o;const h={};if(!fo(c))return h;for(const[p,g]of Object.entries(c)){const w=Xl(p)?[p]:g.chains,S=g.methods||[],L=g.events||[],H=g.rpcMap||{},B=Ws(p);h[B]=SE(uo(uo({},h[B]),g),{chains:Ya(w,(r=h[B])==null?void 0:r.chains),methods:Ya(S,(i=h[B])==null?void 0:i.methods),events:Ya(L,(n=h[B])==null?void 0:n.events),rpcMap:uo(uo({},H),(o=h[B])==null?void 0:o.rpcMap)})}return h}function RE(c){return c.includes(":")?c.split(":")[2]:c}function CE(c){const r={};for(const[i,n]of Object.entries(c)){const o=n.methods||[],h=n.events||[],p=n.accounts||[],g=Xl(i)?[i]:n.chains?n.chains:Hf(n.accounts);r[i]={chains:g,methods:o,events:h,accounts:p}}return r}function cc(c){return typeof c=="number"?c:c.includes("0x")?parseInt(c,16):c.includes(":")?Number(c.split(":")[1]):Number(c)}const kf={},ot=c=>kf[c],uc=(c,r)=>{kf[c]=r};class TE{constructor(r){this.name="polkadot",this.namespace=r.namespace,this.events=ot("events"),this.client=ot("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){this.httpProviders[r]||this.setHttpProvider(r,i),this.chainId=r,this.events.emit(ui.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}getAccounts(){const r=this.namespace.accounts;return r?r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2])||[]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;const o=Bi(i);r[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||Ii(r,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new ci(new Si(n,ot("disableProviderPing")))}}class NE{constructor(r){this.name="eip155",this.namespace=r.namespace,this.events=ot("events"),this.client=ot("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(r){switch(r.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(r);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(r.request.method)?await this.client.request(r):this.getHttpProvider().request(r.request)}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}setDefaultChain(r,i){this.httpProviders[r]||this.setHttpProvider(parseInt(r),i),this.chainId=parseInt(r),this.events.emit(ui.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}createHttpProvider(r,i){const n=i||Ii(`${this.name}:${r}`,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new ci(new Si(n,ot("disableProviderPing")))}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;const o=parseInt(Bi(i));r[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}getHttpProvider(){const r=this.chainId,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}async handleSwitchChain(r){var i,n;let o=r.request.params?(i=r.request.params[0])==null?void 0:i.chainId:"0x0";o=o.startsWith("0x")?o:`0x${o}`;const h=parseInt(o,16);if(this.isChainApproved(h))this.setDefaultChain(`${h}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:r.topic,request:{method:r.request.method,params:[{chainId:o}]},chainId:(n=this.namespace.chains)==null?void 0:n[0]}),this.setDefaultChain(`${h}`);else throw new Error(`Failed to switch to chain 'eip155:${h}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(r){return this.namespace.chains.includes(`${this.name}:${r}`)}}class LE{constructor(r){this.name="solana",this.namespace=r.namespace,this.events=ot("events"),this.client=ot("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){this.httpProviders[r]||this.setHttpProvider(r,i),this.chainId=r,this.events.emit(ui.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;const o=Bi(i);r[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||Ii(r,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new ci(new Si(n,ot("disableProviderPing")))}}class FE{constructor(r){this.name="cosmos",this.namespace=r.namespace,this.events=ot("events"),this.client=ot("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){this.httpProviders[r]||this.setHttpProvider(r,i),this.chainId=r,this.events.emit(ui.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;const o=Bi(i);r[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||Ii(r,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new ci(new Si(n,ot("disableProviderPing")))}}class DE{constructor(r){this.name="cip34",this.namespace=r.namespace,this.events=ot("events"),this.client=ot("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){this.httpProviders[r]||this.setHttpProvider(r,i),this.chainId=r,this.events.emit(ui.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{const n=this.getCardanoRPCUrl(i),o=Bi(i);r[o]=this.createHttpProvider(o,n)}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}getCardanoRPCUrl(r){const i=this.namespace.rpcMap;if(i)return i[r]}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||this.getCardanoRPCUrl(r);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new ci(new Si(n,ot("disableProviderPing")))}}class $E{constructor(r){this.name="elrond",this.namespace=r.namespace,this.events=ot("events"),this.client=ot("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){this.httpProviders[r]||this.setHttpProvider(r,i),this.chainId=r,this.events.emit(ui.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;const o=Bi(i);r[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||Ii(r,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new ci(new Si(n,ot("disableProviderPing")))}}class qE{constructor(r){this.name="multiversx",this.namespace=r.namespace,this.events=ot("events"),this.client=ot("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){this.httpProviders[r]||this.setHttpProvider(r,i),this.chainId=r,this.events.emit(ui.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;const o=Bi(i);r[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||Ii(r,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new ci(new Si(n,ot("disableProviderPing")))}}class ME{constructor(r){this.name="near",this.namespace=r.namespace,this.events=ot("events"),this.client=ot("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){if(this.chainId=r,!this.httpProviders[r]){const n=i||Ii(`${this.name}:${r}`,this.namespace);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);this.setHttpProvider(r,n)}this.events.emit(ui.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const r=this.namespace.accounts;return r?r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2])||[]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;r[i]=this.createHttpProvider(i,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||Ii(r,this.namespace);return typeof n>"u"?void 0:new ci(new Si(n,ot("disableProviderPing")))}}var jE=Object.defineProperty,zE=Object.defineProperties,UE=Object.getOwnPropertyDescriptors,zl=Object.getOwnPropertySymbols,HE=Object.prototype.hasOwnProperty,kE=Object.prototype.propertyIsEnumerable,Ul=(c,r,i)=>r in c?jE(c,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):c[r]=i,ho=(c,r)=>{for(var i in r||(r={}))HE.call(r,i)&&Ul(c,i,r[i]);if(zl)for(var i of zl(r))kE.call(r,i)&&Ul(c,i,r[i]);return c},hc=(c,r)=>zE(c,UE(r));class Lc{constructor(r){this.events=new xc,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=r,this.logger=typeof(r==null?void 0:r.logger)<"u"&&typeof(r==null?void 0:r.logger)!="string"?r.logger:Ce.pino(Ce.getDefaultLoggerOptions({level:(r==null?void 0:r.logger)||Dl})),this.disableProviderPing=(r==null?void 0:r.disableProviderPing)||!1}static async init(r){const i=new Lc(r);return await i.initialize(),i}async request(r,i){const[n,o]=this.validateChain(i);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(n).request({request:ho({},r),chainId:`${n}:${o}`,topic:this.session.topic})}sendAsync(r,i,n){this.request(r,n).then(o=>i(null,o)).catch(o=>i(o,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var r;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(r=this.session)==null?void 0:r.topic,reason:tr("USER_DISCONNECTED")}),await this.cleanup()}async connect(r){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(r),await this.cleanupPendingPairings(),!r.skipPairing)return await this.pair(r.pairingTopic)}on(r,i){this.events.on(r,i)}once(r,i){this.events.once(r,i)}removeListener(r,i){this.events.removeListener(r,i)}off(r,i){this.events.off(r,i)}get isWalletConnect(){return!0}async pair(r){this.shouldAbortPairingAttempt=!1;let i=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(i>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:n,approval:o}=await this.client.connect({pairingTopic:r,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});n&&(this.uri=n,this.events.emit("display_uri",n)),await o().then(h=>{this.session=h,this.namespaces||(this.namespaces=CE(h.namespaces),this.persist("namespaces",this.namespaces))}).catch(h=>{if(h.message!==zf)throw h;i++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(r,i){try{if(!this.session)return;const[n,o]=this.validateChain(r);this.getProvider(n).setDefaultChain(o,i)}catch(n){if(!/Please call connect/.test(n.message))throw n}}async cleanupPendingPairings(r={}){this.logger.info("Cleaning up inactive pairings...");const i=this.client.pairing.getAll();if(ys(i)){for(const n of i)r.deletePairings?this.client.core.expirer.set(n.topic,0):await this.client.core.relayer.subscriber.unsubscribe(n.topic);this.logger.info(`Inactive pairings cleared: ${i.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const r=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[r]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await pE.init({logger:this.providerOpts.logger||Dl,relayUrl:this.providerOpts.relayUrl||yE,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const r=[...new Set(Object.keys(this.session.namespaces).map(i=>Ws(i)))];uc("client",this.client),uc("events",this.events),uc("disableProviderPing",this.disableProviderPing),r.forEach(i=>{if(!this.session)return;const n=OE(i,this.session),o=Hf(n),h=AE(this.namespaces,this.optionalNamespaces),p=hc(ho({},h[i]),{accounts:n,chains:o});switch(i){case"eip155":this.rpcProviders[i]=new NE({namespace:p});break;case"solana":this.rpcProviders[i]=new LE({namespace:p});break;case"cosmos":this.rpcProviders[i]=new FE({namespace:p});break;case"polkadot":this.rpcProviders[i]=new TE({namespace:p});break;case"cip34":this.rpcProviders[i]=new DE({namespace:p});break;case"elrond":this.rpcProviders[i]=new $E({namespace:p});break;case"multiversx":this.rpcProviders[i]=new qE({namespace:p});break;case"near":this.rpcProviders[i]=new ME({namespace:p});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",r=>{this.events.emit("session_ping",r)}),this.client.on("session_event",r=>{const{params:i}=r,{event:n}=i;if(n.name==="accountsChanged"){const o=n.data;o&&ys(o)&&this.events.emit("accountsChanged",o.map(RE))}else if(n.name==="chainChanged"){const o=i.chainId,h=i.event.data,p=Ws(o),g=cc(o)!==cc(h)?`${p}:${cc(h)}`:o;this.onChainChanged(g)}else this.events.emit(n.name,n.data);this.events.emit("session_event",r)}),this.client.on("session_update",({topic:r,params:i})=>{var n;const{namespaces:o}=i,h=(n=this.client)==null?void 0:n.session.get(r);this.session=hc(ho({},h),{namespaces:o}),this.onSessionUpdate(),this.events.emit("session_update",{topic:r,params:i})}),this.client.on("session_delete",async r=>{await this.cleanup(),this.events.emit("session_delete",r),this.events.emit("disconnect",hc(ho({},tr("USER_DISCONNECTED")),{data:r.topic}))}),this.on(ui.DEFAULT_CHAIN_CHANGED,r=>{this.onChainChanged(r,!0)})}getProvider(r){if(!this.rpcProviders[r])throw new Error(`Provider not found: ${r}`);return this.rpcProviders[r]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(r=>{var i;this.getProvider(r).updateNamespace((i=this.session)==null?void 0:i.namespaces[r])})}setNamespaces(r){const{namespaces:i,optionalNamespaces:n,sessionProperties:o}=r;i&&Object.keys(i).length&&(this.namespaces=i),n&&Object.keys(n).length&&(this.optionalNamespaces=n),this.sessionProperties=o,this.persist("namespaces",i),this.persist("optionalNamespaces",n)}validateChain(r){const[i,n]=(r==null?void 0:r.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[i,n];if(i&&!Object.keys(this.namespaces||{}).map(p=>Ws(p)).includes(i))throw new Error(`Namespace '${i}' is not configured. Please call connect() first with namespace config.`);if(i&&n)return[i,n];const o=Ws(Object.keys(this.namespaces)[0]),h=this.rpcProviders[o].getDefaultChain();return[o,h]}async requestAccounts(){const[r]=this.validateChain();return await this.getProvider(r).requestAccounts()}onChainChanged(r,i=!1){var n;if(!this.namespaces)return;const[o,h]=this.validateChain(r);i||this.getProvider(o).setDefaultChain(h),((n=this.namespaces[o])!=null?n:this.namespaces[`${o}:${h}`]).defaultChain=h,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",h)}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(r,i){this.client.core.storage.setItem(`${$l}/${r}`,i)}async getFromStore(r){return await this.client.core.storage.getItem(`${$l}/${r}`)}}const BE=Lc,VE="wc",KE="ethereum_provider",GE=`${VE}@2:${KE}:`,WE="https://rpc.walletconnect.com/v1/",mc=["eth_sendTransaction","personal_sign"],JE=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],wc=["chainChanged","accountsChanged"],QE=["chainChanged","accountsChanged","message","disconnect","connect"];var YE=Object.defineProperty,XE=Object.defineProperties,ZE=Object.getOwnPropertyDescriptors,Hl=Object.getOwnPropertySymbols,ex=Object.prototype.hasOwnProperty,tx=Object.prototype.propertyIsEnumerable,kl=(c,r,i)=>r in c?YE(c,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):c[r]=i,Qs=(c,r)=>{for(var i in r||(r={}))ex.call(r,i)&&kl(c,i,r[i]);if(Hl)for(var i of Hl(r))tx.call(r,i)&&kl(c,i,r[i]);return c},Bl=(c,r)=>XE(c,ZE(r));function mo(c){return Number(c[0].split(":")[1])}function lc(c){return`0x${c.toString(16)}`}function rx(c){const{chains:r,optionalChains:i,methods:n,optionalMethods:o,events:h,optionalEvents:p,rpcMap:g}=c;if(!ys(r))throw new Error("Invalid chains");const w={chains:r,methods:n||mc,events:h||wc,rpcMap:Qs({},r.length?{[mo(r)]:g[mo(r)]}:{})},S=h==null?void 0:h.filter(K=>!wc.includes(K)),L=n==null?void 0:n.filter(K=>!mc.includes(K));if(!i&&!p&&!o&&!(S!=null&&S.length)&&!(L!=null&&L.length))return{required:r.length?w:void 0};const H=(S==null?void 0:S.length)&&(L==null?void 0:L.length)||!i,B={chains:[...new Set(H?w.chains.concat(i||[]):i)],methods:[...new Set(w.methods.concat(o!=null&&o.length?o:JE))],events:[...new Set(w.events.concat(p!=null&&p.length?p:QE))],rpcMap:g};return{required:r.length?w:void 0,optional:i.length?B:void 0}}class Fc{constructor(){this.events=new yr.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=GE,this.on=(r,i)=>(this.events.on(r,i),this),this.once=(r,i)=>(this.events.once(r,i),this),this.removeListener=(r,i)=>(this.events.removeListener(r,i),this),this.off=(r,i)=>(this.events.off(r,i),this),this.parseAccount=r=>this.isCompatibleChainId(r)?this.parseAccountId(r).address:r,this.signer={},this.rpc={}}static async init(r){const i=new Fc;return await i.initialize(r),i}async request(r){return await this.signer.request(r,this.formatChainId(this.chainId))}sendAsync(r,i){this.signer.sendAsync(r,i,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(r){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(r);const{required:i,optional:n}=rx(this.rpc);try{const o=await new Promise(async(p,g)=>{var w;this.rpc.showQrModal&&((w=this.modal)==null||w.subscribeModal(S=>{!S.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),g(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(Bl(Qs({namespaces:Qs({},i&&{[this.namespace]:i})},n&&{optionalNamespaces:{[this.namespace]:n}}),{pairingTopic:r==null?void 0:r.pairingTopic})).then(S=>{p(S)}).catch(S=>{g(new Error(S.message))})});if(!o)return;const h=a1(o.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:h),this.setAccounts(h),this.events.emit("connect",{chainId:lc(this.chainId)})}catch(o){throw this.signer.logger.error(o),o}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",r=>{const{params:i}=r,{event:n}=i;n.name==="accountsChanged"?(this.accounts=this.parseAccounts(n.data),this.events.emit("accountsChanged",this.accounts)):n.name==="chainChanged"?this.setChainId(this.formatChainId(n.data)):this.events.emit(n.name,n.data),this.events.emit("session_event",r)}),this.signer.on("chainChanged",r=>{const i=parseInt(r);this.chainId=i,this.events.emit("chainChanged",lc(this.chainId)),this.persist()}),this.signer.on("session_update",r=>{this.events.emit("session_update",r)}),this.signer.on("session_delete",r=>{this.reset(),this.events.emit("session_delete",r),this.events.emit("disconnect",Bl(Qs({},tr("USER_DISCONNECTED")),{data:r.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",r=>{var i,n;this.rpc.showQrModal&&((i=this.modal)==null||i.closeModal(),(n=this.modal)==null||n.openModal({uri:r})),this.events.emit("display_uri",r)})}switchEthereumChain(r){this.request({method:"wallet_switchEthereumChain",params:[{chainId:r.toString(16)}]})}isCompatibleChainId(r){return typeof r=="string"?r.startsWith(`${this.namespace}:`):!1}formatChainId(r){return`${this.namespace}:${r}`}parseChainId(r){return Number(r.split(":")[1])}setChainIds(r){const i=r.filter(n=>this.isCompatibleChainId(n)).map(n=>this.parseChainId(n));i.length&&(this.chainId=i[0],this.events.emit("chainChanged",lc(this.chainId)),this.persist())}setChainId(r){if(this.isCompatibleChainId(r)){const i=this.parseChainId(r);this.chainId=i,this.switchEthereumChain(i)}}parseAccountId(r){const[i,n,o]=r.split(":");return{chainId:`${i}:${n}`,address:o}}setAccounts(r){this.accounts=r.filter(i=>this.parseChainId(this.parseAccountId(i).chainId)===this.chainId).map(i=>this.parseAccountId(i).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(r){var i,n;const o=(i=r==null?void 0:r.chains)!=null?i:[],h=(n=r==null?void 0:r.optionalChains)!=null?n:[],p=o.concat(h);if(!p.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const g=o.length?(r==null?void 0:r.methods)||mc:[],w=o.length?(r==null?void 0:r.events)||wc:[],S=(r==null?void 0:r.optionalMethods)||[],L=(r==null?void 0:r.optionalEvents)||[],H=(r==null?void 0:r.rpcMap)||this.buildRpcMap(p,r.projectId),B=(r==null?void 0:r.qrModalOptions)||void 0;return{chains:o==null?void 0:o.map(K=>this.formatChainId(K)),optionalChains:h.map(K=>this.formatChainId(K)),methods:g,events:w,optionalMethods:S,optionalEvents:L,rpcMap:H,showQrModal:!!(r!=null&&r.showQrModal),qrModalOptions:B,projectId:r.projectId,metadata:r.metadata}}buildRpcMap(r,i){const n={};return r.forEach(o=>{n[o]=this.getRpcUrl(o,i)}),n}async initialize(r){if(this.rpc=this.getRpcConfig(r),this.chainId=this.rpc.chains.length?mo(this.rpc.chains):mo(this.rpc.optionalChains),this.signer=await BE.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:r.disableProviderPing,relayUrl:r.relayUrl,storageOptions:r.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let i;try{const{WalletConnectModal:n}=await c1(()=>import("./index-85c98615.js").then(o=>o.i),["assets/index-85c98615.js","assets/index-2ae87c9c.js","assets/index-22b330b1.css"]);i=n}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(i)try{this.modal=new i(Qs({walletConnectVersion:2,projectId:this.rpc.projectId,standaloneChains:this.rpc.chains},this.rpc.qrModalOptions))}catch(n){throw this.signer.logger.error(n),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(r){if(!r)return;const{chains:i,optionalChains:n,rpcMap:o}=r;i&&ys(i)&&(this.rpc.chains=i.map(h=>this.formatChainId(h)),i.forEach(h=>{this.rpc.rpcMap[h]=(o==null?void 0:o[h])||this.getRpcUrl(h)})),n&&ys(n)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=n==null?void 0:n.map(h=>this.formatChainId(h)),n.forEach(h=>{this.rpc.rpcMap[h]=(o==null?void 0:o[h])||this.getRpcUrl(h)}))}getRpcUrl(r,i){var n;return((n=this.rpc.rpcMap)==null?void 0:n[r])||`${WE}?chainId=eip155:${r}&projectId=${i||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const r=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),i=this.session.namespaces[`${this.namespace}:${r}`]?this.session.namespaces[`${this.namespace}:${r}`]:this.session.namespaces[this.namespace];this.setChainIds(r?[this.formatChainId(r)]:i==null?void 0:i.accounts),this.setAccounts(i==null?void 0:i.accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(r){return typeof r=="string"||r instanceof String?[this.parseAccount(r)]:r.map(i=>this.parseAccount(i))}}const fx=Fc;export{fx as EthereumProvider,QE as OPTIONAL_EVENTS,JE as OPTIONAL_METHODS,wc as REQUIRED_EVENTS,mc as REQUIRED_METHODS,Fc as default};
